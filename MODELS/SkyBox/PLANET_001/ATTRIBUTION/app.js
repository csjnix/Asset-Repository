function Event(){this.EventDelegate=new Array()}Event.prototype.Add=function(a,b){this.EventDelegate.push([a,b])};Event.prototype.Remove=function(a,b){for(var c=0;c<this.EventDelegate.length;++c){if((this.EventDelegate[c][0]==a)&&(this.EventDelegate[c][1]==b)){this.EventDelegate.splice(c,1);break}}};Event.prototype.Clear=function(){this.EventDelegate=new Array()};Event.prototype.Dispatch=function(){var a=arguments;for(var b=0;b<this.EventDelegate.length;++b){this.EventDelegate[b][0].apply(this.EventDelegate[b][1],a)}};Property=function(a,b){this.mName=a;this.mValue=b;this.OnPropertyChanged=new Event()};Property.prototype.SetValue=function(a){this.mValue=a;this.OnPropertyChanged.Dispatch(this);return this.mValue};Property.prototype.GetValue=function(){return this.mValue};Property.prototype.GetName=function(){return this.mName};function StringObject(a){this.mString=a?a:""}StringObject.prototype.At=function(a){return this.mString.charAt(a)};StringObject.prototype.CompareTo=function(b){var a=this.mString==b;if(a==false){if(this.mString.length>b.mString.length){return 1}else{return -1}}return 0};StringObject.prototype.EndIndexOf=function(b,a){return this.mString.lastIndexOf(b,a)};StringObject.prototype.EndsWith=function(a){return(this.mString.indexOf(a,this.mString.length-a.mString.length)!=-1)};StringObject.prototype.Equals=function(a){if(typeof(a)=="string"){return this.mString==a}return(this.mString==a.mString)};StringObject.prototype.IndexOf=function(b,a){return this.mString.indexOf(b,a)};StringObject.prototype.Insert=function(b,a){this.mString=this.mString.substring(0,b)+a+this.mString.substring(b);return this};StringObject.prototype.Length=function(){return this.mString.length};StringObject.prototype.Remove=function(b,a){this.mString=this.mString.substring(0,b)+this.mString.substring(b+a);return this};StringObject.prototype.Replace=function(b,a){this.mString=this.mString.replace(new RegExp(b,"g"),a);return this};StringObject.prototype.Reverse=function(){var b="";for(var a=this.mString.length-1;a>=0;++a){b+=this.mString[a]}this.mString=b;return this};StringObject.prototype.Split=function(b,a){return this.mString.split(b,a)};StringObject.prototype.StartsWith=function(a){return(this.mString.indexOf(a)==0)};StringObject.prototype.Substring=function(b,a){if(a==null){this.mString=this.mString.substring(b)}else{this.mString=this.mString.substring(b,b+a)}return this};StringObject.prototype.ToByteArray=function(){return this.mString};StringObject.prototype.ToLower=function(){this.mString=this.mString.toLowerCase();return this};StringObject.prototype.ToUpper=function(){this.mString=this.mString.toUpperCase();return this};StringObject.prototype.Trim=function(a){this.TrimEnd(a);this.TrimStart(a);return this};StringObject.prototype.TrimEnd=function(a){if(a==null){this.TrimEnd(" ");this.TrimEnd("\t");this.TrimEnd("\r");this.TrimEnd("\n")}else{var d=this.mString.length;var f=a.length;for(var e=(this.mString.length-f);e>=0;e-=f){var c=true;for(var b=0;b<f;++b){if(this.mString[e+b]!=a[b]){c=false;break}}if(c){d=e}else{break}}if(d!=this.mString.length){this.mString=this.mString.substring(0,d)}}return this};StringObject.prototype.TrimStart=function(a){if(a==null){this.TrimStart(" ");this.TrimStart("\t");this.TrimStart("\r");this.TrimStart("\n")}else{var d=0;var f=a.length;for(var e=0;e<this.mString.length;e+=f){d=e;var c=true;for(var b=0;b<f;++b){if(this.mString[e+b]!=a[b]){c=false;break}}if(!c){break}}if(d!=0){this.mString=this.mString.substring(d)}}return this};StringObject.prototype.Parse=function(a){};StringObject.prototype.Scan=function(a){};StringObject.FastAppend=function(){var c=new Array();var a=arguments;for(var b=0;b<a.length;++b){c.push(a[b])}return c.join("")};function Timer(){this.mEnable=false;this.mInterval=1;this.mTimer=0;this.OnTimer=new Event()}Timer.Pause=false;Timer.mSigTimer=new Event();Timer.prototype.OnSigTimer=function(){if(this.mEnable&&(Timer.GetTime()>=this.mTimer)){this.OnTimer.Dispatch();this.mTimer=Timer.GetTime()+this.mInterval}};Timer.SigTimer=function(){if(!Timer.Pause){Timer.mSigTimer.Dispatch()}};Timer.prototype.Start=function(){if(!this.mEnable){this.mEnable=true;this.mTimer=Timer.GetTime()+this.mInterval;Timer.mSigTimer.Add(this.OnSigTimer,this)}};Timer.prototype.Stop=function(){if(this.mEnable){this.mEnable=false;Timer.mSigTimer.Remove(this.OnSigTimer,this)}};Timer.prototype.IsEnabled=function(){return this.mEnable};Timer.prototype.SetInterval=function(a){this.mInterval=a;this.mTimer=Timer.GetTime()+this.mInterval};Timer.prototype.GetInterval=function(){return this.mInterval};Timer.GetTime=function(){return(new Date).getTime()*0.001};function Uri(a){this.mUriString=null;this.mScheme=null;this.mUserInfo=null;this.mHost=null;this.mPort=0;this.mPath=null;this.mQuery=null;this.mFragment=null;if(a!=null){this.Create(a)}}Uri.SchemeFile="file";Uri.SchemeFtp="ftp";Uri.SchemeHttp="http";Uri.SchemeHttps="https";Uri.SchemeMailto="mailto";Uri.prototype.Create=function(h){this.mUriString=h;this.mScheme="";this.mUserInfo="";this.mHost="";this.mPort=0;this.mPath="";this.mQuery="";this.mFragment="";var d=h;var f=h.length;var g=false;var a=0;var c=0;for(var e=0;e<f;++e){if((a==0)&&(d[e]==":")){this.mScheme=h.substring(c,e).toLowerCase();++a;c=e+1}else{if((a==1)&&(d[e]=="/")){if(((e+1)<f)&&(d[e+1]=="/")){c=e+2;var b=c;for(;b<f;++b){if(d[b]=="/"){if(g){if(b>c){this.mPort=parseInt(h.substring(c,b))}}else{this.mHost=h.substring(c,b)}c=b;++a;break}else{if(d[b]=="@"){if(b>c){this.mUserInfo=h.substring(c,b)}c=b+1}else{if(d[b]==":"){if(b>c){this.mHost=h.substring(c,b)}c=b+1;g=true}}}}e=b}else{++a}}else{if((a==2)&&((d[e]=="?")||(d[e]=="#"))){this.mPath=h.substring(c,e);c=e+1;if(d[e]=="?"){++a}else{a+=2;break}}else{if((a==3)&&(d[e]=="#")){this.mQuery=h.substring(c,e);c=e+1;++a;break}}}}}if(a<=2){this.mPath=h.substring(c);if(this.mPath[0]!="/"){this.mPath="/"+this.mPath}}else{if((a==3)&&(c!=f)){this.mQuery=h.substring(c)}else{if((a==4)&&(c!=f)){this.mFragment=h.substring(c)}}}};Uri.prototype.AbsolutePath=function(){return this.mPath};Uri.prototype.AbsoluteUri=function(){var a=this.mUriString.indexOf("#");if(a!=-1){return this.mUriString.substring(0,a)}return this.mUriString};Uri.prototype.DnsSafeHost=function(){return this.mHost};Uri.prototype.Fragment=function(){return this.mFragment};Uri.prototype.Host=function(){return this.mHost};Uri.prototype.IsAbsoluteUri=function(){return(this.mUriString.indexOf("#")==-1)};Uri.prototype.OriginalString=function(){return this.mUriString};Uri.prototype.Port=function(){return this.mPort};Uri.prototype.Query=function(){return this.mQuery};Uri.prototype.Scheme=function(){return this.mScheme};Uri.prototype.UserInfo=function(){return this.mUserInfo};Uri.EscapeDataString=function(a){return encodeURIComponent(a)};Uri.UnescapeDataString=function(a){return decodeURIComponent(a)};function Keyframe(a){this.Time=(a!=null)?a:0;this.Target=null;this.TargetProperty=0}Keyframe.prototype.Interpolate=function(b,c){var a=new Keyframe(this.Time);a.Target=this.Target;a.TargetProperty=this.TargetProperty;return a};function KeyframeDouble(b,a){Keyframe.call(this,b);this.Value=(a!=null)?a:0}KeyframeDouble.prototype=new Keyframe();KeyframeDouble.prototype.constructor=KeyframeDouble;KeyframeDouble.prototype.Interpolate=function(b,c){var a=new KeyframeDouble();a.Target=this.Target;a.TargetProperty=this.TargetProperty;a.Value=this.Value+(b.Value-this.Value)*c;return a};function KeyframePoint(b,a){Keyframe.call(this,b);this.KeyPoint=(a!=null)?a:new Point()}KeyframePoint.prototype=new Keyframe();KeyframePoint.prototype.constructor=KeyframePoint;KeyframePoint.prototype.Interpolate=function(b,c){var a=new KeyframePoint();a.Target=this.Target;a.TargetProperty=this.TargetProperty;a.KeyPoint.x=this.KeyPoint.x+(b.KeyPoint.x-this.KeyPoint.x)*c;a.KeyPoint.y=this.KeyPoint.y+(b.KeyPoint.y-this.KeyPoint.y)*c;a.KeyPoint.z=this.KeyPoint.z+(b.KeyPoint.z-this.KeyPoint.z)*c;a.KeyPoint.w=this.KeyPoint.w+(b.KeyPoint.w-this.KeyPoint.w)*c;return a};function KeyframeAnimation(){this.KeyframeList=new Array();this.Easing=null}KeyframeAnimation.prototype.Add=function(b){if(this.KeyframeList.length==0){this.KeyframeList.push(b)}else{var a;for(a=0;a<this.KeyframeList.length;++a){if(this.KeyframeList[a].Time>b.Time){this.KeyframeList.splice(a,0,b);break}}if(a==this.KeyframeList.length){this.KeyframeList.push(b)}}};KeyframeAnimation.prototype.Remove=function(a){this.KeyframeList.splice(a,1)};KeyframeAnimation.prototype.Clear=function(){this.KeyframeList=new Array()};KeyframeAnimation.prototype.GetEndTime=function(){if(this.KeyframeList.length>0){return this.KeyframeList[this.KeyframeList.length-1].Time}return 0};KeyframeAnimation.prototype.Frame=function(a){if(a<this.KeyframeList.length){return this.KeyframeList[a]}return null};KeyframeAnimation.prototype.FindFrame=function(b){for(var a=0;a<this.KeyframeList.length;++a){if(this.KeyframeList[a].Time>=b){return this.KeyframeList[a]}}if(this.KeyframeList.length>0){return this.KeyframeList[this.KeyframeList.length-1]}return null};KeyframeAnimation.prototype.Interpolate=function(f){var b=-1;for(var d=0;d<this.KeyframeList.length;++d){if(this.KeyframeList[d].Time>=f){b=d;break}}if(b!=-1){if((b==0)||((b==(this.KeyframeList.length-1))&&(this.KeyframeList[b].Time<=f))){return this.KeyframeList[b]}else{var e=this.KeyframeList[b-1];var a=this.KeyframeList[b];var g=(f-e.Time)/(a.Time-e.Time);if(this.Easing!=null){g=this.Easing.Ease(g)}var c=e.Interpolate(a,g);c.Time=f;return c}}if(this.KeyframeList.length>0){return this.KeyframeList[this.KeyframeList.length-1]}return new Keyframe()};function Storyboard(){this.OnStart=new Event();this.OnUpdate=new Event();this.OnEnd=new Event();this.Name=null;this.Animation=new Array();this.Loop=false;this.PlayTime=0;this.mStartTime=0;this.mPauseTime=0;this.mTimer=new Timer();this.mTimer.SetInterval(0);this.mTimer.OnTimer.Add(this.OnTimer,this)}Storyboard.prototype.OnTimer=function(){var c=new Array();this.PlayTime=Timer.GetTime()-this.mStartTime;var d=0;for(var b=0;b<this.Animation.length;++b){var a=this.Animation[b].Interpolate(this.PlayTime);c.push(a);if(c[b].Time>=this.Animation[b].GetEndTime()){++d}}this.OnUpdate.Dispatch(c);if(d==c.length){if(this.Loop){this.mStartTime=Timer.GetTime()}else{this.Stop()}}};Storyboard.prototype.Play=function(a){if(a==null){a=0}this.PlayTime=a;this.mStartTime=Timer.GetTime();this.mTimer.Start();this.OnStart.Dispatch()};Storyboard.prototype.Stop=function(){if(this.mTimer.IsEnabled()){this.mTimer.Stop();this.OnEnd.Dispatch()}};Storyboard.prototype.Pause=function(){this.mTimer.Stop();this.mPauseTime=Timer.GetTime()-this.mStartTime};Storyboard.prototype.Resume=function(){this.mStartTime=Timer.GetTime()-this.mPauseTime;this.mTimer.Start()};Storyboard.prototype.GetFrames=function(d){var c=new Array();for(var b=0;b<this.Animation.length;++b){var a=this.Animation[b].Interpolate(d);c.push(a)}return c};Storyboard.prototype.GetEndTime=function(){var b=0;var a=0;for(var c=0;c<this.Animation.length;++c){a=this.Animation[c].GetEndTime();if(b<a){b=a}}return b};Storyboard.prototype.IsPlaying=function(){return this.mTimer.IsEnabled()};function StoryboardGroup(){this.mStoryboardList=new Array();this.Name}StoryboardGroup.prototype.AddStoryboard=function(a){this.mStoryboardList.push(a)};StoryboardGroup.prototype.RemoveStoryboard=function(a){for(var b=0;b<this.mStoryboardList.length;++b){if(this.mStoryboardList[b].Name==a){this.mStoryboardList[b].Stop();this.mStoryboardList.splice(b,1);break}}};StoryboardGroup.prototype.GetStoryboard=function(a){for(var b=0;b<this.mStoryboardList.length;++b){if(this.mStoryboardList[b].Name==a){return this.mStoryboardList[b]}}return null};StoryboardGroup.prototype.Clear=function(){this.StopAll();this.mStoryboardList=new Array()};StoryboardGroup.prototype.Play=function(a,c){var b=this.GetStoryboard(a);if(b!=null){this.StopAll();if(c==null){c=0}b.Play(c);return true}return false};StoryboardGroup.prototype.Stop=function(a){var b=this.GetStoryboard(a);if(b!=null){b.Stop()}};StoryboardGroup.prototype.StopAll=function(){for(var a=0;a<this.mStoryboardList.length;++a){this.mStoryboardList[a].Stop()}};function StoryboardManager(){this.mStoryboard=new Array();this.mStoryboardGroup=new Array()}StoryboardManager.prototype.AddStoryboard=function(a){this.mStoryboard.push(a)};StoryboardManager.prototype.RemoveStoryboard=function(a){for(var b=0;b<this.mStoryboard.length;++b){if(this.mStoryboard[b].Name==a){this.mStoryboard[b].Stop();this.mStoryboard.splice(b,1);break}}};StoryboardManager.prototype.GetStoryboard=function(a){for(var c=0;c<this.mStoryboard.length;++c){if(this.mStoryboard[c].Name==a){return this.mStoryboard[c]}}for(var c=0;c<this.mStoryboardGroup.length;++c){var b=this.mStoryboardGroup[c].GetStoryboard(a);if(b!=null){return b}}return null};StoryboardManager.prototype.AddGroup=function(a){this.mStoryboardGroup.push(a)};StoryboardManager.prototype.RemoveGroup=function(a){for(var b=0;b<this.mStoryboardGroup.length;++b){if(this.mStoryboardGroup[b].Name==a){this.mStoryboardGroup[b].StopAll();this.mStoryboardGroup.splice(b,1);break}}};StoryboardManager.prototype.Clear=function(){for(var a=0;a<this.mStoryboard.length;++a){this.mStoryboard[a].Stop()}this.mStoryboard=new Array();for(var a=0;a<this.mStoryboardGroup.length;++a){this.mStoryboardGroup[a].StopAll()}this.mStoryboardGroup=new Array()};StoryboardManager.prototype.Play=function(a,c){if(c==null){c=0}for(var b=0;b<this.mStoryboard.length;++b){if(this.mStoryboard[b].Name==a){this.mStoryboard[b].Play(c);return true}}for(var b=0;b<this.mStoryboardGroup.length;++b){if(this.mStoryboardGroup[b].Play(a)){return true}}return false};StoryboardManager.prototype.Stop=function(a){for(var b=0;b<this.mStoryboard.length;++b){if(this.mStoryboard[b].Name==a){this.mStoryboard[b].Stop();return}}for(var b=0;b<this.mStoryboardGroup.length;++b){this.mStoryboardGroup[b].Stop(a)}};StoryboardManager.prototype.StopAll=function(){for(var a=0;a<this.mStoryboard.length;++a){this.mStoryboard[a].Stop()}for(var a=0;a<this.mStoryboardGroup.length;++a){this.mStoryboardGroup[a].StopAll()}};function EasingFunction(){this.Mode=EasingFunction.EasingMode.EaseIn}EasingFunction.EasingMode={EaseIn:0,EaseOut:1,EaseInOut:2};EasingFunction.prototype.GetEase=function(a){return a};EasingFunction.prototype.Ease=function(a){return((this.Mode==EasingFunction.EasingMode.EaseIn)?this.GetEase(a):(this.Mode==EasingFunction.EasingMode.EaseOut)?1-this.GetEase(1-a):(a>0.5)?1-(this.GetEase(1-((a-0.5)*2))*0.5):this.GetEase(a*2)*0.5)};function CubicEase(){EasingFunction.call(this)}CubicEase.prototype=new EasingFunction();CubicEase.prototype.constructor=CubicEase;CubicEase.prototype.GetEase=function(a){return a*a*a};function QuadraticEase(){EasingFunction.call(this)}QuadraticEase.prototype=new EasingFunction();QuadraticEase.prototype.constructor=QuadraticEase;QuadraticEase.prototype.GetEase=function(a){return a*a};function Collection(){this.mItem=new Array();this.OnCollectionChanged=new Event()}Collection.ChangedAction={Added:0,Removed:1,Replaced:2,Reset:3};Collection.prototype.Add=function(a){this.mItem.push(a);this.OnCollectionChanged.Dispatch(this,Collection.ChangedAction.Added,a,null,this.mItem.length-1)};Collection.prototype.Insert=function(a,b){this.mItem.splice(a,0,b);this.OnCollectionChanged.Dispatch(this,Collection.ChangedAction.Added,b,null,a)};Collection.prototype.Remove=function(a){var b=this.mItem[a];this.mItem.splice(a,1);this.OnCollectionChanged.Dispatch(this,Collection.ChangedAction.Removed,null,b,a)};Collection.prototype.Get=function(a){return this.mItem[a]};Collection.prototype.Set=function(b,c){var a=this.mItem[b];this.mItem[b]=c;this.OnCollectionChanged(this,Collection.ChangedAction.Replaced,c,a,b)};Collection.prototype.Clear=function(){this.mItem=new Array();this.OnCollectionChanged.Dispatch(this,Collection.ChangedAction.Reset,null,null,0)};Collection.prototype.Count=function(){return this.mItem.length};function DataObject(){this.Dictionary=new Array();this.OnPropertyChanged=new Event()}DataObject.prototype.GetValue=function(a){return this.Dictionary[a]};DataObject.prototype.SetValue=function(a,b){this.Dictionary[a]=b;this.OnPropertyChanged.Dispatch(this,a)};DataObject.prototype.AppendDictionary=function(a){this.Dictionary=this.Dictionary.concat(a);for(property in a){this.Dictionary[property]=a[property]}};DataObject.prototype.Clear=function(){this.Dictionary=new Array()};function HashItem(a,b){this.Key=a;this.Item=b}function HashFunctions(){}HashFunctions.IntHash=function(a){return a};HashFunctions.StringHash=function(b){var d=0;var c=b.length;for(var a=0;a<c;++a){d=(31*d)+b[a]}return d};function Hash(b,a){this.mList=0;this.mHashFunction=b;this.mSize=0;this.Create(a)}Hash.prototype.Get=function(b){var c=this.mList[this.mHashFunction(b)%this.mSize];if(c!=null){for(var a=0;a<c.length;++a){if(c[a].Item.Key==b){return c[a]}}}return null};Hash.prototype.Create=function(a){this.mSize=a;if(a>0){this.mList=new Array(a)}else{this.mList=null}};Hash.prototype.Set=function(b,d){var a=this.mHashFunction(b)%this.mSize;var c=this.mList[a];if(c==null){c=new Array();this.mList[a]=c}c.push(d)};Hash.prototype.Remove=function(b){var c=this.mList[this.mHashFunction(b)%this.mSize];if(c!=null){for(var a=0;a<c.length;++a){if(c[a].Item.Key==b){c.splice(a,1);break}}}};Hash.prototype.Clear=function(){mList=new Array(this.mSize)};Hash.prototype.ContainsKey=function(a){return(this.Get(a)!=null)};function Locale(){DataObject.call(this);this.mLocaleCode;this.OnUpdate=new Event()}Locale.prototype=new DataObject();Locale.prototype.constructor=Locale;Locale.prototype.Import=function(g,e){this.mLocaleCode=e;var a=new StreamReader(g);while(!a.IsEndOfStream()){var b=a.ReadLine();if(!(b.indexOf("#")==0)){var c=b.indexOf("=");if(c!=-1){var d=b.substring(0,c);var f=b.substring(c+1);f=f.replace("\\n","\n");this.SetValue(d,f)}}}this.OnUpdate.Dispatch(this)};Locale.prototype.GetValue=function(a,d){var c=DataObject.prototype.GetValue.call(this,a);if((d!=null)&&(c.length>0)){for(var b=0;b<d.length;++b){c=c.replace("{"+b+"}",d[b])}}return c};Locale.prototype.GetLocalCode=function(){return this.mLocaleCode};function MathObject(){}MathObject.Exp=2.718281828;MathObject.PI=3.141592654;MathObject.HalfPI=MathObject.PI*0.5;MathObject.TwoPI=MathObject.PI*2;MathObject.InvPI=1/MathObject.PI;MathObject.RAD=180/MathObject.PI;MathObject.PI180=MathObject.PI/180;MathObject.PI360=MathObject.PI/360;function Point(a,d,c,b){this.x=(a!=null)?a:0;this.y=(d!=null)?d:0;this.z=(c!=null)?c:0;this.w=(b!=null)?b:0}Point.prototype.At=function(a,b){if(b==null){return(a==0)?x:(a==1)?y:(a==2)?z:w}else{if(a==0){x=b}else{if(a==1){y=b}else{if(a==2){z=b}else{w=b}}}}};Point.prototype.NotEqual=function(a){return(this.x!=a.x)||(this.y!=a.y)||(this.z!=a.z)||(this.w!=a.w)};Point.prototype.LessThan=function(a){return(this.x<a.x)&&(this.y<a.y)&&(this.z<a.z)&&(this.w<a.w)};Point.prototype.LessThanEqual=function(a){return(this.x<=a.x)&&(this.y<=a.y)&&(this.z<=a.z)&&(this.w<=a.w)};Point.prototype.GreaterThan=function(a){return(this.x>a.x)&&(this.y>a.y)&&(this.z>a.z)&&(this.w>a.w)};Point.prototype.GreaterThanEqual=function(a){return(this.x>=a.x)&&(this.y>=a.y)&&(this.z>=a.z)&&(this.w>=a.w)};Point.prototype.Equal=function(a){return(this.x==a.x)&&(this.y==a.y)&&(this.z==a.z)&&(this.w==a.w)};Point.prototype.Add=function(a){return new Point(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)};Point.prototype.AddScalar=function(a){return new Point(this.x+a,this.y+a,this.z+a,this.w+a)};Point.prototype.Negative=function(){return new Point(-this.x,-this.y,-this.z,-this.w)};Point.prototype.Subtract=function(a){return new Point(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)};Point.prototype.SubtractScalar=function(a){return new Point(this.x-a,this.y-a,this.z-a,this.w-a)};Point.prototype.Multiply=function(a){return new Point(this.x*a.x,this.y*a.y,this.z*a.z,this.w*a.w)};Point.prototype.MultiplyScalar=function(a){return new Point(this.x*a,this.y*a,this.z*a,this.w*a)};Point.prototype.Divide=function(a){return new Point(this.x/a.x,this.y/a.y,this.z/a.z,this.w/a.w)};Point.prototype.DivideScalar=function(a){return new Point(this.x/a,this.y/a,this.z/a,this.w/a)};Point.prototype.Absolute=function(){return new Point(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z,this.w<0?-this.w:this.w)};Point.prototype.Clamp=function(b,a){return new Point(this.x<b?b:this.x>a?a:this.x,this.y<b?b:this.y>a?a:this.y,this.z<b?b:this.z>a?a:this.z,this.w<b?b:this.w>a?a:this.w)};Point.prototype.Cross=function(a){return new Point(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)};Point.prototype.Distance=function(a){return Math.sqrt(((this.x-a.x)*(this.x-a.x))+((this.y-a.y)*(this.y-a.y))+((this.z-a.z)*(this.z-a.z)))};Point.prototype.Dot=function(a){return((this.x*a.x)+(this.y*a.y)+(this.z*a.z))};Point.prototype.Magnitude=function(){return Math.sqrt((this.x*this.x)+(this.y*this.y)+(this.z*this.z)+(this.w*this.w))};Point.prototype.Normalize=function(){var a=this.Magnitude();if(a!=0){this.x/=a;this.y/=a;this.z/=a;this.w/=a}return this};Point.prototype.Reflect=function(b){var a=this.Dot(b);return new Point(this.x-2*b.x*a,this.y-2*b.y*a,this.z-2*b.z*a)};Point.prototype.Refract=function(e,b){var d=e.Dot(this);var c=Math.sqrt(1-(b*b)*(1-(d*d)));var a=(b*d)-c;if(d>=0){return new Point((this.x*b)+(e.x*a),(this.y*b)+(e.y*a),(this.z*b)+(e.z*a))}else{return new Point((this.x*b)-(e.x*a),(this.y*b)-(e.y*a),(this.z*b)-(e.z*a))}};Point.prototype.SetPoint=function(a,d,c,b){this.x=a?a:0;this.y=d?d:0;this.z=c?c:0;this.w=b?b:0};function Quaternion(a,d,c,b){Point.call(this,a,d,c,b);this.Sqrt2=1.414213562;if(b==null){this.w=1}}Quaternion.prototype=new Point();Quaternion.prototype.constructor=Quaternion;Quaternion.prototype.ToQuaternion=function(a){var d=new Quaternion();var c=a.MMatrix[0]+a.MMatrix[5]+a.MMatrix[10];if(c>0){var b=0.5/Math.sqrt(c+1);d.w=0.25/b;d.x=(a.MMatrix[9]-a.MMatrix[6])*b;d.y=(a.MMatrix[2]-a.MMatrix[8])*b;d.z=(a.MMatrix[4]-a.MMatrix[1])*b}else{if((a.MMatrix[0]>a.MMatrix[5])&&(a.MMatrix[0]>a.MMatrix[10])){var b=Math.sqrt(1+a.MMatrix[0]-a.MMatrix[5]-a.MMatrix[10])*2;d.w=(a.MMatrix[9]-a.MMatrix[6])/b;d.x=0.25*b;d.y=(a.MMatrix[1]+a.MMatrix[4])/b;d.z=(a.MMatrix[2]+a.MMatrix[8])/b}else{if(a.MMatrix[5]>a.MMatrix[10]){var b=Math.sqrt(1+a.MMatrix[5]-a.MMatrix[0]-a.MMatrix[10])*2;d.w=(a.MMatrix[2]-a.MMatrix[8])/b;d.x=(a.MMatrix[1]+a.MMatrix[4])/b;d.y=0.25*b;d.z=(a.MMatrix[6]+a.MMatrix[9])/b}else{var b=Math.sqrt(1+a.MMatrix[10]-a.MMatrix[0]-a.MMatrix[5])*2;d.w=(a.MMatrix[4]-a.MMatrix[1])/b;d.x=(a.MMatrix[2]+a.MMatrix[8])/b;d.y=(a.MMatrix[6]+a.MMatrix[9])/b;d.z=0.25*b}}}return d};Quaternion.prototype.Multiply=function(b){var a=new Quaternion();a.w=this.w*b.w-this.x*b.x-this.y*b.y-this.z*b.z;a.x=this.w*b.x+this.x*b.w+this.y*b.z-this.z*b.y;a.y=this.w*b.y+this.y*b.w+this.z*b.x-this.x*b.z;a.z=this.w*b.z+this.z*b.w+this.x*b.y-this.y*b.x;return a};Quaternion.prototype.Conjugate=function(){x=-x;y=-y;z=-z};Quaternion.prototype.SetMatrix=function(b){var a=this.ToQuaternion(b);this.SetPoint(a.x,a.y,a.z,a.w)};Quaternion.prototype.SetAxis=function(b){var a=Math.sin(b.w*0.5);this.SetPoint(b.x*a,b.y*a,b.z*a,Math.cos(b.w*0.5))};Quaternion.prototype.RotateAxis=function(a,e,d,b){b*=MathObject.PI180;var c=Math.sin(b*0.5);this.w=Math.cos(b*0.5);this.x=a*c;this.y=e*c;this.z=d*c;this.Normalize()};Quaternion.prototype.Rotate=function(j,h,g){j=(j*MathObject.PI180)*0.5;h=(h*MathObject.PI180)*0.5;g=(g*MathObject.PI180)*0.5;var d=Math.cos(j);var l=Math.sin(j);var c=Math.cos(h);var k=Math.sin(h);var b=Math.cos(g);var i=Math.sin(g);var a=d*b;var e=d*i;var f=l*b;var m=l*i;this.w=(c*a)+(k*m);this.x=(c*f)-(k*e);this.y=(c*m)+(k*a);this.z=(c*e)-(k*f)};Quaternion.prototype.Transform=function(b){var c=this.x*this.x;var d=this.y*this.y;var a=this.z*this.z;b.SetPoint((b.x*(1-2*(d+a)))+(b.y*(2*(this.x*this.y+this.z*this.w)))+(b.z*(2*(this.x*this.z-this.y*this.w))),(b.x*(2*(this.x*this.y-this.z*this.w)))+(b.y*(1-2*(c+a)))+(b.z*(2*(this.y*this.z+this.x*this.w))),(b.x*(2*(this.x*this.z+this.y*this.w)))+(b.y*(2*(this.y*this.z-this.x*this.w)))+(b.z*(1-2*(c+d))))};Quaternion.prototype.Slerp=function(e,c){var f=Math.acos(this.Dot(e));var b=0;var a=0;if(f>0){var d=Math.sin(f);b=Math.sin((1-c)*f)/d;a=Math.sin(c*f)/d}else{b=1-c;a=c}return(new Quaternion((b*this.x)+(a*e.x),(b*this.y)+(a*e.y),(b*this.z)+(a*e.z),(b*this.w)+(a*e.w))).Normalize()};Quaternion.prototype.ToMatrix=function(d){var c=this.x*this.Sqrt2;var e=this.y*this.Sqrt2;var f=this.z*this.Sqrt2;var b=this.w*this.Sqrt2;var g=c*c;var h=e*e;var a=f*f;d[0]=1-h-a;d[1]=b*f+c*e;d[2]=c*f-b*e;d[4]=c*e-b*f;d[5]=1-g-a;d[6]=b*c+e*f;d[8]=b*e+c*f;d[9]=e*f-b*c;d[10]=1-g-h};Quaternion.prototype.ToAxisAngle=function(){var a=this.Magnitude();if(a!=0){return new Point(this.x/a,this.y/a,this.z/a,2*Math.acos(this.w))}return new Point()};Quaternion.prototype.ToEuler=function(){var a=(this.x*this.y)+(this.z*this.w);if(a>0.499){return new Point(0,2*Math.atan2(this.x,this.w)*MathObject.RAD,MathObject.HalfPI*MathObject.RAD)}else{if(a<-0.499){return new Point(0,-2*Math.atan2(this.x,this.w)*MathObject.RAD,-MathObject.HalfPI*MathObject.RAD)}}return new Point(Math.atan2(2*((this.w*this.x)-(this.y*this.z)),1-(2*((this.x*this.x)-(this.z*this.z))))*MathObject.RAD,Math.atan2(2*((this.w*this.y)-(this.x*this.z)),1-(2*((this.y*this.y)-(this.z*this.z))))*MathObject.RAD,Math.asin(2*a)*MathObject.RAD)};function Matrix(b,a){this.MMatrix=[b*a];this.mNumRows=b;this.mNumColumns=a;this.mRotation=new Point();this.mScale=new Point(1,1,1,1);this.SetIdentity()}Matrix.prototype.GetDeterminant=function(c,e){if(e<1){return 0}else{if(e==1){return c.MMatrix[0]}else{if(e==2){return(c.MMatrix[0]*c.MMatrix[3])-(c.MMatrix[1]*c.MMatrix[2])}else{if(e==3){return(c.MMatrix[0]*c.MMatrix[4]*c.MMatrix[8])-(c.MMatrix[0]*c.MMatrix[5]*c.MMatrix[7])-(c.MMatrix[1]*c.MMatrix[3]*c.MMatrix[8])+(c.MMatrix[1]*c.MMatrix[5]*c.MMatrix[6])+(c.MMatrix[2]*c.MMatrix[3]*c.MMatrix[7])-(c.MMatrix[2]*c.MMatrix[4]*c.MMatrix[6])}else{var b=0;for(var d=0;d<e;++d){var f=new Matrix(e-1,e-1);for(var g=0;g<(e-1);++g){for(var a=0;a<(e-1);++a){f.SetValue(g,a,c.GetValue(g+1,a>=d?(a+1):a))}}b+=c.GetValue(0,d)*(Math.pow(-1,0+d))*this.GetDeterminant(f,e-1)}return b}}}}};Matrix.prototype.At=function(a){return this.MMatrix[a]};Matrix.prototype.At=function(a,b){this.MMatrix[a]=b};Matrix.prototype.Equal=function(a){if((this.mNumRows!=a.mumRows)||(this.mNumColumns!=a.mNumColumns)){return false}var c=this.mNumRows*this.mNumColumns;for(var b=0;b<c;++b){if(this.MMatrix[b]!=a.MMatrix[b]){return false}}return true};Matrix.prototype.NotEqual=function(a){return((this.Equal(matrix2))==false)};Matrix.prototype.Add=function(a){if((this.mNumRows!=a.mNumRows)||(this.mNumColumns!=a.mNumColumns)){return this}var b=new Matrix(this.mNumRows,this.mNumColumns);var d=b.GetSize();for(var c=0;c<d;++c){b.MMatrix[c]=this.MMatrix[c]+a.MMatrix[c]}return b};Matrix.prototype.Subtract=function(a){if((this.mNumRows!=a.mNumRows)||(this.mNumColumns!=a.mNumColumns)){return this}var b=new Matrix(this.mNumRows,this.mNumColumns);var d=b.GetSize();for(var c=0;c<d;++c){b.MMatrix[c]=this.MMatrix[c]-matrix2.MMatrix[c]}return b};Matrix.prototype.Multiply=function(b){if((this.mNumRows!=b.mNumRows)||(this.mNumColumns!=b.mNumColumns)){return this}var d=new Matrix(this.mNumRows,this.mNumColumns);var f=d.GetSize();for(var e=0;e<f;++e){d.MMatrix[e]=0}for(var e=0;e<d.mNumRows;++e){var g=e*d.mNumColumns;for(var c=0;c<d.mNumColumns;++c){for(var a=0;a<d.mNumColumns;++a){d.MMatrix[g+c]+=(this.MMatrix[g+a]*b.MMatrix[a*d.mNumColumns+c])}}}d.mScale.x=this.mScale.x*b.mScale.x;d.mScale.y=this.mScale.y*b.mScale.y;d.mScale.z=this.mScale.z*b.mScale.z;return d};Matrix.prototype.MultiplyPoint=function(a){if(this.mNumRows==this.mNumColumns){var b=a.Multiply(this.mScale);if(this.mNumRows==4){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[1]*b.y)+(this.MMatrix[2]*b.z)+(this.MMatrix[3]*b.w),(this.MMatrix[4]*b.x)+(this.MMatrix[5]*b.y)+(this.MMatrix[6]*b.z)+(this.MMatrix[7]*b.w),(this.MMatrix[8]*b.x)+(this.MMatrix[9]*b.y)+(this.MMatrix[10]*b.z)+(this.MMatrix[11]*b.w),(this.MMatrix[12]*b.x)+(this.MMatrix[13]*b.y)+(this.MMatrix[14]*b.z)+(this.MMatrix[15]*b.w))}else{if(this.mNumRows==3){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[1]*b.y)+(this.MMatrix[2]*b.z),(this.MMatrix[3]*b.x)+(this.MMatrix[4]*b.y)+(this.MMatrix[5]*b.z),(this.MMatrix[6]*b.x)+(this.MMatrix[7]*b.y)+(this.MMatrix[8]*b.z))}else{if(this.mNumRows==2){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[1]*b.y),(this.MMatrix[2]*b.x)+(this.MMatrix[3]*b.y))}}}}return a};Matrix.prototype.PointMultiply=function(a){if(this.mNumRows==this.mNumColumns){var b=a.Multiply(this.mScale);if(this.mNumRows==4){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[4]*b.y)+(this.MMatrix[8]*b.z)+(this.MMatrix[12]*b.w),(this.MMatrix[1]*b.x)+(this.MMatrix[5]*b.y)+(this.MMatrix[9]*b.z)+(this.MMatrix[13]*b.w),(this.MMatrix[2]*b.x)+(this.MMatrix[6]*b.y)+(this.MMatrix[10]*b.z)+(this.MMatrix[14]*b.w),(this.MMatrix[3]*b.x)+(this.MMatrix[7]*b.y)+(this.MMatrix[11]*b.z)+(this.MMatrix[15]*b.w))}else{if(this.mNumRows==3){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[3]*b.y)+(this.MMatrix[6]*b.z),(this.MMatrix[1]*b.x)+(this.MMatrix[4]*b.y)+(this.MMatrix[7]*b.z),(this.MMatrix[2]*b.x)+(this.MMatrix[5]*b.y)+(this.MMatrix[8]*b.z))}else{if(this.mNumRows==2){return new Point((this.MMatrix[0]*b.x)+(this.MMatrix[2]*b.y),(this.MMatrix[1]*b.x)+(this.MMatrix[3]*b.y))}}}}return a};Matrix.prototype.Transpose=function(b){var a=new Matrix(this.mNumRows,this.mNumColumns);for(var d=0;d<a.mNumRows;++d){for(var c=0;c<a.mNumColumns;++c){a.SetValue(d,c,b.MMatrix[d+c*a.mNumColumns])}}return a};Matrix.prototype.Inverse=function(){var a=new Matrix(4,4);a.MMatrix[0]=this.MMatrix[0];a.MMatrix[1]=this.MMatrix[4];a.MMatrix[2]=this.MMatrix[8];a.MMatrix[4]=this.MMatrix[1];a.MMatrix[5]=this.MMatrix[5];a.MMatrix[6]=this.MMatrix[9];a.MMatrix[8]=this.MMatrix[2];a.MMatrix[9]=this.MMatrix[6];a.MMatrix[10]=this.MMatrix[10];a.mRotation.x=-this.mRotation.x;a.mRotation.y=-this.mRotation.y;a.mRotation.z=-this.mRotation.z;a.MMatrix[12]=-((a.MMatrix[0]*this.MMatrix[12])+(a.MMatrix[4]*this.MMatrix[13])+(a.MMatrix[8]*this.MMatrix[14]));a.MMatrix[13]=-((a.MMatrix[1]*this.MMatrix[12])+(a.MMatrix[5]*this.MMatrix[13])+(a.MMatrix[9]*this.MMatrix[14]));a.MMatrix[14]=-((a.MMatrix[2]*this.MMatrix[12])+(a.MMatrix[6]*this.MMatrix[13])+(a.MMatrix[10]*this.MMatrix[14]));a.mScale.x=1/this.mScale.x;a.mScale.y=1/this.mScale.y;a.mScale.z=1/this.mScale.z;a.mScale.w=1;return a};function SWAP_ROWS(d,c){var e=d;d=c;c=e}Matrix.prototype.SlowInverse=function(){if((this.mNumRows!=4)||(this.mNumColumns!=4)){return this}var g=new Matrix(4,4);var f=new Array();var m,k,j,h,l;var d=new Array();var c=new Array();var b=new Array();var a=new Array();d[0]=this.MMatrix[0+0*4];d[1]=this.MMatrix[0+1*4];d[2]=this.MMatrix[0+2*4];d[3]=this.MMatrix[0+3*4];d[4]=1;d[5]=d[6]=d[7]=0;c[0]=this.MMatrix[1+0*4];c[1]=this.MMatrix[1+1*4];c[2]=this.MMatrix[1+2*4];c[3]=this.MMatrix[1+3*4];c[5]=1;c[4]=c[6]=c[7]=0;b[0]=this.MMatrix[2+0*4];b[1]=this.MMatrix[2+1*4];b[2]=this.MMatrix[2+2*4];b[3]=this.MMatrix[2+3*4];b[6]=1;b[4]=b[5]=b[7]=0;a[0]=this.MMatrix[3+0*4];a[1]=this.MMatrix[3+1*4];a[2]=this.MMatrix[3+2*4];a[3]=this.MMatrix[3+3*4];a[7]=1;a[4]=a[5]=a[6]=0;if(Math.abs(a[0])>Math.abs(b[0])){SWAP_ROWS(a,b)}if(Math.abs(b[0])>Math.abs(c[0])){SWAP_ROWS(b,c)}if(Math.abs(c[0])>Math.abs(d[0])){SWAP_ROWS(c,d)}if(0==d[0]){return g}k=c[0]/d[0];j=b[0]/d[0];h=a[0]/d[0];l=d[1];c[1]-=k*l;b[1]-=j*l;a[1]-=h*l;l=d[2];c[2]-=k*l;b[2]-=j*l;a[2]-=h*l;l=d[3];c[3]-=k*l;b[3]-=j*l;a[3]-=h*l;l=d[4];if(l!=0){c[4]-=k*l;b[4]-=j*l;a[4]-=h*l}l=d[5];if(l!=0){c[5]-=k*l;b[5]-=j*l;a[5]-=h*l}l=d[6];if(l!=0){c[6]-=k*l;b[6]-=j*l;a[6]-=h*l}l=d[7];if(l!=0){c[7]-=k*l;b[7]-=j*l;a[7]-=h*l}if(Math.abs(a[1])>Math.abs(b[1])){SWAP_ROWS(a,b)}if(Math.abs(b[1])>Math.abs(c[1])){SWAP_ROWS(b,c)}if(0==c[1]){return g}j=b[1]/c[1];h=a[1]/c[1];b[2]-=j*c[2];a[2]-=h*c[2];b[3]-=j*c[3];a[3]-=h*c[3];l=c[4];if(0!=l){b[4]-=j*l;a[4]-=h*l}l=c[5];if(0!=l){b[5]-=j*l;a[5]-=h*l}l=c[6];if(0!=l){b[6]-=j*l;a[6]-=h*l}l=c[7];if(0!=l){b[7]-=j*l;a[7]-=h*l}if(Math.abs(a[2])>Math.abs(b[2])){SWAP_ROWS(a,b)}if(0==b[2]){return g}h=a[2]/b[2];a[3]-=h*b[3];a[4]-=h*b[4];a[5]-=h*b[5];a[6]-=h*b[6];a[7]-=h*b[7];if(0==a[3]){return g}l=(1/a[3]);a[4]*=l;a[5]*=l;a[6]*=l;a[7]*=l;j=b[3];l=(1/b[2]);b[4]=l*(b[4]-a[4]*j);b[5]=l*(b[5]-a[5]*j);b[6]=l*(b[6]-a[6]*j);b[7]=l*(b[7]-a[7]*j);k=c[3];c[4]-=a[4]*k;c[5]-=a[5]*k;c[6]-=a[6]*k;c[7]-=a[7]*k;m=d[3];d[4]-=a[4]*m;d[5]-=a[5]*m;d[6]-=a[6]*m;d[7]-=a[7]*m;k=c[2];l=(1/c[1]);c[4]=l*(c[4]-b[4]*k);c[5]=l*(c[5]-b[5]*k);c[6]=l*(c[6]-b[6]*k);c[7]=l*(c[7]-b[7]*k);m=d[2];d[4]-=b[4]*m;d[5]-=b[5]*m;d[6]-=b[6]*m;d[7]-=b[7]*m;m=d[1];l=(1/d[0]);d[4]=l*(d[4]-c[4]*m);d[5]=l*(d[5]-c[5]*m);d[6]=l*(d[6]-c[6]*m);d[7]=l*(d[7]-c[7]*m);f[0+0*4]=d[4];f[0+1*4]=d[5];f[0+2*4]=d[6];f[0+3*4]=d[7];f[1+0*4]=c[4];f[1+1*4]=c[5];f[1+2*4]=c[6];f[1+3*4]=c[7];f[2+0*4]=b[4];f[2+1*4]=b[5];f[2+2*4]=b[6];f[2+3*4]=b[7];f[3+0*4]=a[4];f[3+1*4]=a[5];f[3+2*4]=a[6];f[3+3*4]=a[7];for(var e=0;e<16;++e){g.MMatrix[e]=f[e]}return g};Matrix.prototype.PointAt=function(b,e,a){if(a==null){a=new Point(0,1,0)}var c=new Point(e.x-b.x,e.y-b.y,e.z-b.z);c.Normalize();var d=c.Cross(a);d.Normalize();a=d.Cross(c);this.MMatrix[0]=d.x;this.MMatrix[1]=d.y;this.MMatrix[2]=d.z;this.MMatrix[3]=0;this.MMatrix[4]=a.x;this.MMatrix[5]=a.y;this.MMatrix[6]=a.z;this.MMatrix[7]=0;this.MMatrix[8]=-c.x;this.MMatrix[9]=-c.y;this.MMatrix[10]=-c.z;this.MMatrix[11]=0;this.MMatrix[12]=b.x;this.MMatrix[13]=b.y;this.MMatrix[14]=b.z;this.MMatrix[15]=1};Matrix.prototype.Translate=function(a,c,b){if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==4)){this.MMatrix[12]=a;this.MMatrix[13]=c;this.MMatrix[14]=b}else{if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==3)){this.MMatrix[6]=a;this.MMatrix[7]=c}}};Matrix.prototype.Rotate=function(a,d,c){this.mRotation.SetPoint(a,d,c);var b=new Quaternion();b.Rotate(a,d,c);b.ToMatrix(this.MMatrix)};Matrix.prototype.Scale=function(a,c,b){this.mScale.SetPoint(a,c,b,1)};Matrix.prototype.Transform=function(a){return this.PointMultiply(a)};Matrix.prototype.ApplyTranslation=function(a){if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==4)){return new Point(a.x+this.MMatrix[12],a.y+this.MMatrix[13],a.z+this.MMatrix[14])}else{if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==3)){return new Point(a.x+this.MMatrix[6],a.y+this.MMatrix[7])}}return a};Matrix.prototype.ApplyRotation=function(a){if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==4)){return new Point((this.MMatrix[0]*a.x)+(this.MMatrix[4]*a.y)+(this.MMatrix[8]*a.z),(this.MMatrix[1]*a.x)+(this.MMatrix[5]*a.y)+(this.MMatrix[9]*a.z),(this.MMatrix[2]*a.x)+(this.MMatrix[6]*a.y)+(this.MMatrix[10]*a.z))}else{if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==3)){return new Point((this.MMatrix[0]*a.x)+(this.MMatrix[3]*a.y),(this.MMatrix[1]*a.x)+(this.MMatrix[4]*a.y))}}return a};Matrix.prototype.ApplyScale=function(a){return a*ScaleValue};Matrix.prototype.SetIdentity=function(){for(var b=0;b<this.mNumRows;++b){for(var a=0;a<this.mNumColumns;++a){if(a==b){this.MMatrix[b*this.mNumColumns+a]=1}else{this.MMatrix[b*this.mNumColumns+a]=0}}}};Matrix.prototype.GetNumRows=function(){return this.mNumRows};Matrix.prototype.GetNumColumns=function(){return this.mNumColumns};Matrix.prototype.GetSize=function(){return(this.mNumRows*this.mNumColumns)};Matrix.prototype.GetValue=function(b,a){return this.MMatrix[b*this.mNumColumns+a]};Matrix.prototype.SetValue=function(c,a,b){this.MMatrix[c*this.mNumColumns+a]=b};Matrix.prototype.GetTranslation=function(){if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==4)){return new Point(this.MMatrix[12],this.MMatrix[13],this.MMatrix[14])}else{if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==3)){return new Point(this.MMatrix[6],this.MMatrix[7])}}return new Point()};Matrix.prototype.GetRotation=function(){return this.mRotation};Matrix.prototype.GetScale=function(){return this.mScale};Matrix.prototype.GetDirection=function(){if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==4)){return new Point(this.MMatrix[8],this.MMatrix[9],this.MMatrix[10])}else{if((this.mNumRows==this.mNumColumns)&&(this.mNumRows==3)){return new Point(this.MMatrix[3],this.MMatrix[4])}}return new Point()};Matrix.prototype.GetEulerAngle=function(){var b=new Point();if((this.mNumRows==this.mNumColumns)&&(this.mNumRows>2)){var c=180/Math.PI;b.y=Math.Asin(this.MMatrix[2]);var d=Math.cos(b.y);b.y*=c;var a;var e;if(Math.abs(d)>0.005){a=this.MMatrix[10]/d;e=-this.MMatrix[6]/d;b.x=Math.atan2(e,a)*c;a=this.MMatrix[0]/d;e=-this.MMatrix[1]/d;b.z=Math.atan2(e,a)*c}else{b.x=0;a=this.MMatrix[5];e=this.MMatrix[4];b.z=Math.atan2(e,a)*c}if(b.x<-0.00001){b.x+=360}if(b.y<-0.00001){b.y+=360}if(b.z<-0.00001){b.z+=360}}return b};Matrix.prototype.GetDeterminant=function(){if(this.mNumRows==this.mNumColumns){return this.GetDeterminant(this,this.mNumRows)}return 0};Matrix.prototype.GetScaledMatrix=function(){var a=new Matrix(4,4);a.MMatrix[0]=this.mScale.x;a.MMatrix[5]=this.mScale.y;a.MMatrix[10]=this.mScale.z;return a.Multiply(this)};function ViewMatrix(){}ViewMatrix.Frustum=function(g,d,c,f,e,a){var b=new Matrix(4,4);b.MMatrix[0]=(2*e)/(d-g);b.MMatrix[1]=0;b.MMatrix[2]=0;b.MMatrix[3]=0;b.MMatrix[4]=0;b.MMatrix[5]=(2*e)/(f-c);b.MMatrix[6]=0;b.MMatrix[7]=0;b.MMatrix[8]=(d+g)/(d-g);b.MMatrix[9]=(f+c)/(f-c);b.MMatrix[10]=-(a+e)/(a-e);b.MMatrix[11]=-1;b.MMatrix[12]=0;b.MMatrix[13]=0;b.MMatrix[14]=-(2*a*e)/(a-e);b.MMatrix[15]=0;return b};ViewMatrix.Orthographic=function(e,a,d,b){var c=new Matrix(4,4);c.MMatrix[0]=1/e;c.MMatrix[1]=0;c.MMatrix[2]=0;c.MMatrix[3]=0;c.MMatrix[4]=0;c.MMatrix[5]=1/a;c.MMatrix[6]=0;c.MMatrix[7]=0;c.MMatrix[8]=0;c.MMatrix[9]=0;c.MMatrix[10]=-2/(b-d);c.MMatrix[11]=0;c.MMatrix[12]=0;c.MMatrix[13]=0;c.MMatrix[14]=-d/(b-d);c.MMatrix[15]=1;return c};ViewMatrix.OrthographicRect=function(g,d,c,f,e,a){var b=new Matrix(4,4);b.MMatrix[0]=2/(d-g);b.MMatrix[1]=0;b.MMatrix[2]=0;b.MMatrix[3]=0;b.MMatrix[4]=0;b.MMatrix[5]=2/(f-c);b.MMatrix[6]=0;b.MMatrix[7]=0;b.MMatrix[8]=0;b.MMatrix[9]=0;b.MMatrix[10]=-2/(a-e);b.MMatrix[11]=0;b.MMatrix[12]=-(d+g)/(d-g);b.MMatrix[13]=-(f+c)/(f-c);b.MMatrix[14]=-(a+e)/(a-e);b.MMatrix[15]=1;return b};ViewMatrix.Perspective=function(b,d,f,a){var h=f*Math.tan(b*(Math.PI/360));var c=-h;var g=c*d;var e=h*d;return this.Frustum(g,e,c,h,f,a)};ViewMatrix.ViewPort=function(b,e,d,a){var c=new Matrix(4,4);c.MMatrix[0]=d*0.5;c.MMatrix[1]=0;c.MMatrix[2]=0;c.MMatrix[3]=0;c.MMatrix[4]=0;c.MMatrix[5]=a*0.5;c.MMatrix[6]=0;c.MMatrix[7]=0;c.MMatrix[8]=0;c.MMatrix[9]=0;c.MMatrix[10]=1;c.MMatrix[11]=0;c.MMatrix[12]=b+d*0.5;c.MMatrix[13]=e+a*0.5;c.MMatrix[14]=0;c.MMatrix[15]=1;return c};ViewMatrix.Unproject=function(k,e,c,f,h,j,i){var b=f.SlowInverse().Multiply(h);var l=new Point((k.x/e)*2-1,-(((k.y/c)*2)-1),0,1);var a=b.PointMultiply(l);j.x=a.x/a.w;j.y=a.y/a.w;j.z=a.z/a.w;j.w=1;l.z=1;var g=b.PointMultiply(l);g.x=g.x/g.w;g.y=g.y/g.w;g.z=g.z/g.w;g.w=1;g=(g.Subtract(j)).Normalize();i.x=g.x;i.y=g.y;i.z=g.z};function ICommand(){}ICommand.prototype.Execute=function(a){};function EventDispatcher(a){this.EventName=a}EventDispatcher.prototype.Dispatch=function(){var a=Controller.GetAction(this.EventName);if(a!=null){a.Execute(this)}};function Controller(){}Controller.mControl=new Array();Controller.Set=function(b,a){this.mControl[b]=a};Controller.GetAction=function(a){return this.mControl[a]};Controller.GetCondition=function(b){for(var a in this.mControl.length){if(this.mControl[a]===b){return a}}return null};function HttpResponse(){this.StatusCode;this.ResponseText;this.State}HttpResponse.XmlDeserialize=function(xmlNode,object){for(var i=0;i<xmlNode.childNodes.length;++i){var child=xmlNode.childNodes.item(i);if(child.nodeType==1){var name=child.nodeName.replace(/:/g,"_");eval("if (typeof(object."+name+") == 'undefined') { object."+name+" = new Array(); }");if(child.childNodes.length>1){var subObject=new Array();xmlDeserialize(child,subObject);if((child.attributes!=null)&&(child.attributes.length>0)){subObject.attribute=new Object();for(var j=0;j<child.attributes.length;++j){eval("subObject.attribute."+child.attributes.item(j).name+"='"+child.attributes.item(j).value.replace(/\'/g,"\\'")+"'")}}else{subObject.attribute=null}eval("object."+name+"[object."+name+".length] = subObject")}else{eval("object."+name+"[object."+name+".length] = new Object()");if(child.childNodes.length==1){eval("object."+name+"[object.length].value = '"+child.childNodes.item(0).data.replace(/\'/g,"\\'")+"'")}else{eval("object."+name+"[object.length].value = null")}if((child.attributes!=null)&&(child.attributes.length>0)){eval("object."+name+"[object.length].attribute = new Object()");for(var j=0;j<child.attributes.length;++j){eval("object."+name+"[object.length].attribute."+child.attributes.item(j).name+"='"+child.attributes.item(j).value.replace(/\'/g,"\\'")+"'")}}else{eval("object."+name+"[object.length].attribute = null")}}}}};function HttpRequest(a){this.mHttp=null;this.mDelegate=a;this.Url=null}HttpRequest.Method={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT",DELETE:"DELETE",OPTIONS:"OPTIONS",TRACE:"TRACE",CONNECT:"CONNECT"};HttpRequest.prototype.OnHttpState=function(){if((this.readyState==4)&&(this.Delegate!=null)){var a=new HttpResponse();a.StatusCode=this.status;a.ResponseText=this.responseText;a.State=this.State;if(this.Delegate!=null){this.Delegate(this,a)}}};HttpRequest.prototype.SendRequest=function(d,c,f,e,g){this.Cancel();this.Url=c;this.mHttp=HttpRequest.CreateRequest();if(this.mHttp!=null){this.mHttp.open(d,c,true);if(d==HttpRequest.Method.POST){this.mHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}if(g&&this.mHttp.overrideMimeType){this.mHttp.overrideMimeType("text/plain; charset=x-user-defined")}this.mHttp.Delegate=this.mDelegate;this.mHttp.State=e;this.mHttp.onreadystatechange=this.OnHttpState;try{this.mHttp.send(f)}catch(b){if(this.mDelegate!=null){var a=new HttpResponse();a.StatusCode=b.code;a.State=e;this.mDelegate(this,a)}}}else{if(this.mDelegate!=null){this.mDelegate(this,new HttpResponse())}}};HttpRequest.prototype.Cancel=function(){if(this.mHttp!=null){this.mHttp.abort();this.mHttp=null}};HttpRequest.CreateRequest=function(){try{return new XMLHttpRequest()}catch(a){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return null}}}return null};function BoundingBox(a){this.Centre=(a!=null)?new Point(a.Centre.x,a.Centre.y,a.Centre.z):new Point();this.Extents=(a!=null)?new Point(a.Extents.x,a.Extents.y,a.Extents.z):new Point()}function Camera(){this.mProjection=new Matrix(4,4);this.mView=new Matrix(4,4);this.mOrthographic=false;this.mFOV=0;this.mWidth=0;this.mHeight=0;this.mNear=0;this.mFar=0}Camera.prototype.CreatePerspective=function(c,e,a,d,b){this.mProjection=ViewMatrix.Perspective(c,e/a,d,b);this.mOrthographic=false;this.mFOV=c;this.mWidth=e;this.mHeight=a;this.mNear=d;this.mFar=b};Camera.prototype.CreateOrthographic=function(d,a,c,b){this.mProjection=ViewMatrix.Orthographic(d,a,c,b);this.mOrthographic=true;this.mFOV=0;this.mWidth=d;this.mHeight=a;this.mNear=c;this.mFar=b};Camera.prototype.Translate=function(a,c,b){this.mView.Translate(a,c,b)};Camera.prototype.Rotate=function(a,c,b){this.mView.Rotate(a,c,b)};Camera.prototype.PointAt=function(b,c,a){this.mView.PointAt(b,c,a)};Camera.prototype.GetProjection=function(){return this.mProjection};Camera.prototype.SetProjection=function(a){this.mProjection=a};Camera.prototype.GetView=function(){return this.mView};Camera.prototype.SetView=function(a){this.mView=a};Camera.prototype.GetInverseView=function(){return this.mView.Inverse()};Camera.prototype.GetFrustum=function(){var a=new Frustum();a.Create(this.mProjection,this.mView.Inverse());return a};Camera.prototype.GetTranslation=function(){return this.mView.GetTranslation()};Camera.prototype.GetRotation=function(){return this.mView.GetRotation()};Camera.prototype.IsOrthographic=function(){return this.mOrthographic};Camera.prototype.GetFOV=function(){return this.mFOV};Camera.prototype.GetWidth=function(){return this.mWidth};Camera.prototype.GetHeight=function(){return this.mHeight};Camera.prototype.GetNear=function(){return this.mNear};Camera.prototype.GetFar=function(){return this.mFar};function Entity(a){this.Name=(a!=null)?a.Name:null;this.ObjectMaterial=(a!=null)?new Material(a.ObjectMaterial):new Material();this.ObjectMatrix=new Matrix(4,4);this.ObjectBoundingBox=new BoundingBox((a!=null)?a.ObjectBoundingBox:null);this.ObjectEntity=(a!=null)?a.ObjectEntity:null}Entity.Create=function(b){var a=new Entity();a.ObjectEntity=b;return a};function Light(){this.Enabled=true;this.LightType=Light.LightSourceType.Point;this.Position=new Point();this.Area=new Point();this.Samples=3;this.Attenuation=new Point(1,0,0);this.Direction=new Point();this.OuterCutoff=0;this.InnerCutoff=0;this.Exponent=1;this.Colour=new Point(1,1,1);this.CastShadow=true;this.SetCutoff(45,0)}Light.LightSourceType={Point:0,Area:1,Directional:2};Light.prototype.SetCutoff=function(b,a){if(a==null){a=0}this.OuterCutoff=Math.cos(b*(Math.PI/180));this.InnerCutoff=Math.cos(a*(Math.PI/180))};Light.prototype.AttenuationFactor=function(b){var a=Attenuation.x+(Attenuation.y*b)+(Attenuation.z*(b*b));if(a>0){return 1/a}return 1};Light.prototype.GetBoundingRadius=function(b){if(b==null){b=100}var a=Math.sqrt(Math.abs((this.Attenuation.y*this.Attenuation.y)-(4*this.Attenuation.z*(b-this.Attenuation.x))));return(-this.Attenuation.y+a)/(2*this.Attenuation.z)};function Material(a){this.Ka=(a!=null)?a.Ka:1;this.Ambient=(a!=null)?new Point(a.Ambient.x,a.Ambient.y,a.Ambient.z):new Point();this.Kd=(a!=null)?a.Kd:1;this.Diffuse=(a!=null)?new Point(a.Diffuse.x,a.Diffuse.y,a.Diffuse.z):new Point(0.8,0.8,0.8);this.Alpha=(a!=null)?a.Alpha:1;this.Ks=(a!=null)?a.Ks:1;this.Specular=(a!=null)?new Point(a.Specular.x,a.Specular.y,a.Specular.z):new Point();this.Ke=(a!=null)?a.Ke:1;this.Emission=(a!=null)?new Point(a.Emission.x,a.Emission.y,a.Emission.z):new Point();this.Shininess=(a!=null)?a.Shininess:1;this.velocity.x=(a!=null)?a.velocity.x:0;this.Refraction=(a!=null)?a.Refraction:0;this.CastShadow=(a!=null)?a.CastShadow:true;this.Shadow=(a!=null)?a.Shadow:1;this.Texture=(a!=null)?a.Texture:null;this.TextureOffset=(a!=null)?new Point(a.TextureOffset.x,a.TextureOffset.y,a.TextureOffset.z,a.TextureOffset.w):new Point();this.TextureScale=(a!=null)?new Point(a.TextureScale.x,a.TextureScale.y,a.TextureScale.z,a.TextureScale.w):new Point(1,1,1,1)}Material.prototype.GetColour=function(b,a){if(Texture!=null){return(Diffuse*Kd)*Texture.GetColour(b*TextureScale.x,a*TextureScale.y)}return Diffuse*Kd};function Shape(a){this.ObjectBoundingBox=new BoundingBox((a!=null)?a.ObjectBoundingBox:null)}function Texture(){this.mWidth=0;this.mHeight=0;this.mFormat=Texture.Rgba}Texture.Format={Rgba:0,Rgb:1,Dxt1:2,Dxt3:3,Dxt5:4,Rg32:5,Rgba64:6,Alpha8:7,Single:8,Vector2:9,Vector4:10,Depth:11,Depth16:12,Depth24:13,Depth32:14};Texture.prototype.GetWidth=function(){return this.mWidth};Texture.prototype.GetHeight=function(){return this.mHeight};Texture.prototype.GetFormat=function(){return this.mFormat};Texture.prototype.GetColour=function(b,a){return new Point()};function Sprite(a){this.mCurrentAnimation=null;this.mCurrentFrame=0;this.mTimer=new Timer();this.mTimer.OnTimer.Add(this.OnTimer,this);this.OnUpdate=new Event();this.OnAnimationEnd=new Event();this.Loop=(a!=null)?a.Loop:true;this.SpriteSheet=(a!=null)?a.SpriteSheet:null;this.SpriteTexture=(a!=null)?a.SpriteTexture:null;this.Scale=(a!=null)?new Point(a.Scale.x,a.Scale.y):new Point(1,1);this.Colour=(a!=null)?new Point(a.Colour.x,a.Colour.y,a.Colour.z,a.Colour.w):new Point(1,1,1,1);if(a!=null){this.mTimer.SetInterval(a.mTimer.GetInterval())}else{this.SetFrameRate(30)}}Sprite.prototype.OnTimer=function(){++this.mCurrentFrame;var a=(this.mCurrentAnimation!=null)?this.mCurrentAnimation.Frame.length:this.SpriteSheet.Frame.length;if(this.mCurrentFrame>=a){if(this.Loop){this.mCurrentFrame=0}else{this.mCurrentFrame=a;this.Stop();this.OnAnimationEnd.Dispatch(this.mCurrentAnimation?this.mCurrentAnimation.Name:"");return}}this.OnUpdate.Dispatch(this.mCurrentAnimation?this.SpriteSheet.Frame[this.mCurrentAnimation.Frame[this.mCurrentFrame]]:this.SpriteSheet.Frame[this.mCurrentFrame])};Sprite.prototype.SetFrame=function(b){if(typeof(b)=="number"){if(this.mCurrentAnimation!=null){if(b<this.mCurrentAnimation.Frame.length){this.mCurrentFrame=b;this.OnUpdate.Dispatch(this.SpriteSheet.Frame[this.mCurrentAnimation.Frame[this.mCurrentFrame]])}}else{if(b<this.SpriteSheet.Frame.length){this.mCurrentFrame=b;this.OnUpdate.Dispatch(this.SpriteSheet.Frame[this.mCurrentFrame])}}}else{if(typeof(b)=="string"){for(var a=0;a<this.SpriteSheet.Frame.length;++a){if(this.SpriteSheet.Frame[a].Name==b){this.SetFrame(a);break}}}}};Sprite.prototype.Play=function(b){if(b==null){b=0}if(typeof(b)=="number"){if(this.SpriteSheet.Frame.length>0){this.mCurrentFrame=b;if(this.mCurrentAnimation!=null){if(this.mCurrentFrame>this.mCurrentAnimation.Frame.length){this.mCurrentFrame=0}}else{if(this.mCurrentFrame>this.SpriteSheet.Frame.length){this.mCurrentFrame=0}}this.mTimer.Start();this.OnTimer()}}else{if(typeof(b)=="string"){this.mCurrentAnimation=0;for(var a=0;a<this.Animation.length;++a){if(this.Animation[a].Name==b){this.mCurrentAnimation=this.Animation[a];break}}if(this.mCurrentAnimation!=null){this.Loop=this.mCurrentAnimation.Loop;this.SetFrameRate(this.mCurrentAnimation.FrameRate);this.mCurrentFrame=0;this.mTimer.Start();this.OnTimer()}}}};Sprite.prototype.Stop=function(){this.mTimer.Stop()};Sprite.prototype.IsPlaying=function(){return this.mTimer.IsEnabled()};Sprite.prototype.GetCurrentAnimation=function(){return this.mCurrentAnimation};Sprite.prototype.GetCurrentFrame=function(){return this.SpriteSheet.GetFrame(this.mCurrentFrame)};Sprite.prototype.GetCurrentFrameIndex=function(){return this.mCurrentFrame};Sprite.prototype.GetFrameRate=function(){return this.SpriteSheet.FrameRate};Sprite.prototype.SetFrameRate=function(a){if(this.SpriteSheet){this.SpriteSheet.FrameRate=a}if(a!=0){this.mTimer.SetInterval(1/a)}};function BitmapFont(a){Sprite.call(this,a);this.Kern=((a!=null)&&(a.Kern!=null))?a.Kern:0;this.Lead=((a!=null)&&(a.Lead!=null))?a.Lead:0;this.Passworded=((a!=null)&&(a.Passworded!=null))?a.Passworded:false;this.PasswordChr=((a!=null)&&(a.PasswordChr!=null))?a.PasswordChr:"*";this.TextHorizontalAlignment=((a!=null)&&(a.TextHorizontalAlignment!=null))?a.TextHorizontalAlignment:0;this.TextVerticalAlignment=((a!=null)&&(a.TextVerticalAlignment!=null))?a.TextVerticalAlignment:0;this.mSrcRect=new Point();this.mDstRect=new Point();this.mOrigin=new Point(0,0)}BitmapFont.prototype=new Sprite();BitmapFont.prototype.constructor=BitmapFont;BitmapFont.prototype.GetHorizontalAlignment=function(d,a,b){if(this.TextHorizontalAlignment==1){var c=this.GetWidthText(d,b);if(c<b){return(a+((b-c)*0.5))}}else{if(this.TextHorizontalAlignment==2){var c=this.GetWidthText(d,b);if(c<b){return(a+(b-c)-1)}}}return a};BitmapFont.prototype.GetVerticalAlignment=function(c,d,a,b){if(this.TextVerticalAlignment==1){return d+(b*0.5)-(this.GetHeightText(c,a)*0.5)}else{if(this.TextVerticalAlignment==2){return d+b-this.GetHeightText(c,a)}}return d};BitmapFont.prototype.GetWidth=function(a){var b=this.SpriteSheet.GetFrame(a);if(b!=null){return b.Width*this.Scale.x}return 0};BitmapFont.prototype.GetWidthText=function(f,d){var c=0;var e;var a;for(var b=0;b<f.length;++b){if(f[b]=="\n"){break}if(d>0){e=0;if(f[b]==" "){e+=this.GetWidth(f.charCodeAt(b))+this.Kern}else{for(a=b;a<f.length;++a){if((f[a]==" ")||(f[a]=="\n")){--a;break}e+=this.GetWidth(f.charCodeAt(a))+this.Kern}b=a}if((c+e)>d){return c}c+=e}else{c+=this.GetWidth(f.charCodeAt(b))+this.Kern}}return c};BitmapFont.prototype.GetHeight=function(a){var b=this.SpriteSheet.GetFrame(a);if(b!=null){return b.Height*this.Scale.y}return 0};BitmapFont.prototype.GetHeightText=function(g,e){var a=this.GetHeight(0);var d=0;var f;var b;for(var c=0;c<g.length;++c){if(g[c]=="\n"){d=0;a+=this.GetHeight(0)+this.Lead}else{if(e>0){d+=this.GetWidth(g.charCodeAt(c))+this.Kern;if(d>e){d=0;a+=this.GetHeight(0)+this.Lead}else{if(g[c]==" "){f=0;for(b=c+1;b<g.length;++b){if((g[b]==" ")||(g[b]=="\n")){break}f+=this.GetWidth(g.charCodeAt(b))+this.Kern}if((d+f)>e){d=0;a+=this.GetHeight(0)+this.Lead}else{d+=f}c=b-1}}}}}return a};BitmapFont.prototype.GetMaxWidth=function(d){var c=0;var b=0;for(var a=0;a<d.length;++a){if(d[a]=="\n"){if(b>c){c=b}b=0}else{b+=this.GetWidth(d.charCodeAt(a))+this.Kern}}return(b>c)?b:c};BitmapFont.prototype.Draw=function(o,b,k){if(o!=null){var A=0;var a=0;var n=b.z;var t=b.w;if((n==0)&&(this.TextHorizontalAlignment!=0)){n=this.GetMaxWidth(o)}var g=0;var e=o.length;var m=0;var l=0;var v=m;var d=l;var u=v+n;var c=d+t;var p=new Point();var f=this.SpriteSheet.GetFrame(0);if(f!=null){p.x=f.Width;p.y=f.Height}if(n<=p.x){u=8388607}else{m=this.GetHorizontalAlignment(o,v,n)}if(t<=p.y){c=8388607}else{l=this.GetVerticalAlignment(o,d,n,t)}p.y=this.GetHeight(0);if(this.Passworded){g=this.PasswordChr.charCodeAt(0);p.x=this.GetWidth(g)}for(var s=0;s<e;++s){if(!this.Passworded){g=o.charCodeAt(s);p.x=this.GetWidth(g);if(o[s]=="\n"){m=this.GetHorizontalAlignment(o.substring(s+1),v,n);l+=p.y+this.Lead;if((l+p.y)>c){break}continue}else{if((o[s]==" ")&&((s+1)<e)&&(o[s+1]!="\n")){var q=0;for(var r=s+1;r<e;++r){if((o[r]==" ")||(o[r]=="\n")){break}q+=this.GetWidthText(o[r],0)}if((m+q)>u){m=u}}}}f=this.SpriteSheet.GetFrame(g);if(f!=null){if(f.X!=-1){this.mSrcRect.x=f.X;this.mSrcRect.y=f.Y;this.mSrcRect.z=f.Width;this.mSrcRect.w=f.Height;this.mDstRect.x=b.x+m;this.mDstRect.y=b.y+l;this.mDstRect.z=f.Width*this.Scale.x;this.mDstRect.w=f.Height*this.Scale.y;k.DrawImage(this.SpriteTexture,this.mSrcRect,this.mDstRect,this.mOrigin,0,this.Colour)}if((m+f.Width)>A){A=m+f.Width}if((l+f.Height)>a){a=l+f.Height}m+=p.x+this.Kern;if(m>u){m=this.GetHorizontalAlignment(o.substring(s+1),v,n);l+=p.y+this.Lead;if((l+p.y)>c){break}if(((s+1)<e)&&(o[s+1]==" ")){++s}}}}}};function GraphicsContext(){this.mViewport=new Point();this.mViewportScale=new Point(1,1)}GraphicsContext.prototype.GetViewport=function(){return this.mViewport};GraphicsContext.prototype.SetViewport=function(b,a){this.mViewport.z=b;this.mViewport.w=a};GraphicsContext.prototype.GetViewportScale=function(){return this.mViewportScale};GraphicsContext.prototype.SetViewportScale=function(a,b){this.mViewportScale.x=a;this.mViewportScale.y=b};GraphicsContext.prototype.Clear=function(a){};GraphicsContext.prototype.DrawImage=function(c,e,f,a,b,d){if(e==null){e=new Point(0,0,c.GetWidth(),c.GetHeight())}if(a==null){a=new Point(0,0)}if(b==null){b=0}if(d==null){d=new Point(1,1,1,1)}};GraphicsContext.prototype.DrawSprite=function(d,a,b,c){var e=d.GetCurrentFrame();if(e){this.DrawImage(d.SpriteTexture,new Point(e.X,e.Y,e.Width,e.Height),new Point(a.x,a.y,e.Width*d.Scale.x,e.Height*d.Scale.y),b,c,d.Colour)}};GraphicsContext.prototype.DrawText=function(a,b,c){a.Draw(b,c,this)};function Vertex(){this.VertexPoint=new Point();this.UV=new Point();this.Normal=new Point();this.Colour=new Point()}function Polygon(b){Shape.call(this,b);this.VertexPoint=null;this.UV=null;this.Normal=null;this.Colour=null;this.Bone=null;this.BoneWeight=null;this.mNumBonePerVertex=(b!=null)?b.mNumBonePerVertex:0;if((b!=null)&&(b.VertexPoint!=null)){this.Create(b.VertexPoint.length/3);for(var a=0;a<this.VertexPoint.length;++a){this.VertexPoint[a]=b.VertexPoint[a]}if(b.Normal!=null){for(var a=0;a<this.Normal.length;++a){this.Normal[a]=b.Normal[a]}}else{this.Normal=null}if(b.UV!=null){for(var a=0;a<this.UV.length;++a){this.UV[a]=b.UV[a]}}else{this.UV=null}if(b.Colour!=null){this.Colour=new Float32Array(b.Colour.length);for(var a=0;a<this.Colour.length;++a){this.Colour[a]=b.Colour[a]}}if((b.Bone!=null)&&(b.BoneWeight!=null)){this.Bone=new Array(b.Bone.length);this.BoneWeight=new Float32Array(b.BoneWeight.length);for(var a=0;a<this.Bone.length;++a){this.Bone[a]=b.Bone[a];this.BoneWeight[a]=b.BoneWeight[a]}}}}Polygon.prototype=new Shape();Polygon.prototype.constructor=Polygon;Polygon.prototype.Create=function(a){this.VertexPoint=new Float32Array(a*3);this.UV=new Float32Array(a*2);this.Normal=new Float32Array(a*3)};Polygon.prototype.CreatePlanarUV=function(b){if(this.VertexPoint!=null){var c=VertexPoint.length;var h=new Point();var g=new Point();this.GetBoundingBox(h,g);var e=h.Subtract(g);var a=g.Multiply(new Point(2,2,2));var f=0;for(var d=0;d<c;d+=3){if(b==0){if(this.Normal[d+2]>0){this.UV[f]=((this.VertexPoint[d]-e.x)/a.x)}else{this.UV[f]=1-((this.VertexPoint[d]-e.x)/a.x)}this.UV[f+1]=(this.VertexPoint[d+1]-e.y)/a.y}else{if(b==1){if(this.Normal[d]>0){this.UV[f]=((this.VertexPoint[d+1]-e.y)/a.y)}else{this.UV[f]=1-((this.VertexPoint[d+1]-e.y)/a.y)}this.UV[f+1]=(this.VertexPoint[d+2]-e.z)/a.z}else{if(b==2){if(this.Normal[d+1]>0){this.UV[f]=((this.VertexPoint[d]-e.x)/a.x)}else{this.UV[f]=1-((this.VertexPoint[d]-e.x)/a.x)}this.UV[f+1]=(this.VertexPoint[d+2]-e.z)/a.z}}}f+=2}}};Polygon.prototype.CreateBones=function(b){this.mNumBonePerVertex=b;this.Bone=new Uint16Array((this.VertexPoint.length/3)*this.mNumBonePerVertex);this.BoneWeight=new Float32Array(this.Bone.length);for(var a=0;a<this.Bone.length;++a){this.Bone[a]=0;this.BoneWeight[a]=0}};Polygon.prototype.GetBoundingBox=function(f,e){if(this.VertexPoint!=null){var d=Point.Length;var c=new Point(1000000,1000000,1000000);var a=new Point(-1000000,-1000000,-1000000);for(var b=0;b<d;b+=3){if(this.VertexPoint[b]<c.x){c.x=this.VertexPoint[b]}if(this.VertexPoint[b]>a.x){a.x=this.VertexPoint[b]}if(this.VertexPoint[b+1]<c.y){c.y=this.VertexPoint[b+1]}if(this.VertexPoint[b+1]>a.y){a.y=this.VertexPoint[b+1]}if(this.VertexPoint[b+2]<c.z){c.z=this.VertexPoint[b+2]}if(this.VertexPoint[b+2]>a.z){a.z=this.VertexPoint[b+2]}}f.x=(c.x+a.x)*0.5;f.y=(c.y+a.y)*0.5;f.z=(c.z+a.z)*0.5;e.x=a.x-f.x;e.y=a.y-f.y;e.z=a.z-f.z}};Polygon.prototype.SetOrigin=function(a){if(this.VertexPoint!=null){for(var b=0;b<this.VertexPoint.length;b+=3){this.VertexPoint[b]+=a.x;this.VertexPoint[b+1]+=a.y;this.VertexPoint[b+2]+=a.z}}};Polygon.prototype.GetPoint=function(a){a*=3;if((a+2)<this.VertexPoint.length){return new Point(this.VertexPoint[a],this.VertexPoint[a+1],this.VertexPoint[a+2])}return null};Polygon.prototype.SetPoint=function(b,a){b*=3;if((b+2)<this.VertexPoint.length){this.VertexPoint[b]=a.x;this.VertexPoint[b+1]=a.y;this.VertexPoint[b+2]=a.z}};Polygon.prototype.GetUV=function(a){a*=2;if((a+1)<this.UV.length){return new Point(this.UV[a],this.UV[a+1])}return null};Polygon.prototype.SetUV=function(a,b){a*=2;if((a+1)<this.UV.length){this.UV[a]=b.x;this.UV[a+1]=b.y}};Polygon.prototype.GetNormal=function(){if(this.VertexPoint.length>=9){var d=this.GetPoint(0);var b=this.GetPoint(1);var a=this.GetPoint(2);var e=b.Subtract(d);var c=d.Subtract(a);return e.Cross(c).Normalize()}return null};Polygon.prototype.GetNormal=function(a){a*=3;if((a+2)<this.Normal.length){return new Point(this.Normal[a],this.Normal[a+1],this.Normal[a+2])}return null};Polygon.prototype.GetVertex=function(a){var b=new Vertex();b.Point=this.GetPoint(a);b.UV=this.GetUV(a);b.Normal=this.GetNormal(a);return b};Polygon.prototype.SetNormal=function(a,b){a*=3;if((a+2)<this.Normal.length){this.Normal[a]=b.x;this.Normal[a+1]=b.y;this.Normal[a+2]=b.z}};Polygon.prototype.SetVertex=function(b,a,d,e){var c=b*2;b*=3;if(b<this.VertexPoint.length){this.VertexPoint[b]=a.x;this.VertexPoint[b+1]=a.y;this.VertexPoint[b+2]=a.z;this.UV[c]=d.x;this.UV[c+1]=d.y;this.Normal[b]=e.x;this.Normal[b+1]=e.y;this.Normal[b+2]=e.z}};Polygon.prototype.GetNumPoints=function(){return(this.VertexPoint!=null)?this.VertexPoint.length/3:0};Polygon.prototype.GetNumUv=function(){return(this.UV!=null)?this.UV.length:0};Polygon.prototype.GetNumColour=function(){return(this.Colour!=null)?this.Colour.length:0};Polygon.prototype.GetNumBone=function(){return(this.Bone!=null)?this.Bone.length:0};Polygon.prototype.GetNumBonePerVertex=function(){return this.mNumBonePerVertex};function PolygonGroup(){this.Name=null;this.StartIndex=0;this.Count=0;this.ObjectMaterial=null}function PolygonMesh(b){Polygon.call(this,b);this.Index=null;this.Edge=null;this.Group=new Array();if(b!=null){if(b.Index!=null){this.Index=new Uint16Array(b.Index.length);for(var a=0;a<this.Index.length;++a){this.Index[a]=b.Index[a]}}for(var a=0;a<b.Group.length;++a){this.Group.push(b.Group[a])}}}PolygonMesh.prototype=new Polygon();PolygonMesh.prototype.constructor=PolygonMesh;PolygonMesh.prototype.Create=function(a,b){Polygon.prototype.Create.call(this,a);if(b>0){this.Index=new Uint16Array(b)}else{this.Index=null}};PolygonMesh.prototype.CreatePlanarUV=function(e,k,g){if((this.VertexPoint!=null)&&this.Index){if(k==null){k=0}if(g==null){g=this.Index.length}var d=k+g;if(d>this.Index.length){d=this.Index.length}var a=new Point();var j=new Point();this.GetBoundingBox(a,j,k,g);var b=a.Subtract(j);var h=j.Multiply(new Point(2,2,2));var f=0;var l=0;for(var c=k;c<d;++c){f=this.Index[c]*3;l=this.Index[c]*2;if(e==0){if(this.Normal[f+2]>0){this.UV[l+0]=((this.VertexPoint[f+0]-b.x)/h.x)}else{this.UV[l+0]=1-((this.VertexPoint[f+0]-b.x)/h.x)}this.UV[l+1]=(this.VertexPoint[f+1]-b.y)/h.y}else{if(e==1){if(this.Normal[f]>0){this.UV[l]=((this.VertexPoint[f+1]-b.y)/h.y)}else{this.UV[l]=1-((this.VertexPoint[f+1]-b.y)/h.y)}this.UV[l+1]=(this.VertexPoint[f+2]-b.z)/h.z}else{if(e==2){if(this.Normal[f+1]>0){this.UV[l]=((this.VertexPoint[f]-b.x)/h.x)}else{this.UV[l]=1-((this.VertexPoint[f]-b.x)/h.x)}this.UV[l+1]=(this.VertexPoint[f+2]-b.z)/h.z}}}}}};PolygonMesh.prototype.CreateNormals=function(){var g=0;if(this.Index!=null){g=this.Index.length}else{g=this.GetNumPoints()*3}var m=this.GetNumPoints()*3;for(var d=0;d<m;++d){this.Normal[d]=0}for(var d=0;d<g;d+=3){var c=this.GetIndex(d);var b=this.GetIndex(d+1);var a=this.GetIndex(d+2);var n=this.GetPoint(c);var l=this.GetPoint(b);var k=this.GetPoint(a);var j=n.Subtract(l);var h=l.Subtract(k);var f=j.Cross(h);this.SetNormal(c,this.GetNormal(c).Add(f));this.SetNormal(b,this.GetNormal(b).Add(f));this.SetNormal(a,this.GetNormal(a).Add(f))}for(var d=0;d<g;++d){var e=this.GetIndex(d);this.SetNormal(e,this.GetNormal(e).Normalize())}};PolygonMesh.prototype.CreateEdges=function(){this.Edge=null;if(this.Index!=null){this.Edge=new Array();var g=false;var f=0;var d=0;for(var c=0;c<this.Index.length;c+=3){for(var b=0;b<3;++b){f=c+b;d=(b==2)?c:f+1;g=false;for(var a=0;a<this.Edge.length;++a){if((this.Edge[a].VertexIndex[0]==this.Index[d])&&(this.Edge[a].VertexIndex[1]==this.Index[f])){if(this.Edge[a].FaceIndex[1]==-1){this.Edge[a].FaceIndex[1]=f;g=true}break}else{if((this.Edge[a].VertexIndex[0]==this.Index[f])&&(this.Edge[a].VertexIndex[1]==this.Index[d])){if(this.Edge[a].FaceIndex[1]==-1){this.Edge[a].FaceIndex[1]=d;g=true}break}}}if(!g){var e=new PolygonEdge();e.FaceIndex[0]=f;e.VertexIndex[0]=this.Index[f];e.VertexIndex[1]=this.Index[d];this.Edge.push(e)}}}}};PolygonMesh.prototype.WeldVertices=function(e){if(e==null){e=0.00001}var c=0;for(var b=0;b<this.Index.length;++b){var d=this.GetPoint(this.Index[b]);for(var a=(b+1);a<this.Index.length;++a){if((this.Index[b]!=this.Index[a])&&(d.Distance(this.GetPoint(this.Index[a]))<e)){this.Index[a]=this.Index[b];++c}}}return c};PolygonMesh.prototype.GetBoundingBox=function(a,h,j,f){if((this.VertexPoint!=null)&&(this.Index!=null)){if(j==null){j=0}if(f==null){f=this.Index.length}var d=j+f;if(d>this.Index.length){d=this.Index.length}var b=new Point(1000000,1000000,1000000);var g=new Point(-1000000,-1000000,-1000000);for(var c=j;c<d;++c){var e=this.Index[c]*3;if(this.VertexPoint[e+0]<b.x){b.x=this.VertexPoint[e+0]}if(this.VertexPoint[e+0]>g.x){g.x=this.VertexPoint[e+0]}if(this.VertexPoint[e+1]<b.y){b.y=this.VertexPoint[e+1]}if(this.VertexPoint[e+1]>g.y){g.y=this.VertexPoint[e+1]}if(this.VertexPoint[e+2]<b.z){b.z=this.VertexPoint[e+2]}if(this.VertexPoint[e+2]>g.z){g.z=this.VertexPoint[e+2]}}a.x=(b.x+g.x)*0.5;a.y=(b.y+g.y)*0.5;a.z=(b.z+g.z)*0.5;h.x=g.x-a.x;h.y=g.y-a.y;h.z=g.z-a.z}};PolygonMesh.prototype.GetIndex=function(a){if(this.Index!=null){return this.Index[a]}return a};PolygonMesh.prototype.GetPolygon=function(b,f){var d=new Polygon();d.Create(f);for(var c=0;c<f;++c){var g;var a;if(this.Index!=null){g=this.Index[b+c]*3;a=this.Index[b+c]*2}else{g=(b+c)*3;a=(b+c)*2}var h=c*3;var e=c*2;d.VertexPoint[h]=this.VertexPoint[g];d.VertexPoint[h+1]=this.VertexPoint[g+1];d.VertexPoint[h+2]=this.VertexPoint[g+2];d.UV[e]=this.UV[a];d.UV[e+1]=this.UV[a+1];d.Normal[h]=this.Normal[g];d.Normal[h+1]=this.Normal[g+1];d.Normal[h+2]=this.Normal[g+2]}return d};PolygonMesh.prototype.SetPolygon=function(b,d){for(var c=0;c<d.NumPoints;++c){var f=c*3;var a=c*2;var g;var e;if(this.Index!=null){g=this.Index[b+c]*3;e=this.Index[b+c]*2}else{g=(b+c)*3;e=(b+c)*2}this.VertexPoint[g]=d.VertexPoint[f];this.VertexPoint[g+1]=d.VertexPoint[f+1];this.VertexPoint[g+2]=d.VertexPoint[f+2];this.UV[e]=d.UV[a];this.UV[e+1]=d.UV[a+1];this.Normal[g]=d.Normal[f];this.Normal[g+1]=d.Normal[f+1];this.Normal[g+2]=d.Normal[f+2]}};PolygonMesh.prototype.GetNumIndices=function(){return(this.Index!=null)?this.Index.length:0};PolygonMesh.prototype.GetNumEdges=function(){return(this.Edge!=null)?this.Edge.length:0};function Cube(a,e,d){PolygonMesh.call(this);this.Create(8+2+2,12*3);this.SetPoint(0,new Point(-a,-e,-d));this.SetPoint(1,new Point(a,-e,-d));this.SetPoint(2,new Point(a,e,-d));this.SetPoint(3,new Point(-a,e,-d));this.SetPoint(4,new Point(-a,-e,d));this.SetPoint(5,new Point(a,-e,d));this.SetPoint(6,new Point(a,e,d));this.SetPoint(7,new Point(-a,e,d));this.SetPoint(8,new Point(-a,e,d));this.SetPoint(9,new Point(a,e,d));this.SetPoint(10,new Point(-a,-e,d));this.SetPoint(11,new Point(a,-e,d));this.SetUV(0,new Point(0,0));this.SetUV(1,new Point(1,0));this.SetUV(2,new Point(1,1));this.SetUV(3,new Point(0,1));this.SetUV(4,new Point(1,0));this.SetUV(5,new Point(0,0));this.SetUV(6,new Point(0,1));this.SetUV(7,new Point(1,1));this.SetUV(8,new Point(0,0));this.SetUV(9,new Point(1,0));this.SetUV(10,new Point(0,1));this.SetUV(11,new Point(1,1));this.Index[0]=0;this.Index[6]=0;this.Index[12]=0;this.Index[18]=5;this.Index[24]=5;this.Index[30]=9;this.Index[1]=3;this.Index[7]=4;this.Index[13]=1;this.Index[19]=6;this.Index[25]=1;this.Index[31]=2;this.Index[2]=2;this.Index[8]=7;this.Index[14]=11;this.Index[20]=7;this.Index[26]=2;this.Index[32]=3;this.Index[3]=2;this.Index[9]=7;this.Index[15]=11;this.Index[21]=7;this.Index[27]=2;this.Index[33]=3;this.Index[4]=1;this.Index[10]=3;this.Index[16]=10;this.Index[22]=4;this.Index[28]=6;this.Index[34]=8;this.Index[5]=0;this.Index[11]=0;this.Index[17]=0;this.Index[23]=5;this.Index[29]=5;this.Index[35]=9;for(var b=0;b<12;++b){var c=this.GetPoint(b);c.x=(c.x<0)?-1:1;c.y=(c.y<0)?-1:1;c.z=(c.z<0)?-1:1;this.SetNormal(b,c.Normalize())}}Cube.prototype=new PolygonMesh();Cube.prototype.constructor=Cube;function Rectangle(a,b){PolygonMesh.call(this);this.Create(4,6);this.SetPoint(0,new Point(-a,-b));this.SetPoint(1,new Point(a,-b));this.SetPoint(2,new Point(a,b));this.SetPoint(3,new Point(-a,b));this.SetUV(0,new Point(0,0));this.SetUV(1,new Point(1,0));this.SetUV(2,new Point(1,1));this.SetUV(3,new Point(0,1));this.Index[0]=0;this.Index[1]=1;this.Index[2]=2;this.Index[3]=2;this.Index[4]=3;this.Index[5]=0;this.CreateNormals()}Rectangle.prototype=new PolygonMesh();Rectangle.prototype.constructor=Rectangle;function ImageTexture(){Texture.call(this);this.Texture=null}ImageTexture.prototype=new Texture();ImageTexture.prototype.constructor=ImageTexture;function SpriteFrame(c,b,e,d,a){this.Name=c;this.X=b;this.Y=e;this.Width=d;this.Height=a}function SpriteAnimation(){this.Name=null;this.Frame=new Array();this.FrameRate=30;this.Loop=false}function SpriteSheet(a){this.FrameRate=(a!=null)?a.FrameRate:30;this.Animation=(a!=null)?a.Animation:new Array();this.Frame=(a!=null)?a.Frame:new Array()}SpriteSheet.prototype.Import=function(s){this.Clear();this.FrameRate=s.GetAttributeValueDouble("fps");for(var u=0;u<s.GetNumChildren();++u){var g=s.GetChildAt(u);if(g.Name=="frame"){var E=g.GetAttributeValue("name");var n=g.GetAttributeValueInt("x");var m=g.GetAttributeValueInt("y");var o=g.GetAttributeValueInt("w");var v=g.GetAttributeValueInt("h");var C=g.GetAttribute("array");if(C!=null){var j=C.Value.IndexOf(",");if(j!=-1){var c=parseInt(C.Value.substring(0,j));var a=parseInt(C.Value.substring(j+1));for(var b=0;b<a;++b){var l=b*v;for(var d=0;d<c;++d){this.AddFrame(new SpriteFrame("",d*o,l,o,v))}}}}else{this.AddFrame(new SpriteFrame(E,n,m,o,v))}}else{if(g.Name=="animation"){var p=g.GetAttributeValue("frames");if(p.length>0){var B=new SpriteAnimation();B.Name=g.GetAttributeValue("name");B.FrameRate=g.GetAttributeValueDouble("fps");B.Loop=g.GetAttributeValueBool("loop");var j=0;var A=0;var D=0;var q=p.length;do{j=p.IndexOf(",",j);if(j==-1){j=p.length}var r=p.substring(A,j-A);if((D=r.indexOf("-"))!=-1){var f=parseInt(r.substring(0,D));var e=parseInt(r.substring(D+1));for(var t=f;t<=e;++t){B.Frame.Add(t)}}else{B.Frame.Add(parseInt(r))}++j;A=j}while(j<q);this.AddAnimation(B)}}}}};SpriteSheet.prototype.AddFrame=function(a){this.Frame.push(a)};SpriteSheet.prototype.AddAnimation=function(a){this.Animation.Add(a)};SpriteSheet.prototype.GetFrame=function(b){if(typeof(b)=="number"){if(b<this.Frame.length){return this.Frame[b]}}else{if(typeof(b)=="string"){for(var a=0;a<this.Frame.length;++a){if(this.Frame[a].Name==b){return this.Frame[a]}}}}return null};SpriteSheet.prototype.Clear=function(){this.Animation=new Array();this.Frame=new Array()};HorizontalAlignment={Left:0,Centre:1,Right:2,Stretch:3};VerticalAlignment={Top:0,Centre:1,Bottom:2,Stretch:3};Orientation={Horizontal:0,Vertical:1,Both:2};function UIElement(a){this.OnDataContextChangedEvent=new Event();this.OnHasFocus=new Event();this.OnKeyDown=new Event();this.OnKeyUp=new Event();this.OnLostFocus=new Event();this.OnMouseEnter=new Event();this.OnMouseLeave=new Event();this.OnMouseLeftButtonDown=new Event();this.OnMouseLeftButtonUp=new Event();this.OnMouseMove=new Event();this.OnMouseWheel=new Event();this.OnSizeChanged=new Event();this.DataContext=(a!=null)?a.DataContext:null;this.DesiredSize=new Point();this.RenderPosition=new Point();this.RenderSize=new Point();this.IsEnabled=(a!=null)?a.IsEnabled:true;this.IsVisible=(a!=null)?a.IsVisible:true;this.HorizontalAlignmentType=(a!=null)?a.HorizontalAlignmentType:HorizontalAlignment.Left;this.Margin=(a!=null)?a.Margin:new Point();this.MaxSize=(a!=null)?a.MaxSize:new Point();this.MinSize=(a!=null)?a.MinSize:new Point();this.Name=(a!=null)?a.Name:null;this.Opacity=(a!=null)?a.Opacity:1;this.Parent=(a!=null)?a.Parent:null;this.Origin=(a!=null)?a.Origin:new Point();this.Position=(a!=null)?a.Position:new Point();this.Rotation=(a!=null)?a.Rotation:new Point();this.Size=(a!=null)?a.Size:new Point();this.VerticalAlignmentType=(a!=null)?a.VerticalAlignmentType:VerticalAlignment.Top;this.mCurrentFocus=null;this.mMouseOver=false}UIElement.prototype.Clone=function(){return new UIElement(this)};UIElement.prototype.SetFocus=function(a){if(this.Parent){this.Parent.SetFocus(a)}else{if(this.mCurrentFocus!=null){this.mCurrentFocus.LostFocus()}this.mCurrentFocus=a;if(this.mCurrentFocus!=null){this.mCurrentFocus.HasFocus()}}};UIElement.prototype.GetFocus=function(){return this.mCurrentFocus};UIElement.prototype.HasFocus=function(){this.OnHasFocus.Dispatch(this)};UIElement.prototype.LostFocus=function(){this.OnLostFocus.Dispatch(this)};UIElement.prototype.InvalidateMeasure=function(){if(this.Parent!=null){this.Parent.InvalidateMeasure()}};UIElement.prototype.Measure=function(a){this.DesiredSize.x=(this.Size.x>0)?this.Size.x:(this.HorizontalAlignmentType==HorizontalAlignment.Stretch)?a.x:(this.Margin.x+this.Margin.z);this.DesiredSize.y=(this.Size.y>0)?this.Size.y:(this.VerticalAlignmentType==VerticalAlignment.Stretch)?a.y:(this.Margin.y+this.Margin.w);if((this.MinSize.x>0)&&(this.DesiredSize.x<this.MinSize.x)){this.DesiredSize.x=this.MinSize.x}else{if((this.MaxSize.x>0)&&(this.DesiredSize.x>this.MaxSize.x)){this.DesiredSize.x=this.MaxSize.x}}if((this.MinSize.y>0)&&(this.DesiredSize.y<this.MinSize.y)){this.DesiredSize.y=this.MinSize.y}else{if((this.MaxSize.y>0)&&(this.DesiredSize.y>this.MaxSize.y)){this.DesiredSize.y=this.MaxSize.y}}};UIElement.prototype.InvalidateArrange=function(){if(this.Parent!=null){this.Parent.InvalidateArrange()}};UIElement.prototype.Arrange=function(a){this.RenderSize.x=(this.DesiredSize.x>0)?((this.DesiredSize.x<a.x)?this.DesiredSize.x:a.x):a.x;this.RenderSize.y=(this.DesiredSize.y>0)?((this.DesiredSize.y<a.y)?this.DesiredSize.y:a.y):a.y;this.RenderSize.x-=(this.Margin.x+this.Margin.z);this.RenderSize.y-=(this.Margin.y+this.Margin.w)};UIElement.prototype.UpdateLayout=function(){this.InvalidateMeasure();this.InvalidateArrange()};UIElement.prototype.KeyDown=function(a){this.OnKeyDown.Dispatch(this,a)};UIElement.prototype.KeyUp=function(a){this.OnKeyUp.Dispatch(this,a)};UIElement.prototype.MouseEnter=function(){this.OnMouseEnter.Dispatch(this)};UIElement.prototype.MouseLeave=function(){this.OnMouseLeave.Dispatch(this)};UIElement.prototype.MouseLeftButtonDown=function(a){this.OnMouseLeftButtonDown.Dispatch(this,a)};UIElement.prototype.MouseLeftButtonUp=function(a){this.OnMouseLeftButtonUp.Dispatch(this,a)};UIElement.prototype.MouseMove=function(a){var b=this.IsPointInside(a);if(!this.mMouseOver&&b){this.mMouseOver=true;this.MouseEnter()}else{if(this.mMouseOver&&!b){this.mMouseOver=false;this.MouseLeave()}}this.OnMouseMove.Dispatch(this,a)};UIElement.prototype.MouseWheel=function(a){this.OnMouseWheel.Dispatch(this,a)};UIElement.prototype.SetDataContext=function(a){this.DataContext=a;this.OnDataContextChangedEvent.Dispatch(this,this.DataContext)};UIElement.prototype.Focus=function(){this.SetFocus(this)};UIElement.prototype.SetSize=function(b,a){var c=new Point(this.Size.x,this.Size.y);this.Size.x=b;this.Size.y=a;this.OnSizeChanged.Dispatch(this,this.Size,c)};UIElement.prototype.GetAbsoluteOpacity=function(){return((this.Parent!=null)?this.Opacity*this.Parent.GetAbsoluteOpacity():this.Opacity)};UIElement.prototype.IsPointInside=function(a){return((a.x>=this.RenderPosition.x)&&(a.x<=(this.RenderPosition.x+this.RenderSize.x))&&(a.y>=this.RenderPosition.y)&&(a.y<=(this.RenderPosition.y+this.RenderSize.y)))};UIElement.prototype.FindChild=function(a){if(this.Name==a){return this}return null};UIElement.prototype.FindChildByPoint=function(a){if(this.IsPointInside(a)){return this}return null};UIElement.prototype.Render=function(a){};function DataTemplate(){this.Content=null}DataTemplate.prototype.Create=function(b){if(this.Content!=null){var a=this.Content.Clone();a.SetDataContext(b);return a}return null};Frame=function(a){UIElement.call(this,a)};Frame.prototype=new UIElement();Frame.prototype.constructor=Frame;Frame.prototype.Clone=function(){return new Frame(this)};ImageUI=function(a){UIElement.call(this,a)};ImageUI.prototype=new UIElement();ImageUI.prototype.constructor=ImageUI;ImageUI.prototype.Clone=function(){return new ImageUI(this)};function Label(a){UIElement.call(this,a);this.Text=(a!=null)?a.Text:"";this.Limit=(a!=null)?a.Limit:0;this.Multiline=(a!=null)?a.Multiline:false;this.Editable=(a!=null)?a.Editable:false}Label.prototype=new UIElement();Label.prototype.constructor=Label;Label.prototype.Clone=function(){return new Label(this)};Label.prototype.KeyDown=function(a){if(this.Editable){if(this.Text==null){this.Text=""}if(a==8){if(this.Text.length>0){this.Text=this.Text.substring(0,this.Text.length-1)}}else{if(a==13){if(this.Multiline&&((this.Limit==0)||(this.Text.length<=this.Limit))){this.Text+="\n"}}else{if((this.Limit==0)||(this.Text.length<=this.Limit)){this.Text+=String.fromCharCode(a)}}}}UIElement.prototype.KeyDown.call(this,a)};function Panel(a){UIElement.call(this,a);this.Children=new Collection();if(a!=null){var c=a.Children.Count();for(var b=0;b<c;++b){this.Children.Add(a.Children.Get(b).Clone());this.Children.Get(b).Parent=this}}this.Children.OnCollectionChanged.Add(this.OnChildrenCollectionChanged,this)}Panel.prototype=new UIElement();Panel.prototype.constructor=Panel;Panel.prototype.Clone=function(){return new Panel(this)};Panel.prototype.OnChildrenCollectionChanged=function(c,d,b,e,a){if(b!=null){b.Parent=this}if(e!=null){e.Parent=null}};Panel.prototype.InvalidateMeasure=function(){this.Measure(this.Size)};Panel.prototype.Measure=function(a){UIElement.prototype.Measure.call(this,a);var c=this.Children.Count();for(var b=0;b<c;++b){this.Children.Get(b).Measure(a)}};Panel.prototype.InvalidateArrange=function(){this.Arrange(this.DesiredSize)};Panel.prototype.Arrange=function(c){UIElement.prototype.Arrange.call(this,c);var b=this.Children.Count();for(var a=0;a<b;++a){var d=this.Children.Get(a);d.RenderPosition.x=this.RenderPosition.x+d.Position.x;d.RenderPosition.y=this.RenderPosition.y+d.Position.y;d.Arrange(c)}};Panel.prototype.KeyDown=function(a){UIElement.prototype.KeyDown.call(this,a);if(this.mCurrentFocus!=null){this.mCurrentFocus.KeyDown(a)}};Panel.prototype.KeyUp=function(a){UIElement.prototype.KeyUp.call(this,a);if(this.mCurrentFocus!=null){this.mCurrentFocus.KeyUp(a)}};Panel.prototype.MouseEnter=function(){UIElement.prototype.MouseEnter.call(this);if(this.mCurrentFocus!=null){this.mCurrentFocus.MouseEnter()}};Panel.prototype.MouseLeave=function(){UIElement.prototype.MouseLeave.call(this);if(this.mCurrentFocus!=null){this.mCurrentFocus.MouseLeave()}};Panel.prototype.MouseLeftButtonDown=function(a){var b=this.FindChildByPoint(a);if(this.mCurrentFocus==b){if(this.mCurrentFocus!=null){this.mCurrentFocus.MouseLeftButtonDown(a)}return}else{if(this.mCurrentFocus!=null){this.mCurrentFocus.LostFocus()}}if(b!=this){this.mCurrentFocus=b;if(this.mCurrentFocus!=null){this.mCurrentFocus.HasFocus();this.mCurrentFocus.MouseLeftButtonDown(a)}}UIElement.prototype.MouseLeftButtonDown.call(this,a)};Panel.prototype.MouseLeftButtonUp=function(a){UIElement.prototype.MouseLeftButtonUp.call(this,a);if(this.mCurrentFocus!=null){this.mCurrentFocus.MouseLeftButtonUp(a)}};Panel.prototype.MouseMove=function(a){UIElement.prototype.MouseMove.call(this,a);var c=this.Children.Count();for(var b=0;b<c;++b){this.Children.Get(b).MouseMove(a)}};Panel.prototype.MouseWheel=function(a){UIElement.prototype.MouseWheel.call(this,a);if(this.mCurrentFocus!=null){this.mCurrentFocus.MouseWheel(a)}};Panel.prototype.FindChild=function(a){if(this.Name==a){return this}var d=this.Children.Count();for(var c=0;c<d;++c){var b=this.Children.Get(c).FindChild(a);if(b!=null){return b}}return null};Panel.prototype.FindChildByPoint=function(a){if(this.IsEnabled&&this.IsVisible&&(this.Opacity>0)){for(var c=(this.Children.Count()-1);c>=0;--c){var b=this.Children.Get(c).FindChildByPoint(a);if((b!=null)&&b.IsEnabled&&b.IsVisible&&(b.Opacity>0)){return b}}}return UIElement.prototype.FindChildByPoint.call(this,a)};Panel.prototype.Render=function(a){var d=this.Children.Count();for(var b=0;b<d;++b){var c=this.Children.Get(b);if(c.IsVisible&&(c.Opacity>0)){c.Render(a)}}};function Progress(a){UIElement.call(this,a);this.OnValueChanged=new Event();this.Value=(a!=null)?a.Value:0;this.Minimum=(a!=null)?a.Minimum:0;this.Maximum=(a!=null)?a.Maximum:1;this.Layout=(a!=null)?a.Layout:Orientation.Horizontal;this.Reverse=(a!=null)?a.Reverse:false}Progress.prototype=new UIElement();Progress.prototype.constructor=Progress;Progress.prototype.Clone=function(){return new Progress(this)};Progress.prototype.GetProgress=function(){return(this.Value-this.Minimum)/(this.Maximum-this.Minimum)};Progress.prototype.SetValue=function(a){this.Value=(a<this.Minimum)?this.Minimum:(a>this.Maximum)?this.Maximum:a;this.OnValueChanged.Dispatch(this,this.Value)};Progress.prototype.SetMinimum=function(a){this.Minimum=a;if(this.Value<this.Minimum){this.SetValue(this.Minimum);this.OnValueChanged.Dispatch(this,this.Value)}};Progress.prototype.SetMaximum=function(a){this.Maximum=a;if(this.Value>this.Maximum){this.Value=this.Maximum;this.OnValueChanged.Dispatch(this,this.Value)}};function StackPanel(a){Panel.call(this,a)}StackPanel.prototype=new Panel();StackPanel.prototype.constructor=StackPanel;StackPanel.prototype.Clone=function(){return new StackPanel(this)};StackPanel.prototype.InvalidateMeasure=function(){if(this.Parent!=null){this.Parent.InvalidateMeasure()}else{this.Measure(this.Size)}};StackPanel.prototype.Measure=function(b){this.DesiredSize.x=0;this.DesiredSize.y=0;var e=this.Children.Count();if(this.OrientationType==Orientation.Horizontal){for(var c=0;c<e;++c){var f=this.Children.Get(c);f.Measure(b);this.DesiredSize.x+=f.Margin.x+f.DesiredSize.x+f.Margin.z;var a=f.Margin.y+f.DesiredSize.y;if(a>this.DesiredSize.y){this.DesiredSize.y=a}}if(this.VerticalAlignmentType==VerticalAlignment.Stretch){this.DesiredSize.y=b.y}}else{for(var c=0;c<e;++c){var f=this.Children.Get(c);f.Measure(b);var d=f.Margin.x+f.DesiredSize.x;if(d>this.DesiredSize.x){this.DesiredSize.x=d}this.DesiredSize.y+=f.Margin.y+f.DesiredSize.y+f.Margin.w}if(this.HorizontalAlignmentType==HorizontalAlignment.Stretch){this.DesiredSize.x=b.x}}if(this.Size.x>0){this.DesiredSize.x=this.Size.x}if(this.Size.y>0){this.DesiredSize.y=this.Size.y}};StackPanel.prototype.InvalidateArrange=function(){if(this.Parent!=null){this.Parent.InvalidateArrange()}else{this.Arange(this.Size)}};StackPanel.prototype.Arrange=function(c){var d=0;var b=this.Children.Count();if(this.OrientationType==Orientation.Horizontal){for(var a=0;a<b;++a){var e=this.Children.Get(a);d+=e.Margin.x;e.RenderPosition.x=this.RenderPosition.x+d;if(e.VerticalAlignmentType==VerticalAlignment.Centre){e.RenderPosition.y=(this.RenderPosition.y+(this.DesiredSize.y*0.5))-(e.RenderSize.y*0.5)}else{if(e.VerticalAlignmentType==VerticalAlignment.Bottom){e.RenderPosition.y=(this.RenderPosition.y+this.DesiredSize.y)-e.RenderSize.y}else{e.RenderPosition.y=this.RenderPosition.y+e.Margin.y}}e.Arrange(c);d+=e.RenderSize.x+e.Margin.z}this.RenderSize.x=d;this.RenderSize.y=this.DesiredSize.y}else{for(var a=0;a<b;++a){var e=this.Children.Get(a);d+=e.Margin.y;if(e.HorizontalAlignmentType==HorizontalAlignment.Centre){e.RenderPosition.x=(this.RenderPosition.x+(this.DesiredSize.x*0.5))-(e.RenderSize.x*0.5)}else{if(e.HorizontalAlignmentType==HorizontalAlignment.Right){e.RenderPosition.x=(this.RenderPosition.x+this.DesiredSize.x)-e.RenderSize.x}else{e.RenderPosition.x=this.RenderPosition.x+e.Margin.x}}e.RenderPosition.y=this.RenderPosition.y+d;e.Arrange(c);d+=e.RenderSize.y+e.Margin.w}this.RenderSize.x=this.DesiredSize.x;this.RenderSize.y=d}};function ToggleButton(a){Button.call(this,a);this.OnToggled=new Event();this.IsToggled=false}ToggleButton.prototype=new UIElement();ToggleButton.prototype.constructor=ToggleButton;ToggleButton.prototype.Clone=function(){return new ToggleButton(this)};ToggleButton.prototype.MouseLeftButtonUp=function(a){if(this.CurrentState==Button.State.Pressed){if(this.IsPointInside(a)){this.OnClick.Dispatch(this);this.IsToggled=!this.IsToggled;this.OnToggled.Dispatch(this,this.IsToggled)}if(!this.IsToggled){this.SetState(Button.State.Hover)}}UIElement.prototype.MouseLeftButtonUp.call(this,a)};ToggleButton.prototype.SetState=function(a){if(!this.IsToggled){Button.prototype.SetState.call(this,a)}};function Grid(a){Panel.call(this,a);this.ColumnDefinitions=new Array();this.RowDefinitions=new Array()}Grid.prototype=new Panel();Grid.prototype.constructor=Grid;Grid.prototype.Clone=function(){return new Grid(this)};Grid.prototype.InvalidateMeasure=function(){if(this.Parent!=null){this.Parent.InvalidateMeasure()}else{this.Measure(this.Size)}};Grid.prototype.Measure=function(d){UIElement.prototype.Measure.call(this,d);var b=0;for(var f=0;f<this.ColumnDefinitions.length;++f){this.ColumnDefinitions[f].ActualWidth=0;if(this.ColumnDefinitions[f].Width==-2){++b}}var k=0;for(var f=0;f<this.RowDefinitions.length;++f){this.RowDefinitions[f].ActualHeight=0;if(this.RowDefinitions[f].Height==-2){++k}}var a=new Point();var j=this.Children.Count();for(var f=0;f<j;++f){var c=this.Children.Get(f);var e=c.GridColumn?c.GridColumn:0;var l=this.ColumnDefinitions[e];var m=c.GridRow?c.GridRow:0;var g=this.RowDefinitions[m];a.x=(l.Width>=0)?l.Width:this.DesiredSize.x;a.y=(g.Height>=0)?g.Height:this.DesiredSize.y;c.Measure(a);if((l.Width!=-2)&&(c.DesiredSize.x>l.ActualWidth)){l.ActualWidth=c.DesiredSize.x}if((g.Height!=-2)&&(c.DesiredSize.y>g.ActualHeight)){g.ActualHeight=c.DesiredSize.y}}var h=new Point();for(var f=0;f<this.ColumnDefinitions.length;++f){if(this.ColumnDefinitions[f].Width!=-2){h.x+=this.ColumnDefinitions[f].ActualWidth}}for(var f=0;f<this.RowDefinitions.length;++f){if(this.RowDefinitions[f].Height!=-2){h.y+=this.RowDefinitions[f].ActualHeight}}for(var f=0;f<this.ColumnDefinitions.length;++f){if(this.ColumnDefinitions[f].Width==-2){this.ColumnDefinitions[f].ActualWidth=(this.DesiredSize.x-h.x)/b;if(this.ColumnDefinitions[f].ActualWidth<0){this.ColumnDefinitions[f].ActualWidth=0}}}for(var f=0;f<this.RowDefinitions.length;++f){if(this.RowDefinitions[f].Height==-2){this.RowDefinitions[f].ActualHeight=(this.DesiredSize.y-h.y)/k;if(this.RowDefinitions[f].ActualHeight<0){this.RowDefinitions[f].ActualHeight=0}}}for(var f=0;f<j;++f){var c=this.Children.Get(f);var e=c.GridColumn?c.GridColumn:0;var l=this.ColumnDefinitions[e];var m=c.GridRow?c.GridRow:0;var g=this.RowDefinitions[m];if((l.Width==-2)||(g.Height==-2)){a.x=l.ActualWidth;a.y=g.ActualHeight;c.Measure(a);if(c.DesiredSize.x>l.ActualWidth){l.ActualWidth=c.DesiredSize.x}if(c.DesiredSize.y>g.ActualHeight){g.ActualHeight=c.DesiredSize.y}}}if(this.ColumnDefinitions.length>0){this.ColumnDefinitions[0].RenderPosition=0;for(var f=1;f<this.ColumnDefinitions.length;++f){this.ColumnDefinitions[f].RenderPosition=this.ColumnDefinitions[f-1].RenderPosition+this.ColumnDefinitions[f-1].ActualWidth}}if(this.RowDefinitions.length>0){this.RowDefinitions[0].RenderPosition=0;for(var f=1;f<this.RowDefinitions.length;++f){this.RowDefinitions[f].RenderPosition=this.RowDefinitions[f-1].RenderPosition+this.RowDefinitions[f-1].ActualHeight}}if(this.HorizontalAlignmentType!=HorizontalAlignment.Stretch){this.DesiredSize.x=0;for(var f=0;f<this.ColumnDefinitions.length;++f){this.DesiredSize.x+=this.ColumnDefinitions[f].ActualWidth}}if(this.VerticalAlignmentType==VerticalAlignment.Stretch){this.DesiredSize.y=0;for(var f=0;f<this.RowDefinitions.length;++f){this.DesiredSize.y+=this.RowDefinitions[f].ActualHeight}}};Grid.prototype.InvalidateArrange=function(){if(this.Parent!=null){this.Parent.InvalidateArrange()}else{this.Arange(this.Size)}};Grid.prototype.Arrange=function(g){var a=new Point();var f=this.Children.Count();for(var d=0;d<f;++d){var b=this.Children.Get(d);var c=b.GridColumn?b.GridColumn:0;var h=this.ColumnDefinitions[c];var j=b.GridRow?b.GridRow:0;var e=this.RowDefinitions[j];a.x=h.ActualWidth;a.y=e.ActualHeight;if(b.HorizontalAlignmentType==HorizontalAlignment.Centre){b.RenderPosition.x=(this.RenderPosition.x+h.RenderPosition+(h.ActualWidth*0.5))-(b.RenderSize.x*0.5)}else{if(b.HorizontalAlignmentType==HorizontalAlignment.Right){b.RenderPosition.x=(this.RenderPosition.x+h.RenderPosition+h.ActualWidth)-b.RenderSize.x}else{b.RenderPosition.x=this.RenderPosition.x+h.RenderPosition}}if(b.VerticalAlignmentType==VerticalAlignment.Centre){b.RenderPosition.y=(this.RenderPosition.y+e.RenderPosition+(e.ActualHeight*0.5))-(b.RenderSize.y*0.5)}else{if(b.VerticalAlignmentType==VerticalAlignment.Right){b.RenderPosition.y=(this.RenderPosition.y+e.RenderPosition+e.ActualHeight)-b.RenderSize.y}else{b.RenderPosition.y=this.RenderPosition.y+e.RenderPosition}}b.RenderPosition.x+=b.Margin.x;b.RenderPosition.y+=b.Margin.y;b.Arrange(a)}this.RenderSize.x=this.DesiredSize.x;this.RenderSize.y=this.DesiredSize.y};function ItemList(a){Panel.call(this,a);this.OnItemSelectedDelegate=new Event();this.DataTemplate=(a!=null)?a.DataTemplate:null;this.StartIndex=(a!=null)?a.StartIndex:0;this.ItemCount=(a!=null)?a.ItemCount:0;this.SelectedItem=null;this.SelectedOnPress=(a!=null)?a.SelectedOnPress:false;this.mItemSource=null;if(a!=null){this.SetSource(a.mItemSource)}}ItemList.prototype=new Panel();ItemList.prototype.constructor=ItemList;ItemList.prototype.Clone=function(){return new ItemList(this)};ItemList.prototype.OnSourceCollectionChanged=function(d,f,c,g,a){switch(f){case Collection.ChangedAction.Added:if((this.DataTemplate!=null)&&(this.ItemCount<=0)||(this.Children.Count()<this.ItemCount)){var h=this.DataTemplate.Create(c);if(h!=null){this.Children.Add(h)}}break;case Collection.ChangedAction.Removed:var e=this.Children.Count();for(var b=0;b<e;++b){if(this.Children.Get(b).DataContext==g){if(this.SelectedItem==this.Children.Get(b).DataContext){this.SetSelected(null)}this.Children.RemoveAt(b);break}}break;case Collection.ChangedAction.Reset:this.SetSelected(null);this.Children.Clear();break;case Collection.ChangedAction.Replace:break}};ItemList.prototype.MouseLeftButtonDown=function(a){UIElement.prototype.MouseLeftButtonDown(a);if(this.SelectedOnPress&&(this.mCurrentFocus!=null)){this.SetSelected(this.mCurrentFocus.DataContext)}};ItemList.prototype.MouseLeftButtonUp=function(a){UIElement.prototype.MouseLeftButtonUp(a);if(!this.SelectedOnPress&&(this.mCurrentFocus!=null)){this.SetSelected(this.mCurrentFocus.DataContext)}};ItemList.prototype.SetSelected=function(a){if(a!=this.SelectedItem){var b=this.SelectedItem;this.SelectedItem=a;this.OnItemSelected.Dispatch(this,this.SelectedItem,b)}};ItemList.prototype.SetSource=function(c){if((this.mItemSource!=null)&&(mItemSource.OnCollectionChanged!=null)){mItemSource.OnCollectionChanged.Remove(this.OnSourceCollectionChanged,this)}this.Children.Clear();this.mItemSource=c;if((this.mItemSource!=null)&&(this.mItemSource.OnCollectionChanged!=null)){this.mItemSource.OnCollectionChanged.Add(this.OnSourceCollectionChanged,this)}if((this.DataTemplate!=null)&&(this.mItemSource!=null)){var b=(this.mItemSource.length!=null)?this.mItemSource.length:this.mItemSource.Count();for(var a=0;a<b;++a){if(a>=this.StartIndex){var d=this.DataTemplate.Create((this.mItemSource.length!=null)?this.mItemSource[a]:this.mItemSource.Get(a));if(d!=null){this.Children.Add(d);if((this.ItemCount>0)&&(this.Children.Count()>=this.ItemCount)){break}}}++index}}};ItemList.prototype.FindChildData=function(c){var b=this.Children.Count();for(var a=0;a<b;++a){var d=this.Children.Get(a);if(d.DataContext==c){return d}}return null};function Base64(){}Base64.mBase64Table="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Base64.mReverseBase64Table=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];Base64.Encode=function(g){var d,c,a,l,k,j,h,n;var o=0;var e="";var b=new Array();for(var f=0;f<g.length;f+=3){d=g[f];c=g[f+1];a=g[f+2];n=d<<16|c<<8|a;l=n>>18&63;k=n>>12&63;j=n>>6&63;h=n&63;b[o++]=Base64.mBase64Table.charAt(l)+Base64.mBase64Table.charAt(k)+Base64.mBase64Table.charAt(j)+Base64.mBase64Table.charAt(h)}while(f<g.length){}e=b.join("");var m=g.length%3;if(m==1){e=e.slice(0,-2)+"=="}else{if(m==2){e=e.slice(0,-1)+"="}}return e};Base64.EncodeBinary=function(h){var f;var e;var b;var a;var g="";for(var d=0;d<h.length;d+=24){f=parseInt(h.substring(d,d+6),2);if((d+12)>h.length){e=parseInt(h.substring(d+6,d+8)+"0000",2);g+=Base64.mBase64Table.charAt(f)+Base64.mBase64Table.charAt(e)}else{e=parseInt(h.substring(d+6,d+12),2);if((d+18)>h.length){b=parseInt(h.substring(d+12,d+16)+"00",2);g+=Base64.mBase64Table.charAt(f)+Base64.mBase64Table.charAt(e)+Base64.mBase64Table.charAt(b)}else{b=parseInt(h.substring(d+12,d+18),2);a=parseInt(h.substring(d+18,d+24),2);g+=Base64.mBase64Table.charAt(f)+Base64.mBase64Table.charAt(e)+Base64.mBase64Table.charAt(b)+Base64.mBase64Table.charAt(a)}}}var c=(h.length/8)%3;if(c==1){g+="=="}else{if(c==2){g+="="}}return g};Base64.Decode=function(c){var g;var f;var e;var d;var j;var k=c.length;var h=new Array();var b=0;for(var a=0;a<k;a+=4){g=Base64.mReverseBase64Table[c.charCodeAt(a)];f=Base64.mReverseBase64Table[c.charCodeAt(a+1)];e=Base64.mReverseBase64Table[c.charCodeAt(a+2)];d=Base64.mReverseBase64Table[c.charCodeAt(a+3)];j=(g<<18)|(f<<12)|(e<<6)|d;h[b]=(j>>16)&127;if(c[a+2]!="="){h[b+1]=(j>>8)&127}if(c[a+3]!="="){h[b+2]=j&127}b+=3}return h};function Binary(){}Binary.ToBinary=function(h,i){var c="";if(typeof(h)=="number"){var d=Math.abs(h);var h=d.toString(2);var a=h.indexOf(".");if(a==-1){if(i==null){i=(d>65535)?4:(d>255)?2:1}if(d<0){if(i==1){h=(255+d+1).toString(2)}else{if(i==2){h=(65535+d+1).toString(2)}else{h=(4294967295+d+1).toString(2)}}}if((i==1)&&(h.length<8)){var e=8-h.length;for(var b=0;b<e;++b){c+="0"}}else{if((i==2)&&(h.length<16)){var e=16-h.length;for(var b=0;b<e;++b){c+="0"}}else{if((i==4)&&(h.length<32)){var e=32-h.length;for(var b=0;b<e;++b){c+="0"}}}}c+=h;if(i==2){c=c.substring(8,16)+c.substring(0,8)}else{if(i==4){c=c.substring(24,32)+c.substring(16,24)+c.substring(8,16)+c.substring(0,8)}}}else{c+=(d<0)?"1":"0";var g=h.substring(0,a);var f=h.substring(a+1);if(g.length>8){g=g.substring(g.length-8)}else{if(g.length<8){var e=8-g.length;for(var b=0;b<e;++b){c+="0"}}}c+=g;if(f.length>23){f=f.substring(0,23)}c+=f;if(f.length<23){var e=23-f.length;for(var b=0;b<e;++b){c+="0"}}c=c.substring(24,32)+c.substring(16,24)+c.substring(8,16)+c.substring(0,8)}}else{var h=h.charCodeAt(0).toString(2);if(h.length<8){var e=8-h.length;for(var b=0;b<e;++b){c+="0"}}c+=h}return c};Binary.Encode=function(b){var c="";for(var a=0;a<b.length;++a){c+=this.ToBinary(b[a])}return c};Binary.EncodeNumber=function(e,d){if(d==null){d=(e>65536)?4:(e>256)?2:1}if(d==1){return String.fromCharCode(e)}else{if(d==2){var c=Math.floor(e/256);e-=(65536*c);return String.fromCharCode(e)+String.fromCharCode(c)}else{if(d==4){var a=Math.floor(e/16777216);e-=(16777216*a);var b=Math.floor(e/65536);e-=(65536*b);var c=Math.floor(e/256);e-=(256*c);return String.fromCharCode(e)+String.fromCharCode(c)+String.fromCharCode(b)+String.fromCharCode(a)}}}};function UUID(){}UUID.Generate=function(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(){return(Math.random()*15|0).toString(16)})};function XmlItem(a,b){this.Name=(a==null)?"":a;this.Value=(b==null)?"":b}XmlItem.prototype.ValueBool=function(a){if(a==null){return((this.Value.toLowerCase()=="true")||(this.ValueInt()>0))}else{if(a){this.Value="true"}else{this.Value="false"}}};XmlItem.prototype.ValueInt=function(b){if(b==null){var a=parseInt(this.Value);return isNaN(a)?0:a}else{this.Value=b.toString()}};XmlItem.prototype.ValueDouble=function(b){if(b==null){var a=parseFloat(this.Value);return isNaN(a)?0:a}else{this.Value=b.toString()}};function XmlNode(){XmlItem.call(this);this.mAttribute=new Array();this.mChild=new Array();this.mParent}XmlNode.prototype=new XmlItem();XmlNode.prototype.constructor=XmlNode;XmlNode.prototype.toString=function(g,e,c){if(e==null){e=true}if(c==null){c=0}var d;var a;var h;var j="";var f;var b="";if(e){b="\n"}if(e){for(d=0;d<c;++d){j+="\t"}}j+="<";j+=g.Name;for(d=0;d<g.GetNumAttributes();++d){h=g.GetAttributeAt(d);f=h.Value;f=f.replace(new RegExp("&","g"),"&#38;");f=f.replace(new RegExp('"',"g"),"&#34;");f=f.replace(new RegExp("<","g"),"&#60;");f=f.replace(new RegExp(">","g"),"&#62;");f=f.replace(new RegExp("\n","g"),"&#13;");j+=" ";j+=h.Name;j+='="';j+=f;j+='"'}if((g.Value.length>0)&&(g.GetNumChildren()==0)){f=g.Value;f=f.replace(new RegExp("&","g"),"&#38;");f=f.replace(new RegExp('"',"g"),"&#34;");f=f.replace(new RegExp("<","g"),"&#60;");f=f.replace(new RegExp(">","g"),"&#62;");f=f.replace(new RegExp("\n","g"),"&#13;");j+=">"+f+"</"+g.Name+">"+b}else{if(g.GetNumChildren()==0){j+=" />"+b}else{j+=">"+b}}for(d=0;d<g.GetNumChildren();++d){a=g.GetChildAt(d);j+=this.toString(a,e,c+1)}if(g.GetNumChildren()>0){if(e){for(d=0;d<c;++d){j+="\t"}}j+="</";j+=g.Name;j+=">";if(e&&(c!=0)){j+="\n"}}return j};XmlNode.prototype.Clear=function(){this.Name="";this.Value="";this.mAttribute=new Array();this.mChild=new Array()};XmlNode.prototype.AddAttribute=function(a){this.mAttribute.push(a)};XmlNode.prototype.RemoveAttribute=function(c,b){if(b==null){b=1}var a=0;for(var d=0;d<this.mAttribute.length;++d){if(this.mAttribute[d].Name==c){++a;if(a>=b){this.RemoveAttributeAt(d);return}}}};XmlNode.prototype.RemoveAttributeAt=function(a){this.mAttribute.splice(a,1)};XmlNode.prototype.RemoveAttributes=function(){this.mAttribute=new Array()};XmlNode.prototype.GetAttribute=function(c,b){if(b==null){b=1}var a=0;for(var d=0;d<this.mAttribute.length;++d){if(this.mAttribute[d].Name==c){++a;if(a>=b){return this.mAttribute[d]}}}return null};XmlNode.prototype.GetAttributeAt=function(a){if(a<this.mAttribute.length){return this.mAttribute[a]}return null};XmlNode.prototype.GetAttributeValue=function(b,a){if(a==null){a=1}var c=this.GetAttribute(b,a);if(c!=null){return c.Value}return""};XmlNode.prototype.GetAttributeValueBool=function(b,a){if(a==null){a=1}var c=this.GetAttribute(b,a);if(c!=null){return c.ValueBool()}return false};XmlNode.prototype.GetAttributeValueInt=function(b,a){if(a==null){a=1}var c=this.GetAttribute(b,a);if(c!=null){return c.ValueInt()}return 0};XmlNode.prototype.GetAttributeValueDouble=function(b,a){if(a==null){a=1}var c=this.GetAttribute(b,a);if(c!=null){return c.ValueDouble()}return 0};XmlNode.prototype.SetAttributeValue=function(a,c){var b=this.GetAttribute(a);if(b!=null){b.Value=c}else{this.AddAttribute(new XmlItem(a,c))}};XmlNode.prototype.SetAttributeValueBool=function(a,c){var b=this.GetAttribute(a);if(b!=null){b.ValueBool(c)}else{var b=new XmlItem();b.Name=a;b.ValueBool(c);this.AddAttribute(b)}};XmlNode.prototype.SetAttributeValueInt=function(a,c){var b=this.GetAttribute(a);if(b!=null){b.ValueInt(c)}else{var b=new XmlItem();b.Name=a;b.ValueInt(c);this.AddAttribute(b)}};XmlNode.prototype.SetAttributeValueDouble=function(a,c){var b=this.GetAttribute(a);if(b!=null){b.ValueDouble(c)}else{var b=new XmlItem();b.Name=a;b.ValueDouble(c);this.AddAttribute(b)}};XmlNode.prototype.GetNumAttributes=function(){return this.mAttribute.length};XmlNode.prototype.FindNode=function(b,a){if(a==null){a=1}for(var c=0;c<this.mChild.length;++c){if(this.mChild[c].Name==b){if(a<=1){return this.mChild[c]}--a}else{if(this.mChild[c].GetNumChildren()>0){var d=this.FindNode(b,a);if(d!=null){return d}}}}return null};XmlNode.prototype.AddChild=function(a){a.SetParent(this);this.mChild.push(a)};XmlNode.prototype.InsertChild=function(a,b){b.SetParent(this);this.mChild.splice(a,0,b)};XmlNode.prototype.RemoveChild=function(c,b){if(b==null){b=1}var a=0;for(var d=0;d<this.mChild.length;++d){if(this.mChild[d].Name==c){++a;if(a>=b){this.RemoveChildAt(d);return}}}};XmlNode.prototype.RemoveChildAt=function(a){this.mChild.splice(a,1)};XmlNode.prototype.RemoveChildren=function(){this.mChild=new Array()};XmlNode.prototype.GetChild=function(c,b){if(b==null){b=1}var a=0;for(var d=0;d<this.mChild.length;++d){if(this.mChild[d].Name==c){++a;if(a>=b){return this.mChild[d]}}}return null};XmlNode.prototype.GetChildWithAttribute=function(c,e,g,b){if(b==null){b=1}var a=0;for(var d=0;d<this.mChild.length;++d){if(this.mChild[d].Name==c){var f=this.mChild[d].GetAttribute(e);if((f!=null)&&(f.Value==g)){++a;if(a>=b){return this.mChild[d]}}}}return null};XmlNode.prototype.GetChildAt=function(a){if(a==null){a=1}if(a<this.mChild.length){return this.mChild[a]}return null};XmlNode.prototype.GetChildValue=function(b,a){var c=this.GetChild(b,a);if(c!=null){return c.Value}return""};XmlNode.prototype.GetChildValueBool=function(b,a){if(a==null){a=1}var c=this.GetChild(b,a);if(c!=null){return c.ValueBool()}return false};XmlNode.prototype.GetChildValueInt=function(b,a){if(a==null){a=1}var c=this.GetChild(b,a);if(c!=null){return c.ValueInt()}return 0};XmlNode.prototype.GetChildValueDouble=function(b,a){if(a==null){a=1}var c=this.GetChild(b,a);if(c!=null){return c.ValueDouble()}return 0};XmlNode.prototype.SetChildValue=function(b,c,a){if(a==null){a=1}var d=this.GetChild(b,a);if(d!=null){d.Value=c}else{var d=new XmlNode();d.Name=b;d.Value=c;this.AddChild(d)}};XmlNode.prototype.SetChildValueBool=function(b,c,a){if(a==null){a=1}var d=this.GetChild(b,a);if(d!=null){d.ValueBool(c)}else{var d=new XmlNode();d.Name=b;d.ValueBool(c);this.AddChild(d)}};XmlNode.prototype.SetChildValueInt=function(b,c,a){if(a==null){a=1}var d=this.GetChild(b,a);if(d!=null){d.ValueInt(c)}else{var d=new XmlNode();d.Name=b;d.ValueInt(c);this.AddChild(d)}};XmlNode.prototype.SetChildValueDouble=function(b,c,a){if(a==null){a=1}var d=this.GetChild(b,a);if(d!=null){d.ValueDouble(c)}else{var d=new XmlNode();d.Name=b;d.ValueDouble(c);this.AddChild(d)}};XmlNode.prototype.AddChildren=function(a){this.InsertChildren(a)};XmlNode.prototype.InsertChildren=function(c,a){if(a==null){a=this.mChild.length}for(var b=0;b<c.GetNumChildren();++b){this.InsertChild(a+b,c.GetChildAt(b))}};XmlNode.prototype.GetChildren=function(a){var c=new XmlNode();c.Name=Name;for(var b=0;b<this.mChild.length;++b){if(this.mChild[b].Name==a){c.AddChild(this.mChild[b])}}return c};XmlNode.prototype.GetNumChildren=function(){return this.mChild.length};XmlNode.prototype.SetParent=function(a){this.mParent=a};XmlNode.prototype.GetParent=function(){return this.mParent};XmlNode.prototype.ToString=function(a){if(a==null){a=true}return this.toString(this,a)};function Xml(){var a;var b}function XmlStartElement(a,c,f){var b=a;if((b.mCurrentNode===b.mRoot)&&(b.mRoot.Name.length==0)){b.mRoot.Name=c;if(f!=null){for(var e=0;e<f.length;e+=2){b.mCurrentNode.AddAttribute(new XmlItem(f[e],f[e+1]))}}}else{if(b.mCurrentNode!=null){var d=new XmlNode();d.Name=c;d.SetParent(b.mCurrentNode);b.mCurrentNode.AddChild(d);b.mCurrentNode=b.mCurrentNode.GetChildAt(b.mCurrentNode.GetNumChildren()-1);if(f!=null){for(var e=0;e<f.length;e+=2){b.mCurrentNode.AddAttribute(new XmlItem(f[e],f[e+1]))}}}}}function XmlEndElement(a,c){var b=a;b.mCurrentNode=b.mCurrentNode.GetParent()}function XmlTextElement(b,d,a){if(a>0){var c=b;if(c.mCurrentNode!=null){c.mCurrentNode.Value=d}}}Xml.prototype.Load=function(b){var a=true;this.mRoot=new XmlNode();this.mCurrentNode=this.mRoot;var c=new XmlParser();c.SetXmlStartElement(XmlStartElement);c.SetXmlEndElement(XmlEndElement);c.SetXmlTextElement(XmlTextElement);a=c.Parse(this,b,b.length);if(a){return this.mRoot}return null};var XmlWhiteSpace=[" ","\t","\r","\n"];var XmlSpecialCharacter=["<",">","&",'"',"'"];var XmlEscape=["&lt;","&gt;","&amp;","&quot;","&apos;"];var XmlEscapeSize=[4,4,5,6,6];var XmlEscapeChar=["<",">","&",'"',"'"];function XmlParser(){var f;var b;var d;var a;var e;var c}XmlParser.prototype.IndexOf=function(c,a,h,f,g){if(a>=f){var e;var b;var d=a-(f-1);for(e=g;e<d;++e){for(b=0;b<f;++b){if(c[e+b]==h[b]){if(b==(f-1)){return e}}else{break}}}}return -1};XmlParser.prototype.Truncate=function(c,a,f,e){var b;if(e>f){for(var d=f;(d<e)&&(d<a);++d){for(b=0;b<XmlWhiteSpace.length;++b){if(c[d]==XmlWhiteSpace[b]){break}}if(b==XmlWhiteSpace.length){return d}}}else{for(var d=f-1;(d>e)&&(d<a);--d){for(b=0;b<XmlWhiteSpace.length;++b){if(c[d]==XmlWhiteSpace[b]){break}}if(b==XmlWhiteSpace.length){return d+1}}}return f};XmlParser.prototype.ParseName=function(c,h,g){var f=false;for(var e=h;e<g;++e){for(var b=0;b<XmlWhiteSpace.length;++b){if(c[e]==XmlWhiteSpace[b]){g=e;f=true;break}}if(f){break}}var d=g-h;var a=c.substring(h,h+d);return a};XmlParser.prototype.ParseAttributes=function(e,h,d){var a;var j;var f=0;var g=0;for(var c=h;c<d;++c){if(e[c]=="="){++g}}if(g>0){j=(g*2)+1;var b=new Array();h=this.FindWhiteSpace(e,h,d);while((h<d)&&(g>0)){h=this.SkipWhiteSpace(e,h,d);if(h<d){a=this.IndexOf(e,d,"=",1,h);if(a==-1){break}a=this.Truncate(e,d,a,h);j=a-h;b.push(e.substring(h,h+j));++f;h=this.IndexOf(e,d,'"',1,a)+1;if(h==-1){break}a=this.IndexOf(e,d,'"',1,h);if(a==-1){break}j=a-h;b.push(e.substring(h,h+j));++f;h=a+1;--g}}return b}return 0};XmlParser.prototype.FindWhiteSpace=function(b,e,d){for(var c=e;c<d;++c){for(var a=0;a<XmlWhiteSpace.length;++a){if(b[c]==XmlWhiteSpace[a]){return c}}}return e};XmlParser.prototype.SkipWhiteSpace=function(b,e,d){var a;for(var c=e;c<d;++c){for(a=0;a<XmlWhiteSpace.length;++a){if(b[c]==XmlWhiteSpace[a]){break}}if(a==XmlWhiteSpace.length){return c}}return e};XmlParser.prototype.ConvertEscapeCharacters=function(a,c){for(var b=0;b<5;++b){var d=new RegExp(XmlEscape[b],"g");a=a.replace(d,XmlEscapeChar[b])}return a};XmlParser.prototype.Parse=function(c,l,e){var o;var k;var a;var q;var m;var p;var b;var d;for(var h=0;h<e;++h){if(l[h]=="<"){o=h+1;k=this.IndexOf(l,e,">",1,h+1);if(k!=-1){if(l[o]=="?"){if(this.mXmlDeclaration!=null){o=this.Truncate(l,e,o+1,k);a=this.Truncate(l,e,k,o);b=this.ParseName(l,o,a);d=this.ParseAttributes(l,o,a);this.mXmlDeclaration(c,b,d)}}else{if(l[o]=="!"){if(l[o+1]=="-"){k=this.IndexOf(l,e,"-->",3,o+2)+3;if(this.mXmlComment){o=this.Truncate(l,e,o+3,k);a=this.Truncate(l,e,k-3,o);q=a-o;p=l.substring(o,o+q);this.mXmlComment(c,p)}}else{if(l[o+1]=="["){k=IndexOf(l,e,"]]>",3,o+8)+3;if(this.mXmlTextElement){o=this.Truncate(l,e,o+8,k);a=this.Truncate(l,e,k-3,o);q=a-o;p=l.substring(o,o+q);p=this.ConvertEscapeCharacters(p,q);this.mXmlTextElement(c,p,q)}}}}else{if(l[o]=="/"){if(this.mXmlEndElement!=null){o=this.Truncate(l,e,o+1,k);a=this.Truncate(l,e,k,o);b=this.ParseName(l,o,a);this.mXmlEndElement(c,b)}}else{if(this.mXmlStartElement!=null){o=this.Truncate(l,e,o,k);a=this.Truncate(l,e,k,o);var n=false;if(l[a-1]=="/"){n=true;--a}b=this.ParseName(l,o,a);d=this.ParseAttributes(l,o,a);if(d!=null){var f=0;while(d[f]!=null){d[f+1]=this.ConvertEscapeCharacters(d[f+1],d[f+1].length);f+=2}}this.mXmlStartElement(c,b,d);if(n&&(this.mXmlEndElement!=null)){this.mXmlEndElement(c,b)}}}}}h=k}else{return false}}else{if(this.mXmlTextElement!=null){var g;for(g=0;g<XmlWhiteSpace.length;++g){if(l[h]==XmlWhiteSpace[g]){break}}if(g==XmlWhiteSpace.length){o=h;k=this.IndexOf(l,e,"<",1,o);if(k!=-1){a=this.Truncate(l,e,k,o);q=a-o;p=l.substring(o,o+q);p=this.ConvertEscapeCharacters(p,q);this.mXmlTextElement(c,p,q);h=k-1}else{return false}}}}}return true};XmlParser.prototype.SetXmlDeclaration=function(a){this.mXmlDeclaration=a};XmlParser.prototype.SetXmlStartElement=function(a){this.mXmlStartElement=a};XmlParser.prototype.SetXmlEndElement=function(a){this.mXmlEndElement=a};XmlParser.prototype.SetXmlTextElement=function(a){this.mXmlTextElement=a};XmlParser.prototype.SetXmlComment=function(a){this.mXmlComment=a};XmlParser.prototype.SetXmlError=function(a){this.mXmlError=a};function App(){this.OnSize=new Event();this.mWindow=null;this.mTimerInterval=null;this.mFPS=0;this.mDelay=0;this.SetFPS(30)}App.CurrentApp=null;App.WindowState={Hide:0,Show:5,Maximize:3,Minimize:6,Restore:9};App.prototype.Main=function(b,a){};App.prototype.Start=function(){if(window.requestAnimationFrame){this.mAnimationFrameRequest=window.requestAnimationFrame}else{if(window.webkitRequestAnimationFrame){this.mAnimationFrameRequest=window.webkitRequestAnimationFrame}else{if(window.mozRequestAnimationFrame){this.mAnimationFrameRequest=window.mozRequestAnimationFrame}else{if(window.oRequestAnimationFrame){this.mAnimationFrameRequest=window.oRequestAnimationFrame}else{if(window.msRequestAnimationFrame){this.mAnimationFrameRequest=window.msRequestAnimationFrame}else{this.mTimerInterval=setInterval(this.Render,this.mDelay)}}}}}if(this.mAnimationFrameRequest){this.Render()}};App.prototype.Stop=function(){if(this.mAnimationFrameRequest!=null){this.mAnimationFrameRequest=null}else{clearInterval(this.mTimerInterval)}};App.prototype.Render=function(){Timer.SigTimer();if(window.requestAnimationFrame){window.requestAnimationFrame(this.Render.bind(this))}else{if(window.webkitRequestAnimationFrame){window.webkitRequestAnimationFrame(this.Render.bind(this))}else{if(window.mozRequestAnimationFrame){window.mozRequestAnimationFrame(this.Render.bind(this))}else{if(window.oRequestAnimationFrame){window.oRequestAnimationFrame(this.Render.bind(this))}else{if(window.msRequestAnimationFrame){window.msRequestAnimationFrame(this.Render.bind(this))}}}}}};App.prototype.GetWidth=function(){return this.mWindow.width};App.prototype.GetHeight=function(){return this.mWindow.height};App.prototype.GetFPS=function(){return this.mFPS};App.prototype.GetWindow=function(){return this.mWindow};App.prototype.SetFPS=function(a){this.mFPS=a;this.mDelay=1000/a};App.prototype.SetWindow=function(a){if(this.mWindow!=null){document.onkeydown=null;document.onkeyup=null;this.mWindow.onmousedown=null;this.mWindow.onmouseup=null;this.mWindow.onmousemove=null}this.mWindow=a;if(this.mWindow!=null){document.onkeydown=this.OnKeyboardKeyDownHandler;document.onkeypress=this.OnKeyboardKeyDown;document.onkeyup=this.OnKeyboardKeyUp;this.mWindow.onmousedown=this.OnMouseDown;this.mWindow.onmouseup=this.OnMouseUp;this.mWindow.onmousemove=this.OnMouseMove}};App.prototype.OnKeyboardKeyDownHandler=function(b){if(b.keyCode==8){var a=new InputMap();a.Value=b.keyCode;a.State=InputMap.InputState.Down;Input.OnKeyboardInput.Dispatch(a);b.returnValue=false;return false}};App.prototype.OnKeyboardKeyDown=function(b){if(b.keyCode!=8){var a=new InputMap();a.Value=(b.charCode)?b.charCode:b.keyCode;a.State=InputMap.InputState.Down;Input.OnKeyboardInput.Dispatch(a)}};App.prototype.OnKeyboardKeyUp=function(b){var a=new InputMap();a.Value=b.keyCode;a.State=InputMap.InputState.Up;Input.OnKeyboardInput.Dispatch(a)};App.prototype.OnMouseDown=function(b){var a=new InputMap();a.Value=InputMap.InputKey.MouseLeft;a.Position=new Point(b.pageX-this.offsetLeft,b.pageY-this.offsetTop);a.State=InputMap.InputState.Down;Input.OnMouseInput.Dispatch(a)};App.prototype.OnMouseUp=function(b){var a=new InputMap();a.Value=InputMap.InputKey.MouseLeft;a.Position=new Point(b.pageX-this.offsetLeft,b.pageY-this.offsetTop);a.State=InputMap.InputState.Up;Input.OnMouseInput.Dispatch(a)};App.prototype.OnMouseMove=function(b){var a=new InputMap();a.Value=InputMap.InputKey.MouseLeft;a.Position=new Point(b.pageX-this.offsetLeft,b.pageY-this.offsetTop);a.State=InputMap.InputState.Move;Input.OnMouseInput.Dispatch(a)};function EntityStoryboard(){Storyboard.call(this);this.OnUpdate.Add(this.OnStoryUpdate,this)}EntityStoryboard.prototype=new Storyboard();EntityStoryboard.prototype.constructor=EntityStoryboard;EntityStoryboard.TargetProperty={None:0,Position:1,Size:2,Rotation:3,Alpha:4};EntityStoryboard.prototype.OnStoryUpdate=function(b){for(var a=0;a<b.length;++a){if(b[a].Target!=null){if(b[a].Value!=null){if(b[a].TargetProperty==EntityStoryboard.TargetProperty.Alpha){if(b[a].Target.ObjectMaterial!=null){b[a].Target.ObjectMaterial.Alpha=isNaN(b[a].Value)?b[a].OriginatingValue:b[a].Value}else{b[a].Target.Opacity=isNaN(b[a].Value)?b[a].OriginatingValue:b[a].Value}}}else{if(b[a].KeyPoint!=null){if(b[a].TargetProperty==EntityStoryboard.TargetProperty.Position){if(b[a].Target.ObjectMatrix!=null){b[a].Target.ObjectMatrix.Translate(isNaN(b[a].KeyPoint.x)?b[a].OriginatingPoint.x:b[a].KeyPoint.x,isNaN(b[a].KeyPoint.y)?b[a].OriginatingPoint.y:b[a].KeyPoint.y,isNaN(b[a].KeyPoint.z)?b[a].OriginatingPoint.z:b[a].KeyPoint.z)}else{b[a].Target.Position.x=isNaN(b[a].KeyPoint.x)?b[a].OriginatingPoint.x:b[a].KeyPoint.x;b[a].Target.Position.y=isNaN(b[a].KeyPoint.y)?b[a].OriginatingPoint.y:b[a].KeyPoint.y}}else{if(b[a].TargetProperty==EntityStoryboard.TargetProperty.Rotation){if(b[a].Target.ObjectMatrix!=null){b[a].Target.ObjectMatrix.Rotate(isNaN(b[a].KeyPoint.x)?b[a].OriginatingPoint.x:b[a].KeyPoint.x,isNaN(b[a].KeyPoint.y)?b[a].OriginatingPoint.y:b[a].KeyPoint.y,isNaN(b[a].KeyPoint.z)?b[a].OriginatingPoint.z:b[a].KeyPoint.z)}else{b[a].Target.Rotation.z=isNaN(b[a].KeyPoint.z)?b[a].OriginatingPoint.z:b[a].KeyPoint.z}}else{if(b[a].TargetProperty==EntityStoryboard.TargetProperty.Size){if(b[a].Target.ObjectMatrix!=null){b[a].Target.ObjectMatrix.Scale(isNaN(b[a].KeyPoint.x)?b[a].OriginatingPoint.x:b[a].KeyPoint.x,isNaN(b[a].KeyPoint.y)?b[a].OriginatingPoint.y:b[a].KeyPoint.y,isNaN(b[a].KeyPoint.z)?b[a].OriginatingPoint.z:b[a].KeyPoint.z)}else{b[a].Target.Size.x=isNaN(b[a].KeyPoint.x)?b[a].OriginatingPoint.x:b[a].KeyPoint.x;b[a].Target.Size.y=isNaN(b[a].KeyPoint.y)?b[a].OriginatingPoint.y:b[a].KeyPoint.y}}}}}}}}};function BlendState(){this.AlphaBlendFunction=BlendState.BlendFunction.Add;this.AlphaDestinationBlend=BlendState.Blend.One;this.AlphaSourceBlend=BlendState.Blend.One;this.BlendEnable=true;this.ColorBlendFunction=BlendState.BlendFunction.Add;this.ColorDestinationBlend=BlendState.Blend.One;this.ColorSourceBlend=BlendState.Blend.One;this.ColorWriteChannels=BlendState.ColorWriteChannels.All;this.MultiSampleMask=-1}BlendState.Blend={SourceColor:0,InverseSourceColor:1,SourceAlpha:2,InverseSourceAlpha:3,DestinationAlpha:4,InverseDestinationAlpha:5,DestinationColor:6,InverseDestinationColor:7,SourceAlphaSaturation:8,Zero:9,One:10};BlendState.BlendFunction={Add:0,Min:1,Max:2,Subtract:4,ReverseSubtract:5};BlendState.ColorWriteChannels={None:0,Red:1,Green:2,Blue:3,Alpha:4,All:5};function DepthStencilState(){this.CounterClockwiseStencilDepthBufferFail=DepthStencilState.StencilOperation.Keep;this.CounterClockwiseStencilFail=DepthStencilState.StencilOperation.Keep;this.CounterClockwiseStencilFunction=DepthStencilState.CompareFunction.Always;this.CounterClockwiseStencilPass=DepthStencilState.StencilOperation.Keep;this.DepthBufferEnable=true;this.DepthBufferFunction=DepthStencilState.CompareFunction.LessEqual;this.DepthBufferWriteEnable=true;this.ReferenceStencil=0;this.StencilDepthBufferFail=DepthStencilState.StencilOperation.Keep;this.StencilEnable=false;this.StencilFail=DepthStencilState.StencilOperation.Keep;this.StencilFunction=DepthStencilState.CompareFunction.Always;this.StencilMask=-1;this.StencilPass=DepthStencilState.StencilOperation.Keep;this.StencilWriteMask=-1;this.TwoSidedStencilMode=false}DepthStencilState.StencilOperation={Keep:0,Replace:1,Increment:2,Decrement:3};DepthStencilState.CompareFunction={Never:0,Less:1,Equal:2,LessEqual:3,Greater:4,NotEqual:5,GreaterEqual:6,Always:7};function RasterizerState(){this.Cull=RasterizerState.CullMode.CullCounterClockwiseFace;this.Fill=true;this.DepthBias=0;this.MultiSampleAntiAlias=true;this.SlopeScaleDepthBias=0}RasterizerState.CullMode={CullNone:0,CullClockwise:1,CullCounterClockwiseFace:2};function SamplerState(a){this.AddressU=(a!=null)?a.AddressU:SamplerState.TextureAddressMode.Repeat;this.AddressV=(a!=null)?a.AddressV:SamplerState.TextureAddressMode.Repeat;this.AddressW=(a!=null)?a.AddressW:SamplerState.TextureAddressMode.Repeat;this.Filter=(a!=null)?a.Filter:SamplerState.TextureFilter.Linear;this.HasMipMap=(a!=null)?a.HasMipMap:false;this.MaxAnisotropy=(a!=null)?a.MaxAnisotropy:4;this.MaxMipLevel=(a!=null)?a.MaxMipLevel:0}SamplerState.TextureAddressMode={Clamp:0,Repeat:1};SamplerState.TextureFilter={Linear:1,Point:2,Anisotropic:4,LinearMipPoint:8,PointMipLinear:16,MinLinearMagPointMipLinear:32,MinLinearMagPointMipPoint:64,MinPointMagLinearMipLinear:128,MinPointMagLinearMipPoint:256};SamplerState.LinearClamp=new SamplerState();SamplerState.LinearClamp.AddressU=SamplerState.TextureAddressMode.Clamp;SamplerState.LinearClamp.AddressV=SamplerState.TextureAddressMode.Clamp;SamplerState.LinearClamp.AddressW=SamplerState.TextureAddressMode.Clamp;SamplerState.LinearClamp.Filter=SamplerState.TextureFilter.Linear;SamplerState.LinearRepeat=new SamplerState();SamplerState.LinearRepeat.AddressU=SamplerState.TextureAddressMode.Repeat;SamplerState.LinearRepeat.AddressV=SamplerState.TextureAddressMode.Repeat;SamplerState.LinearRepeat.AddressW=SamplerState.TextureAddressMode.Repeat;SamplerState.LinearRepeat.Filter=SamplerState.TextureFilter.Linear;SamplerState.PointClamp=new SamplerState();SamplerState.PointClamp.AddressU=SamplerState.TextureAddressMode.Clamp;SamplerState.PointClamp.AddressV=SamplerState.TextureAddressMode.Clamp;SamplerState.PointClamp.AddressW=SamplerState.TextureAddressMode.Clamp;SamplerState.PointClamp.Filter=SamplerState.TextureFilter.Point;SamplerState.PointRepeat=new SamplerState();SamplerState.PointRepeat.AddressU=SamplerState.TextureAddressMode.Repeat;SamplerState.PointRepeat.AddressV=SamplerState.TextureAddressMode.Repeat;SamplerState.PointRepeat.AddressW=SamplerState.TextureAddressMode.Repeat;SamplerState.PointRepeat.Filter=SamplerState.TextureFilter.Point;function GLShader(){this.ShaderType={Vertex:0,Fragment:1};this.Name=null;this.Shader=null}GLShader.prototype.Create=function(a,b){this.Release();if(a==this.ShaderType.Vertex){this.Shader=gl.createShader(gl.VERTEX_SHADER)}else{this.Shader=gl.createShader(gl.FRAGMENT_SHADER)}if(this.Shader!=null){gl.shaderSource(this.Shader,b);gl.compileShader(this.Shader);return gl.getShaderParameter(this.Shader,gl.COMPILE_STATUS)}return false};GLShader.prototype.Release=function(){gl.deleteShader(this.Shader);this.Shader=null};GLShader.prototype.GetLog=function(){return gl.getShaderInfoLog(this.Shader)};function GLShaderProgram(){this.Name=null;this.Program=null}GLShaderProgram.prototype.Create=function(){this.Release();this.Program=gl.createProgram()};GLShaderProgram.prototype.Load=function(){gl.useProgram(this.Program)};GLShaderProgram.prototype.Release=function(){gl.deleteProgram(this.Program);this.Program=null};GLShaderProgram.prototype.AddShader=function(a){gl.attachShader(this.Program,a.Shader)};GLShaderProgram.prototype.RemoveShader=function(a){gl.detachShader(this.Program,a.Shader)};GLShaderProgram.prototype.Link=function(){gl.linkProgram(this.Program);return gl.getProgramParameter(this.Program,gl.LINK_STATUS)};GLShaderProgram.prototype.GetAttribute=function(a){return gl.getAttribLocation(this.Program,a)};GLShaderProgram.prototype.GetVariable=function(a){return gl.getUniformLocation(this.Program,a)};GLShaderProgram.prototype.SetVariableIntByName=function(c,a,e,d,b){this.SetVariableInt(gl.getUniformLocation(this.Program,c),a,e,d,b)};GLShaderProgram.prototype.SetVariableInt=function(c,a,e,d,b){if(e==null){gl.uniform1i(c,a)}else{if(d==null){gl.uniform2i(c,a,e)}else{if(b==null){gl.uniform3i(c,a,e,d)}else{gl.uniform4i(c,a,e,d,b)}}}};GLShaderProgram.prototype.SetVariableByName=function(c,a,e,d,b){this.SetVariable(gl.getUniformLocation(this.Program,c),a,e,d,b)};GLShaderProgram.prototype.SetVariable=function(c,a,e,d,b){if(e==null){gl.uniform1f(c,a)}else{if(d==null){gl.uniform2f(c,a,e)}else{if(b==null){gl.uniform3f(c,a,e,d)}else{gl.uniform4f(c,a,e,d,b)}}}};GLShaderProgram.prototype.SetMatrixByName=function(b,a,c){this.SetMatrix(gl.getUniformLocation(this.Program,b),a,c)};GLShaderProgram.prototype.SetMatrix=function(b,a,c){if(c==2){gl.uniformMatrix2fv(b,false,a)}else{if(c==3){gl.uniformMatrix3fv(b,false,a)}else{if(c>3){gl.uniformMatrix4fv(b,false,a)}}}};GLShaderProgram.prototype.GetLog=function(){return gl.getProgramInfoLog(this.Program)};function GLVertexBufferObject(){this.VertexBuffer=null;this.UvBuffer=null;this.NormalBuffer=null;this.ColourBuffer=null;this.BoneBuffer=null;this.BoneWeightBuffer=null;this.IndexBuffer=null;this.Type;this.Mesh=null}GLVertexBufferObject.BufferType={Static:0,Dynamic:1};GLVertexBufferObject.prototype.Create=function(b,a){this.Release();this.Mesh=b;if((a==null)||(a==GLVertexBufferObject.BufferType.Static)){a=gl.STATIC_DRAW}else{a=gl.DYNAMIC_DRAW}this.Type=a;this.VertexBuffer=gl.createBuffer();if(this.VertexBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.VertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.VertexPoint,a);if(b.UV!=null){this.UvBuffer=gl.createBuffer();if(this.UvBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.UvBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.UV,a)}if(b.Normal!=null){this.NormalBuffer=gl.createBuffer();if(this.NormalBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.NormalBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.Normal,a)}if(b.Colour!=null){this.ColourBuffer=gl.createBuffer();if(this.ColourBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.ColourBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.Colour,a)}if(b.Bone!=null){this.BoneBuffer=gl.createBuffer();if(this.BoneBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.BoneBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.Bone,a)}if(b.BoneWeight!=null){this.BoneWeightBuffer=gl.createBuffer();if(this.BoneWeightBuffer==null){this.Release();return false}gl.bindBuffer(gl.ARRAY_BUFFER,this.BoneWeightBuffer);gl.bufferData(gl.ARRAY_BUFFER,b.BoneWeight,a)}if(b.Index!=null){this.IndexBuffer=gl.createBuffer();if(this.IndexBuffer==null){this.Release();return false}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.IndexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,b.Index,a)}return true};GLVertexBufferObject.prototype.Release=function(){if(this.VertexBuffer!=null){gl.deleteBuffer(this.VertexBuffer);this.VertexBuffer=null}if(this.UvBuffer!=null){gl.deleteBuffer(this.UvBuffer);this.UvBuffer=null}if(this.NormalBuffer!=null){gl.deleteBuffer(this.NormalBuffer);this.NormalBuffer=null}if(this.ColourBuffer!=null){gl.deleteBuffer(this.ColourBuffer);this.ColourBuffer=null}if(this.BoneBuffer!=null){gl.deleteBuffer(this.BoneBuffer);this.BoneBuffer=null}if(this.BoneWeightBuffer!=null){gl.deleteBuffer(this.BoneWeightBuffer);this.BoneWeightBuffer=null}if(this.IndexBuffer!=null){gl.deleteBuffer(this.IndexBuffer);this.IndexBuffer=null}this.Mesh=null};GLVertexBufferObject.prototype.UpdateVertexBuffer=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.VertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.Mesh.VertexPoint,this.Type)};GLVertexBufferObject.prototype.UpdateNormalBuffer=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.NormalBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.Mesh.Normal,this.Type)};GLVertexBufferObject.prototype.UpdateColourBuffer=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.ColourBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.Mesh.Colour,this.Type)};GLVertexBufferObject.prototype.UpdateBoneBuffer=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.BoneBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.Mesh.Bone,this.Type);gl.bindBuffer(gl.ARRAY_BUFFER,this.BoneWeightBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.Mesh.BoneWeight,this.Type)};GLVertexBufferObject.prototype.UpdateIndex=function(){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.IndexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.Mesh.Index),this.Type)};function GLTexture(){Texture.call(this);this.mTextureType;this.Texture=null;this.mSampler=null;this.mGlInternalFormat=0;this.mGlFormat=0;this.mGlType=0}GLTexture.prototype=new Texture();GLTexture.prototype.constructor=GLTexture;GLTexture.TextureType={Texture2D:3553,TextureCube:34067};GLTexture.prototype.Create=function(c,a,d,b){this.Release();this.mWidth=c;this.mHeight=a;this.mFormat=d;this.mSampler=b;this.Texture=gl.createTexture();if(this.Texture!=null){gl.bindTexture(this.mTextureType,this.Texture);gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);gl.texParameteri(this.mTextureType,gl.TEXTURE_WRAP_S,(b.AddressU==SamplerState.TextureAddressMode.Clamp)?gl.CLAMP_TO_EDGE:gl.REPEAT);gl.texParameteri(this.mTextureType,gl.TEXTURE_WRAP_T,(b.AddressV==SamplerState.TextureAddressMode.Clamp)?gl.CLAMP_TO_EDGE:gl.REPEAT);if(b.Filter&SamplerState.TextureFilter.Linear){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,b.HasMipMap?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR)}else{if(b.Filter&SamplerState.TextureFilter.Point){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,b.HasMipMap?gl.NEAREST_MIPMAP_NEAREST:gl.NEAREST)}else{if(b.Filter&SamplerState.TextureFilter.LinearMipPoint){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST)}else{if(b.Filter&SamplerState.TextureFilter.PointMipLinear){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_LINEAR)}else{if(b.Filter&SamplerState.TextureFilter.MinLinearMagPointMipLinear){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR)}else{if(b.Filter&SamplerState.TextureFilter.MinLinearMagPointMipPoint){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST)}else{if(b.Filter&SamplerState.TextureFilter.MinPointMagLinearMipLinear){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_LINEAR)}else{if(b.Filter&SamplerState.TextureFilter.MinPointMagLinearMipPoint){gl.texParameteri(this.mTextureType,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(this.mTextureType,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_NEAREST)}}}}}}}}if(b.Filter&SamplerState.TextureFilter.Anisotropic){gl.texParameterf(this.mTextureType,gl.TEXTURE_MAX_ANISOTROPY_EXT,b.MaxAnisotropy)}this.mGlInternalFormat=gl.RGBA;this.mGlFormat=gl.RGBA;this.mGlType=gl.UNSIGNED_BYTE;if(d==Texture.Format.Rgba){}else{if(d==Texture.Format.Rgb){this.mGlInternalFormat=gl.RGB;this.mGlFormat=gl.RGB}else{if(d==Texture.Format.Dxt1){this.mGlInternalFormat=gl.COMPRESSED_RGBA_S3TC_DXT1_EXT}else{if(d==Texture.Format.Dxt3){this.mGlInternalFormat=gl.COMPRESSED_RGBA_S3TC_DXT3_EXT}else{if(d==Texture.Format.Dxt5){this.mGlInternalFormat=gl.COMPRESSED_RGBA_S3TC_DXT5_EXT}else{if(d==Texture.Format.Rg32){this.mGlInternalFormat=gl.LUMINANCE_ALPHA;this.mGlFormat=gl.LUMINANCE_ALPHA;this.mGlType=gl.UNSIGNED_SHORT}else{if(d==Texture.Format.Rgba64){this.mGlType=gl.SHORT}else{if(d==Texture.Format.Alpha8){this.mGlInternalFormat=gl.LUMINANCE;this.mGlFormat=gl.LUMINANCE}else{if(d==Texture.Format.Single){this.mGlInternalFormat=gl.LUMINANCE32F_ARB;this.mGlFormat=gl.LUMINANCE;this.mGlType=gl.FLOAT}else{if(d==Texture.Format.Vector2){this.mGlInternalFormat=gl.LUMINANCE_ALPHA32F_ARB;this.mGlFormat=gl.LUMINANCE_ALPHA;this.mGlType=gl.FLOAT}else{if(d==Texture.Format.Vector4){this.mGlInternalFormat=gl.RGBA32F_ARB;this.mGlType=gl.FLOAT}else{if(d==Texture.Format.Depth){this.mGlInternalFormat=gl.DEPTH_COMPONENT;this.mGlFormat=gl.DEPTH_COMPONENT}else{if(d==Texture.Format.Depth16){this.mGlInternalFormat=gl.DEPTH_COMPONENT16;this.mGlFormat=gl.DEPTH_COMPONENT}else{if(d==Texture.Format.Depth24){this.mGlInternalFormat=gl.DEPTH_COMPONENT24;this.mGlFormat=gl.DEPTH_COMPONENT}else{if(d==Texture.Format.Depth32){this.mGlInternalFormat=gl.DEPTH_COMPONENT32;this.mGlFormat=gl.DEPTH_COMPONENT}}}}}}}}}}}}}}}}};GLTexture.prototype.CreateMipmaps=function(){gl.bindTexture(this.mTextureType,this.Texture);gl.generateMipmap(this.mTextureType)};GLTexture.prototype.Release=function(){if(this.Texture!=null){gl.deleteTexture(this.Texture);this.Texture=null;this.mWidth=0;this.mHeight=0;this.mGlInternalFormat=0;this.mGlFormat=0;this.mGlType=0}};GLTexture.prototype.Bind=function(){gl.bindTexture(this.mTextureType,this.Texture)};GLTexture.prototype.GetTextureType=function(){return this.mTextureType};GLTexture.prototype.GetTextureId=function(){return this.Texture};GLTexture.prototype.GetSamplerState=function(){return this.mSampler};function GLTexture2D(){GLTexture.call(this);this.mTextureType=GLTexture.TextureType.Texture2D}GLTexture2D.prototype=new GLTexture();GLTexture2D.prototype.constructor=GLTexture2D;GLTexture2D.prototype.Create=function(c,a,e,b,d){GLTexture.prototype.Create.call(this,c,a,e,b);if(this.Texture!=null){if(d==null){gl.texImage2D(gl.TEXTURE_2D,0,this.mGlInternalFormat,c,a,0,this.mGlFormat,this.mGlType,null)}else{gl.texImage2D(gl.TEXTURE_2D,0,this.mGlInternalFormat,this.mGlFormat,this.mGlType,d)}if(b.HasMipMap){gl.generateMipmap(gl.TEXTURE_2D)}}};GLTexture2D.prototype.Copy=function(a){this.CopyTo(0,0,this.mWidth,this.mHeight,a)};GLTexture2D.prototype.CopyTo=function(b,e,c,a,d){gl.bindTexture(gl.TEXTURE_2D,this.Texture);if(d.width!=null){gl.texSubImage2D(gl.TEXTURE_2D,0,b,e,this.mGlFormat,this.mGlType,d)}else{gl.texSubImage2D(gl.TEXTURE_2D,0,b,e,c,a,this.mGlFormat,this.mGlType,new Uint8Array(d))}};function GLTextureCube(){GLTexture.call(this);this.CubeFace={PositiveX:gl.TEXTURE_CUBE_MAP_POSITIVE_X,NegativeX:gl.TEXTURE_CUBE_MAP_NEGATIVE_X,PositiveY:gl.TEXTURE_CUBE_MAP_POSITIVE_Y,NegativeY:gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,PositiveZ:gl.TEXTURE_CUBE_MAP_POSITIVE_Z,NegativeZ:gl.TEXTURE_CUBE_MAP_NEGATIVE_Z};this.mTextureType=GLTexture.TextureType.TextureCube}GLTextureCube.prototype=new GLTexture();GLTextureCube.prototype.constructor=GLTextureCube;GLTextureCube.prototype.Create=function(d,a,e,c){GLTexture.prototype.Create.call(this,d,a,e,c);if(this.Texture!=null){for(var b=0;b<6;++b){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,this.mGlInternalFormat,d,a,0,this.mGlFormat,this.mGlType,null)}if(c.HasMipMap){gl.generateMipmap(gl.TEXTURE_CUBE_MAP)}}};GLTextureCube.prototype.Copy=function(a,b){this.CopyTo(a,0,0,this.mWidth,this.mHeight,b)};GLTextureCube.prototype.CopyTo=function(d,b,f,c,a,e){gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.Texture);if(e.width!=null){gl.texSubImage2D(d,0,b,f,this.mGlFormat,this.mGlType,e)}else{gl.texSubImage2D(d,0,b,f,c,a,this.mGlFormat,this.mGlType,new Uint8Array(e))}};function FrameBufferObject(a){this.Type=(a!=null)?a:FrameBufferObject.BufferType.Colour;this.Id=null;this.RenderBufferFormat=Texture.Format.Rgba;this.TextureObject=null}FrameBufferObject.BufferType={Colour:0,Depth:1,Stencil:2};function GLFrameBufferObject(){this.mFrameBufferID=null;this.mFrameWidth=null;this.mFrameHeight=null;this.mColourBuffer=null;this.mDepthBuffer=null;this.mStencilBuffer=null}GLFrameBufferObject.prototype.Create=function(b,a){this.Release();this.mFrameWidth=b;this.mFrameHeight=a;this.mFrameBufferID=gl.createFramebuffer();return(this.mFrameBufferID!=null)};GLFrameBufferObject.prototype.AttachBuffer=function(a){if(this.mFrameBufferID!=null){var b=(a.Type==FrameBufferObject.BufferType.Colour)?this.mColourBuffer:(a.Type==FrameBufferObject.BufferType.Depth)?this.mDepthBuffer:this.mStencilBuffer;if((b!=null)&&(b.Id!=null)){if(b.TextureObject==null){gl.deleteRenderbuffer(b.Id)}b.Id=null}b=a;gl.bindFramebuffer(gl.FRAMEBUFFER,this.mFrameBufferID);if(b.TextureObject!=null){if((b.TextureObject.GetWidth()!=this.mFrameWidth)&&(b.TextureObject.GetHeight()!=this.mFrameHeight)){b.TextureObject.Create(this.mFrameWidth,this.mFrameHeight,b.TextureObject.GetFormat(),b.TextureObject.GetSamplerState())}b.Id=b.TextureObject.GetTextureId();if(b.Id==null){return false}gl.framebufferTexture2D(gl.FRAMEBUFFER,(a.Type==FrameBufferObject.BufferType.Colour)?gl.COLOR_ATTACHMENT0:(a.Type==FrameBufferObject.BufferType.Depth)?gl.DEPTH_ATTACHMENT:gl.STENCIL_ATTACHMENT,(b.TextureObject.GetTextureType()==GLTexture.TextureType.TextureCube)?gl.TEXTURE_CUBE_MAP_POSITIVE_X:gl.TEXTURE_2D,b.Id,0)}else{b.Id=gl.createRenderbuffer();if(b.Id==null){return false}gl.bindRenderbuffer(gl.RENDERBUFFER,b.Id);gl.renderbufferStorage(gl.RENDERBUFFER,(b.RenderBufferFormat==Texture.Format.Rgba)?gl.RGBA:(b.RenderBufferFormat==Texture.Format.Rgb)?gl.RGB:(b.RenderBufferFormat==Texture.Format.Depth)?gl.DEPTH_COMPONENT:(b.RenderBufferFormat==Texture.Format.Depth16)?gl.DEPTH_COMPONENT16:(b.RenderBufferFormat==Texture.Format.Depth24)?gl.DEPTH_COMPONENT24:(b.RenderBufferFormat==Texture.Format.Depth32)?gl.DEPTH_COMPONENT32:(b.RenderBufferFormat==Texture.Format.Alpha8)?gl.LUMINANCE:gl.LUMINANCE_ALPHA,this.mFrameWidth,this.mFrameHeight);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,(a.Type==FrameBufferObject.BufferType.Colour)?gl.COLOR_ATTACHMENT0:(a.Type==FrameBufferObject.BufferType.Depth)?gl.DEPTH_ATTACHMENT:gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,b.Id);gl.bindRenderbuffer(gl.RENDERBUFFER,null)}gl.bindFramebuffer(gl.FRAMEBUFFER,null);if(a.Type==FrameBufferObject.BufferType.Colour){this.mColourBuffer=b}else{if(a.Type==FrameBufferObject.BufferType.Depth){this.mDepthBuffer=b}else{this.mStencilBuffer=b}}return true}return false};GLFrameBufferObject.prototype.Resize=function(b,a){if(this.mFrameBufferID!=null){this.mFrameWidth=b;this.mFrameHeight=a;if(this.mColourBuffer!=null){this.AttachBuffer(this.mColourBuffer)}if(this.mDepthBuffer!=null){this.AttachBuffer(this.mDepthBuffer)}if(this.mStencilBuffer!=null){this.AttachBuffer(this.mStencilBuffer)}}};GLFrameBufferObject.prototype.Release=function(){if(this.mColourBuffer!=null){if(this.mColourBuffer.TextureObject==null){gl.deleteRenderbuffer(this.mColourBuffer.Id)}this.mColourBuffer=null}if(this.mDepthBuffer!=null){if(this.mDepthBuffer.TextureObject==null){gl.deleteRenderbuffer(this.mDepthBuffer.Id)}this.mDepthBuffer=null}if(this.mStencilBuffer!=null){if(this.mStencilBuffer.TextureObject==null){gl.deleteRenderbuffer(this.mStencilBuffer.Id)}this.mStencilBuffer=null}if(this.mFrameBufferID!=null){gl.deleteFramebuffer(this.mFrameBufferID);this.mFrameBufferID=null}this.mFrameWidth=0;this.mFrameHeight=0};GLFrameBufferObject.prototype.Enable=function(){gl.bindFramebuffer(gl.FRAMEBUFFER,this.mFrameBufferID)};GLFrameBufferObject.prototype.EnableCubemap=function(a){gl.bindFramebuffer(gl.FRAMEBUFFER,this.mFrameBufferID);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,a,this.mColourBuffer.Id,0)};GLFrameBufferObject.prototype.Disable=function(){gl.bindFramebuffer(gl.FRAMEBUFFER,null)};GLFrameBufferObject.prototype.GetFrameWidth=function(){return this.mFrameWidth};GLFrameBufferObject.prototype.GetFrameHeight=function(){return this.mFrameHeight};function GLDraw(){}GLDraw.prototype.Draw=function(d,b,a,c){if(a==null){a=b.Mesh.GetNumPoints()}if(c==null){c=b.Mesh.GetNumIndices()}gl.bindBuffer(gl.ARRAY_BUFFER,b.VertexBuffer);gl.vertexAttribPointer(d.VertexPointer,3,gl.FLOAT,false,0,0);if(d.UvPointer!=null){gl.bindBuffer(gl.ARRAY_BUFFER,b.UvBuffer);gl.vertexAttribPointer(d.UvPointer,2,gl.FLOAT,false,0,0)}if(b.NormalBuffer!=null){gl.bindBuffer(gl.ARRAY_BUFFER,b.NormalBuffer);gl.vertexAttribPointer(d.NormalPointer,3,gl.FLOAT,false,0,0)}if(b.ColourBuffer!=null){gl.bindBuffer(gl.ARRAY_BUFFER,b.ColourBuffer);gl.vertexAttribPointer(d.ColourPointer,4,gl.FLOAT,false,0,0)}if(b.Mesh.Index!=null){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,b.IndexBuffer);gl.drawElements(gl.TRIANGLES,c,gl.UNSIGNED_SHORT,0)}else{gl.drawArrays(gl.TRIANGLES,0,b.Mesh.GetNumPoints())}};function GLRenderState(){this.Rasterizer=new RasterizerState();this.DepthStencil=new DepthStencilState();this.Blend=new BlendState()}GLRenderState.prototype.Set=function(){if(this.Rasterizer.Cull==RasterizerState.CullMode.CullNone){gl.disable(gl.CULL_FACE)}else{gl.enable(gl.CULL_FACE);gl.frontFace((this.Rasterizer.Cull==RasterizerState.CullMode.CullCounterClockwiseFace)?gl.CCW:gl.CW)}if((this.Rasterizer.SlopeScaleDepthBias!=0)||(this.Rasterizer.DepthBias!=0)){gl.enable(gl.POLYGON_OFFSET_FILL);gl.polygonOffset(this.Rasterizer.SlopeScaleDepthBias,this.Rasterizer.DepthBias)}else{gl.disable(gl.POLYGON_OFFSET_FILL)}if(this.DepthStencil.DepthBufferEnable){gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.NEVER+this.DepthStencil.DepthBufferFunction)}else{gl.disable(gl.DEPTH_TEST)}gl.depthMask(this.DepthStencil.DepthBufferWriteEnable);if(this.DepthStencil.StencilEnable){gl.enable(gl.STENCIL_TEST);gl.stencilOpSeparate(gl.FRONT,gl.KEEP+this.DepthStencil.CounterClockwiseStencilFail,gl.KEEP+this.DepthStencil.CounterClockwiseStencilDepthBufferFail,gl.KEEP+this.DepthStencil.CounterClockwiseStencilPass);gl.stencilOpSeparate(gl.BACK,gl.KEEP+this.DepthStencil.StencilFail,gl.KEEP+this.DepthStencil.StencilDepthBufferFail,gl.KEEP+this.DepthStencil.StencilPass);gl.stencilFunc(gl.NEVER+this.DepthStencil.StencilFunction,this.DepthStencil.ReferenceStencil,this.DepthStencil.StencilMask)}else{gl.disable(gl.STENCIL_TEST)}if(this.Blend.BlendEnable){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD+this.Blend.AlphaBlendFunction);gl.blendFunc((this.Blend.ColorSourceBlend==BlendState.Blend.Zero)?gl.ZERO:(this.Blend.ColorSourceBlend==BlendState.Blend.One)?gl.ONE:gl.SRC_COLOR+this.Blend.ColorSourceBlend,(this.Blend.ColorDestinationBlend==BlendState.Blend.Zero)?gl.ZERO:(this.Blend.ColorDestinationBlend==BlendState.Blend.One)?gl.ONE:gl.SRC_COLOR+this.Blend.ColorDestinationBlend)}else{gl.disable(gl.BLEND)}gl.colorMask((this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.All)||(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.Red),(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.All)||(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.Green),(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.All)||(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.Blue),(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.All)||(this.Blend.ColorWriteChannels==BlendState.ColorWriteChannels.Alpha))};function GLGraphicsContext(b){GraphicsContext.call(this);this.mVertexShader=null;this.mFragmentShader=null;this.mShaderProgram=null;this.mProjectionId;this.mSampleId;this.mSpriteRectId;this.mOriginId;this.mPositionId;this.mRotationId;this.mScaleId;this.mColourId;this.mRect;var a=null;gl=b.getContext("experimental-webgl");this.Init()}GLGraphicsContext.prototype=new GraphicsContext();GLGraphicsContext.prototype.constructor=GLGraphicsContext;GLGraphicsContext.mVertexSource="attribute vec3 Vertex;attribute vec2 Uv;uniform mat4 ProjectionMatrix;uniform vec4 SpriteRect;uniform vec2 SpriteOrigin;uniform vec2 SpritePosition;uniform float SpriteRotation;uniform vec2 SpriteScale;varying vec2 vUv;void main (){	vec2 position = vec2(Vertex.x * SpriteScale.x,						 Vertex.y * SpriteScale.y);	position -= SpriteOrigin;	vec2 offset = SpritePosition + SpriteOrigin;	gl_Position = ProjectionMatrix * vec4((position.x * cos(SpriteRotation) + position.y * sin(SpriteRotation)) + offset.x,										  (position.y * cos(SpriteRotation) - position.x * sin(SpriteRotation)) + offset.y,										  0.1,										  1.0);	vUv = SpriteRect.xy + (Uv * SpriteRect.zw);}";GLGraphicsContext.mFragmentSource="#ifdef GL_ES\n	precision highp float;\n#endif\nuniform sampler2D Sample0;uniform vec4 SpriteColour;varying vec2 vUv;void main (){	gl_FragColor = SpriteColour * texture2D(Sample0, vUv);}";GLGraphicsContext.prototype.Init=function(){this.Release();this.mVertexShader=new GLShader();this.mVertexShader.Create(this.mVertexShader.ShaderType.Vertex,GLGraphicsContext.mVertexSource);this.mFragmentShader=new GLShader();this.mFragmentShader.Create(this.mFragmentShader.ShaderType.Fragment,GLGraphicsContext.mFragmentSource);this.mShaderProgram=new GLBaseShader();this.mShaderProgram.Create();this.mShaderProgram.AddShader(this.mVertexShader);this.mShaderProgram.AddShader(this.mFragmentShader);this.mShaderProgram.Link();this.mShaderProgram.Init();this.mSampleId=this.mShaderProgram.GetVariable("Sample0");this.mProjectionId=this.mShaderProgram.GetVariable("ProjectionMatrix");this.mSpriteRectId=this.mShaderProgram.GetVariable("SpriteRect");this.mOriginId=this.mShaderProgram.GetVariable("SpriteOrigin");this.mPositionId=this.mShaderProgram.GetVariable("SpritePosition");this.mRotationId=this.mShaderProgram.GetVariable("SpriteRotation");this.mScaleId=this.mShaderProgram.GetVariable("SpriteScale");this.mColourId=this.mShaderProgram.GetVariable("SpriteColour");var a=new Rectangle(1,1);a.VertexPoint[0]=0;a.VertexPoint[1]=0;a.VertexPoint[4]=0;a.VertexPoint[9]=0;this.mRect=new GLVertexBufferObject();this.mRect.Create(a,GLVertexBufferObject.BufferType.Static);gl.clearColor(0,0,0,0);gl.clearDepth(1)};GLGraphicsContext.prototype.SetViewport=function(b,a){GraphicsContext.prototype.SetViewport.call(this,b,a);gl.viewport(0,0,b,a);this.mProjectionMatrix=ViewMatrix.OrthographicRect(0,b,a,0,-1,1)};GLGraphicsContext.prototype.Release=function(){if(this.mShaderProgram!=null){this.mShaderProgram.Release();this.mShaderProgram=null}if(this.mVertexShader!=null){this.mVertexShader.Release();this.mVertexShader=null}if(this.FragmentShader!=null){this.FragmentShader.Release();this.FragmentShader=null}if(this.mRect!=null){this.mRect.Release();this.mRect=null}};GLGraphicsContext.prototype.Begin=function(){this.mShaderProgram.Enable();this.mShaderProgram.SetVariable(this.mSampleId,0);this.mShaderProgram.SetMatrix(this.mProjectionId,this.mProjectionMatrix.MMatrix,4);gl.activeTexture(gl.TEXTURE0)};GLGraphicsContext.prototype.End=function(){this.mShaderProgram.Disable()};GLGraphicsContext.prototype.Clear=function(a){if(a){gl.clearColor(a.x,a.y,a.z,a.w)}gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)};GLGraphicsContext.prototype.DrawImage=function(e,g,h,c,d,f){var a=e.GetWidth();var b=e.GetHeight();gl.bindTexture(gl.TEXTURE_2D,e.Texture);this.mShaderProgram.SetVariable(this.mSpriteRectId,g.x/a,g.y/b,g.z/a,g.w/b);this.mShaderProgram.SetVariable(this.mOriginId,c.x,c.y);this.mShaderProgram.SetVariable(this.mPositionId,h.x,h.y);this.mShaderProgram.SetVariable(this.mRotationId,d);this.mShaderProgram.SetVariable(this.mScaleId,h.z,h.w);this.mShaderProgram.SetVariable(this.mColourId,f.x,f.y,f.z,f.w);this.mShaderProgram.Draw(this.mRect)};function GLBaseShader(){GLShaderProgram.call(this);this.mAttribVertex=-1;this.mAttribUv=-1;this.mAttribNormal=-1;this.mAttribColour=-1;this.mAttribBone=-1;this.mAttribBoneWeight=-1}GLBaseShader.prototype=new GLShaderProgram();GLBaseShader.prototype.constructor=GLBaseShader;GLBaseShader.prototype.Init=function(){this.mAttribVertex=this.GetAttribute("Vertex");this.mAttribUv=this.GetAttribute("Uv");this.mAttribNormal=this.GetAttribute("Normal");this.mAttribColour=this.GetAttribute("Colour");this.mAttribBone=this.GetAttribute("Bone");this.mAttribBoneWeight=this.GetAttribute("BoneWeight")};GLBaseShader.prototype.Enable=function(){this.Load();if(this.mAttribVertex!=-1){gl.enableVertexAttribArray(this.mAttribVertex)}if(this.mAttribUv!=-1){gl.enableVertexAttribArray(this.mAttribUv)}if(this.mAttribNormal!=-1){gl.enableVertexAttribArray(this.mAttribNormal)}if(this.mAttribColour!=-1){gl.enableVertexAttribArray(this.mAttribColour)}if(this.mAttribBone!=-1){gl.enableVertexAttribArray(this.mAttribBone)}if(this.mAttribBoneWeight!=-1){gl.enableVertexAttribArray(this.mAttribBoneWeight)}};GLBaseShader.prototype.Disable=function(){if(this.mAttribVertex!=-1){gl.disableVertexAttribArray(this.mAttribVertex)}if(this.mAttribUv!=-1){gl.disableVertexAttribArray(this.mAttribUv)}if(this.mAttribNormal!=-1){gl.disableVertexAttribArray(this.mAttribNormal)}if(this.mAttribColour!=-1){gl.disableVertexAttribArray(this.mAttribColour)}if(this.mAttribBone!=-1){gl.disableVertexAttribArray(this.mAttribBone)}if(this.mAttribBoneWeight!=-1){gl.disableVertexAttribArray(this.mAttribBoneWeight)}};GLBaseShader.prototype.Draw=function(b,a,c){if(this.mAttribVertex!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.VertexBuffer);gl.vertexAttribPointer(this.mAttribVertex,3,gl.FLOAT,false,0,0)}if(this.mAttribUv!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.UvBuffer);gl.vertexAttribPointer(this.mAttribUv,2,gl.FLOAT,false,0,0)}if(this.mAttribNormal!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.NormalBuffer);gl.vertexAttribPointer(this.mAttribNormal,3,gl.FLOAT,false,0,0)}if(this.mAttribColour!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.ColourBuffer);gl.vertexAttribPointer(this.mAttribColour,4,gl.FLOAT,false,0,0)}if(this.mAttribBone!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.BoneBuffer);gl.vertexAttribPointer(this.mAttribBone,b.Mesh.GetNumBonePerVertex(),gl.UNSIGNED_SHORT,false,0,0)}if(this.mAttribBoneWeight!=-1){gl.bindBuffer(gl.ARRAY_BUFFER,b.BoneWeightBuffer);gl.vertexAttribPointer(this.mAttribBoneWeight,b.Mesh.GetNumBonePerVertex(),gl.FLOAT,false,0,0)}if(b.IndexBuffer!=null){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,b.IndexBuffer);gl.drawElements(gl.TRIANGLES,(c!=null)?c:b.Mesh.GetNumIndices(),gl.UNSIGNED_SHORT,0)}else{gl.drawArrays(gl.TRIANGLES,0,(a!=null)?a:b.Mesh.GetNumPoints())}};function Input(){}Input.OnKeyboardInput=new Event();Input.OnMouseInput=new Event();function InputMap(){this.Value=0;this.Position=null;this.State}InputMap.InputState={Up:0,Down:1,DoubleClick:2,Move:3,Wheel:4};InputMap.InputKey={MouseLeft:0,MouseRight:1,MouseMiddle:2,Zero:48,One:49,Two:50,Three:51,Four:52,Five:53,Six:54,Seven:55,Eight:56,Nine:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Backspace:8,Tab:9,Return:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Space:32,KeyLeft:37,KeyUp:38,KeyRight:39,KeyDown:40,Home:36,End:35,PageUp:33,PageDown:34,Insert:45,Delete:46,NumLock:144,ScrollLock:145};function GuiFrame(a){Frame.call(this,a);this.Sprite=(a!=null)?a.Sprite:null;this.FrameId=0}GuiFrame.prototype=new Frame();GuiFrame.prototype.constructor=GuiFrame;GuiFrame.prototype.Clone=function(){return new GuiFrame(this)};GuiFrame.prototype.Render=function(i){if(this.IsVisible&&(this.Opacity>0)){var e=this.Sprite.SpriteSheet.GetFrame(this.FrameId);var j=(this.RenderSize.x)-(e.Width*2);var b=(this.RenderSize.y)-(e.Height*2);var d=this.RenderPosition.x;var c=d+e.Width;var a=c+j;var h=this.RenderPosition.y;var g=h+e.Height;var f=g+b;this.Sprite.Colour.w=this.GetAbsoluteOpacity();this.Sprite.SetFrame(this.FrameId);this.RenderPosition.x=d;this.RenderPosition.y=h;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);this.Sprite.SetFrame(this.FrameId+1);this.RenderPosition.x=c;this.Sprite.Scale.x=j;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);this.Sprite.SetFrame(this.FrameId+2);this.RenderPosition.x=a;this.Sprite.Scale.x=1;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);if(b>0){this.Sprite.SetFrame(this.FrameId+3);this.RenderPosition.x=d;this.RenderPosition.y=g;this.Sprite.Scale.y=b;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);this.Sprite.SetFrame(this.FrameId+4);this.RenderPosition.x=a;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z)}this.Sprite.SetFrame(this.FrameId+5);this.RenderPosition.x=d;this.RenderPosition.y=f;this.Sprite.Scale.y=1;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);this.Sprite.SetFrame(this.FrameId+6);this.RenderPosition.x=c;this.Sprite.Scale.x=j;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z);this.Sprite.SetFrame(this.FrameId+7);this.RenderPosition.x=a;this.Sprite.Scale.x=1;i.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z)}};function GuiImage(a){ImageUI.call(this,a);this.Sprite=(a!=null)?new Sprite(a.Sprite):null}GuiImage.prototype=new ImageUI();GuiImage.prototype.constructor=GuiImage;GuiImage.prototype.Clone=function(){return new GuiImage(this)};GuiImage.prototype.Measure=function(a){this.DesiredSize.x=(this.Size.x>0)?this.Size.x:(this.HorizontalAlignmentType==HorizontalAlignment.Stretch)?a.x:this.Sprite.SpriteTexture.GetWidth();this.DesiredSize.y=(this.Size.y>0)?this.Size.y:(this.VerticalAlignmentType==VerticalAlignment.Stretch)?a.y:this.Sprite.SpriteTexture.GetHeight();this.DesiredSize.x+=this.Margin.x+this.Margin.z;this.DesiredSize.y+=this.Margin.y+this.Margin.w;if((this.MinSize.x>0)&&(this.DesiredSize.x<this.MinSize.x)){this.DesiredSize.x=this.MinSize.x}else{if((this.MaxSize.x>0)&&(this.DesiredSize.x>this.MaxSize.x)){this.DesiredSize.x=this.MaxSize.x}}if((this.MinSize.y>0)&&(this.DesiredSize.y<this.MinSize.y)){this.DesiredSize.y=this.MinSize.y}else{if((this.MaxSize.y>0)&&(this.DesiredSize.y>this.MaxSize.y)){this.DesiredSize.y=this.MaxSize.y}}};GuiImage.prototype.Arrange=function(a){UIElement.prototype.Arrange.call(this,a);this.Sprite.Scale.x=(this.RenderSize.x>0)?(this.RenderSize.x/this.Sprite.SpriteTexture.GetWidth()):1;this.Sprite.Scale.y=(this.RenderSize.y>0)?(this.RenderSize.y/this.Sprite.SpriteTexture.GetHeight()):1};GuiImage.prototype.Render=function(a){if(this.IsVisible&&(this.Opacity>0)){this.Sprite.Colour.w=this.GetAbsoluteOpacity();a.DrawSprite(this.Sprite,this.RenderPosition,this.Origin,this.Rotation.z)}};function GuiLabel(a){Label.call(this,a);this.Font=(a!=null)?a.Font:null;this.mFontDst=new Point()}GuiLabel.prototype=new Label();GuiLabel.prototype.constructor=GuiLabel;GuiLabel.prototype.Clone=function(){return new GuiLabel(this)};GuiLabel.prototype.Measure=function(a){if(this.Font!=null){if(this.Size.x>0){this.DesiredSize.x=this.Size.x}else{var b=this.Font.GetWidthText(this.Text,0);this.DesiredSize.x=(b<a.x)?b:a.x}this.DesiredSize.y=this.Font.GetHeightText(this.Text,a.x);this.DesiredSize.x+=this.Margin.x+this.Margin.z;this.DesiredSize.y+=this.Margin.y+this.Margin.w}else{Label.prototype.Measure.call(this,a)}};GuiLabel.prototype.Arrange=function(a){Label.prototype.Arrange.call(this,a);this.mFontDst.x=this.RenderPosition.x;this.mFontDst.y=this.RenderPosition.y;this.mFontDst.z=this.RenderSize.x;this.mFontDst.w=this.RenderSize.y};GuiLabel.prototype.Render=function(a){if(this.IsVisible&&(this.Opacity>0)&&(this.Font!=null)){this.Font.Colour.w=this.GetAbsoluteOpacity();this.Font.Draw(this.Text,this.mFontDst,a)}};function GuiProgress(a){Progress.call(this,a);this.Sprite=(a!=null)?a.Sprite:null;this.mSrcRect=new Point();this.mDstRect=new Point();this.OnValueChanged.Add(this.OnProgressValueChanged,this)}GuiProgress.prototype=new Progress();GuiProgress.prototype.constructor=GuiProgress;GuiProgress.prototype.Clone=function(){return new GuiProgress(this)};GuiProgress.prototype.Measure=function(a){Progress.prototype.Measure.call(this,a);var b=this.Sprite.GetCurrentFrame();this.mSrcRect.x=(b!=null)?b.X:0;this.mSrcRect.y=(b!=null)?b.Y:0;this.mSrcRect.z=(b!=null)?b.Width:this.Sprite.SpriteTexture.GetWidth();this.mSrcRect.w=(b!=null)?b.Height:this.Sprite.SpriteTexture.GetHeight();this.OnProgressValueChanged(this,this.Value)};GuiProgress.prototype.Arrange=function(a){Progress.prototype.Arrange.call(this,a);this.mDstRect.x=this.RenderPosition.x;this.mDstRect.y=this.RenderPosition.y};GuiProgress.prototype.Render=function(a){if(this.IsVisible&&(this.Opacity>0)&&(this.Sprite!=null)){this.Sprite.Colour.w=this.GetAbsoluteOpacity();a.DrawImage(this.Sprite.SpriteTexture,this.mSrcRect,this.mDstRect,this.Origin,this.Rotation.z,this.Sprite.Colour)}};GuiProgress.prototype.OnProgressValueChanged=function(a,b){if(this.Layout==Orientation.Horizontal){this.RenderSize.x=(b*this.DesiredSize.x)/this.mSrcRect.z;this.RenderSize.y=this.DesiredSize.y}else{this.RenderSize.x=this.DesiredSize.x;this.RenderSize.y=(b*this.DesiredSize.y)/this.mSrcRect.w}this.mDstRect.z=this.RenderSize.x;this.mDstRect.w=this.RenderSize.y};function BitmapFontLoader(){}BitmapFontLoader.Load=function(h,j,d){var s=j.GetValue(h.GetAttributeValue("sprite"));if(s!=null){var t;var f=new BitmapFont(s);if(f.SpriteSheet.Frame.length<255){var e=new Array();e.length=255;for(var l=0;l<e.length;++l){e[l]=null}for(var l=0;l<f.SpriteSheet.Frame.length;++l){var k=f.SpriteSheet.Frame[l];if((k.Name!=null)&&(k.Name.length>0)){e[k.Name.charCodeAt(0)]=k}}f.SpriteSheet.Frame=e}f.Kern=h.GetAttributeValueDouble("kern");f.Lead=h.GetAttributeValueDouble("lead");f.Passworded=h.GetAttributeValueBool("pass");t=h.GetAttribute("passChr");if((t!=null)&&(t.Value!=null)&&(t.Value.length>0)){f.PasswordChr=t.Value.charAt(0)}f.TextHorizontalAlignment=h.GetAttributeValueInt("ha");f.TextVerticalAlignment=h.GetAttributeValueInt("va");var q=h.GetAttribute("sx");if(q!=null){f.Scale.x=q.ValueDouble()}var o=h.GetAttribute("sy");if(o!=null){f.Scale.y=o.ValueDouble()}var c=h.GetAttribute("r");var m=h.GetAttribute("g");var n=h.GetAttribute("b");var p=h.GetAttribute("a");f.Colour.SetPoint(c!=null?c.ValueDouble():1,m!=null?m.ValueDouble():1,n!=null?n.ValueDouble():1,p!=null?p.ValueDouble():1);return f}return null};function MaterialLoader(){}MaterialLoader.Load=function(d,f,e){var c=d.GetNumChildren();var b=new Material(f.GetValue(d.GetAttributeValue("copy")));for(var a=0;a<c;++a){var g=d.GetChildAt(a);switch(g.Name){case"ambient":b.Ambient.x=g.GetAttributeValueDouble("r");b.Ambient.y=g.GetAttributeValueDouble("g");b.Ambient.z=g.GetAttributeValueDouble("b");break;case"diffuse":b.Diffuse.x=g.GetAttributeValueDouble("r");b.Diffuse.y=g.GetAttributeValueDouble("g");b.Diffuse.z=g.GetAttributeValueDouble("b");item=g.GetAttribute("a");if(item!=null){b.Alpha=item.ValueDouble()}break;case"specular":b.Specular.x=g.GetAttributeValueDouble("r");b.Specular.y=g.GetAttributeValueDouble("g");b.Specular.z=g.GetAttributeValueDouble("b");item=g.GetAttribute("p");if(item!=null){b.Shininess=item.ValueDouble()}break;case"emission":b.Emission.x=g.GetAttributeValueDouble("r");b.Emission.y=g.GetAttributeValueDouble("g");b.Emission.z=g.GetAttributeValueDouble("b");break;case"texture":if(b.Texture==null){b.Texture=new Array()}b.Texture.push(g.GetAttributeValue("name"));break}}e.OnResourceLoaded(d,b)};function TextureLoader(){}TextureLoader.GetSampler=function(f){var d=false;var e=f.GetAttribute("wrap");if(e!=null){d=e.ValueBool()}var c=true;var e=f.GetAttribute("linearFilter");if(e!=null){c=e.ValueBool()}var g=f.GetAttributeValueBool("mipmap");var a=true;e=f.GetAttribute("mipmapLinearFilter");if(e!=null){a=e.ValueBool()}var b=new SamplerState();b.HasMipMap=g;if(d){b.AddressU=SamplerState.TextureAddressMode.Clamp;b.AddressV=SamplerState.TextureAddressMode.Clamp;b.AddressW=SamplerState.TextureAddressMode.Clamp}if(!c){if(g&&a){b.Filter=SamplerState.TextureFilter.PointMipLinear}else{b.Filter=SamplerState.TextureFilter.Point}}else{if(c){if(g&&!a){b.Filter=SamplerState.TextureFilter.LinearMipPoint}else{b.Filter=SamplerState.TextureFilter.Linear}}}return b};TextureLoader.Load=function(p,a,d){var u=p.GetAttributeValue("file");if((u!=null)&&(u.length>0)){var m=new Image();m.onload=function(){var v=null;if(this.type=="html"){v=new ImageTexture();v.Texture=this;v.mWidth=this.width;v.mHeight=this.height}else{var i=TextureLoader.GetSampler(p);var v=new GLTexture2D();if(this.type=="Grayscale"){v.Create(this.width,this.height,Texture.Format.Alpha8,i,this)}else{if(this.type=="RGBA"){v.Create(this.width,this.height,Texture.Format.Rgba,i,this)}else{v.Create(this.width,this.height,Texture.Format.Rgb,i,this)}}}this.parent.OnResourceLoaded(p,v)};m.onerror=function(){this.parent.OnResourceLoaded(p,null)};m.parent=d;m.type=p.GetAttributeValue("type");m.src=u}else{if(p.Name=="cubemap"){var j=null;var c=p.GetAttributeValue("type");var k=TextureLoader.GetSampler(p);k.AddressU=SamplerState.TextureAddressMode.Clamp;k.AddressV=SamplerState.TextureAddressMode.Clamp;k.AddressW=SamplerState.TextureAddressMode.Clamp;var f=p.GetNumChildren();var q=0;for(var r=0;r<f;++r){var g=p.GetChildAt(r);var u=g.GetAttributeValue("file");if((u!=null)&&(u.length>0)){var m=new Image();m.onload=function(){if(j==null){j=new GLTextureCube();j.Create(this.width,this.height,(c=="RGBA")?Texture.Format.Rgba:Texture.Format.Rgb,k)}j.Copy(j.CubeFace.PositiveX+this.index,this);++q;if(q==f){this.parent.OnResourceLoaded(p,j)}};m.onerror=function(){++q;if(q==f){this.parent.OnResourceLoaded(p,null)}};m.parent=d;m.index=r;m.src=u}}}else{if(p.GetAttributeValueBool("renderTarget")){var o=p.GetAttributeValueInt("width");var l=p.GetAttributeValueInt("height");if((o>0)&&(l>0)){var s=p.GetAttributeValue("colour");var b=null;if((s!=null)&&(s.length>0)){b=new FrameBufferObject();b.TextureFormat=(s=="RGB")?j.Format.Rgb:j.Format.Rgba;var h=p.GetAttributeValueBool("isColourTexture");if(h){var e=p.GetAttributeValueBool("isColourLinearFiltered");b.Texture=new GLTexture2D(o,l,b.TextureFormat,SamplerState.LinearClamp)}}var n=p.GetAttributeValue("depth");var t=null;if((n!=null)&&(n.length>0)){t=new FrameBufferObject();t.TextureFormat=j.Format.Depth16}j=new GLFrameBufferObject();j.Create(o,l,b,t,null);d.OnResourceLoaded(p,j)}}else{d.OnResourceLoaded(p,null)}}}};function ShaderLoader(){}ShaderLoader.Load=function(b,e,d){var c=b.GetAttributeValue("source");if((c!=null)&&(c.length>0)){var a=new HttpRequest(function(g,f){if(f.ResponseText!=null){var j=b.GetAttributeValue("type");var i=new GLShader();if(!i.Create((j=="vertex")?i.ShaderType.Vertex:i.ShaderType.Fragment,f.ResponseText)){var h=i.GetLog();alert("Error compiling "+j+" shader "+b.GetAttributeValue("name")+"\n\n"+h)}d.OnResourceLoaded(b,i)}else{d.OnResourceLoaded(b,null)}});a.SendRequest(HttpRequest.Method.GET,c)}};function ShapeLoader(){}ShapeLoader.Load=function(o,c,l,h){var s=null;var a=null;var g=o.GetAttributeValue("type");switch(g){case"model":var t=o.GetAttributeValue("file");if((t!=null)&&(t.length>0)){var m=new HttpRequest(function(j,i){if(i.ResponseText!=null){a=OBJ.Load(i.ResponseText);if(a!=null){a.CreateNormals();a=i.State.Update(o,a,c)}h.OnResourceLoaded(o,a)}else{h.OnResourceLoaded(o,null)}});m.SendRequest(HttpRequest.Method.GET,t,null,this);return}break;case"circle":s=o.GetAttribute("innerRadius");if(s!=null){a=new CircleCutoff(o.GetAttributeValueInt("numPoint"),s.ValueDouble(),o.GetAttributeValueDouble("outerRadius"),o.GetAttributeValueDouble("cutoff"))}else{a=new Circle(o.GetAttributeValueInt("numPoint"),o.GetAttributeValueDouble("radius"))}break;case"cone":a=new Cone(o.GetAttributeValueInt("numPoint"),o.GetAttributeValueDouble("radius"),o.GetAttributeValueDouble("height"));break;case"cube":a=new Cube(o.GetAttributeValueDouble("extentX"),o.GetAttributeValueDouble("extentY"),o.GetAttributeValueDouble("extentZ"));break;case"cylinder":a=new Cylinder(o.GetAttributeValueInt("numPoint"),o.GetAttributeValueDouble("radius"),o.GetAttributeValueDouble("height"));break;case"rectangle":a=new Rectangle(o.GetAttributeValueDouble("extentX"),o.GetAttributeValueDouble("extentY"));break;case"sphere":a=new Sphere(o.GetAttributeValueInt("numSegments"),o.GetAttributeValueInt("numRings"),o.GetAttributeValueDouble("radius"),o.GetAttributeValueDouble("cutoff"));break;case"torus":a=new Torus(o.GetAttributeValueInt("numSegments"),o.GetAttributeValueInt("numRings"),o.GetAttributeValueDouble("radius"),o.GetAttributeValueDouble("distance"));break;case"triangle":a=new Triangle(o.GetAttributeValueDouble("extentX"),o.GetAttributeValueDouble("extentY"));break;case"billboard":a=new Rectangle(o.GetAttributeValueDouble("extentX"),o.GetAttributeValueDouble("extentY"));break;case"heightmap":var f=new Heightmap();f.StartPoint.SetPoint(o.GetAttributeValueDouble("nx"),o.GetAttributeValueDouble("ny"),o.GetAttributeValueDouble("nz"));f.NoiseSeed=o.GetAttributeValueInt("noiseSeed");f.NoiseNumIteration=o.GetAttributeValueInt("noiseNumIteration");f.NoiseScale=o.GetAttributeValueDouble("noiseScale");f.NoiseMultiplier=o.GetAttributeValueDouble("noiseMultiplier");f.NoiseWeight=o.GetAttributeValueDouble("noiseWeight");f.Create(o.GetAttributeValueInt("w"),o.GetAttributeValueInt("h"));a=f;break;case"bezier":a=new BezierPathMesh();var e=o.GetNumChildren();for(var r=0;r<e;++r){var b=o.GetChildAt(r);if(b.Name=="path"){var n=new BezierPath();var u=b.GetNumChildren();n.Loop=b.GetAttributeValueBool("loop");for(var q=0;q<u;++q){var d=b.GetChildAt(q);if(d.Name=="point"){var p=new BezierPoint();p.EndPoint.x=d.GetAttributeValueDouble("x");p.EndPoint.y=d.GetAttributeValueDouble("y");p.EndPoint.z=d.GetAttributeValueDouble("z");if(d.GetAttributeValueBool("c1")){p.C1Type=true;p.C1.x=d.GetAttributeValueDouble("c1x");p.C1.y=d.GetAttributeValueDouble("c1y");p.C1.z=d.GetAttributeValueDouble("c1z")}if(d.GetAttributeValueBool("c2")){p.C2Type=true;p.C2.x=d.GetAttributeValueDouble("c2x");p.C2.y=d.GetAttributeValueDouble("c2y");p.C2.z=d.GetAttributeValueDouble("c2z")}p.Radius.x=d.GetAttributeValueDouble("rx");p.Radius.y=d.GetAttributeValueDouble("ry");p.Radius.z=d.GetAttributeValueDouble("rz");n.AddPoint(p)}}a.Path.push(n)}}a.Create(o.GetAttributeValueInt("numSegments"),o.GetAttributeValueInt("numRings"));break;default:if(l!=null){a=l(o,null)}break}if(a!=null){var k=this.Update(o,a,c);h.OnResourceLoaded(o,k)}else{h.OnResourceLoaded(o,null)}};ShapeLoader.LoadMeshGroups=function(b,f,c){for(var e=0;e<b.GetNumChildren();++e){var k=b.GetChild(e);if(k.Name=="group"){var h=null;var m=k.GetAttribute("index");if(m!=null){var g=m.ValueInt();if(g<f.Group.length){h=f.Group[g]}}else{m=k.GetAttribute("name");if(m!=null){var a=m.Value;for(var d=0;d<f.Group.length;++d){if(a==f.Group[d].Name){h=f.Group[d];break}}}}if(h!=null){var l=k.GetAttribute("uvPlanar");if(l!=null){f.CreatePlanarUV(l.ValueInt(),h.StartIndex,h.Count)}}}}};ShapeLoader.Update=function(d,q,f){var h=new Entity();h.Name=d.GetAttributeValue("name");var k=f.GetValue(d.GetAttributeValue("material"));if(k!=null){h.ObjectMaterial=new Material(k)}var j=d.GetAttribute("ux");var i=d.GetAttribute("uy");h.ObjectMaterial.TextureOffset.SetPoint(j!=null?j.ValueDouble():0,i!=null?i.ValueDouble():0);var g=d.GetAttribute("usx");var e=d.GetAttribute("usy");h.ObjectMaterial.TextureScale.SetPoint(g!=null?g.ValueDouble():1,e!=null?e.ValueDouble():1);var p=d.GetAttribute("uvPlanar");if(p!=null){q.CreatePlanarUV(p.ValueInt())}var c=d.GetAttribute("ox");var b=d.GetAttribute("oy");var a=d.GetAttribute("oz");if((c!=null)||(b!=null)||(a!=null)){q.SetOrigin(new Point((c!=null)?c.ValueDouble():0,(b!=null)?b.ValueDouble():0,(a!=null)?a.ValueDouble():0))}q.GetBoundingBox(q.ObjectBoundingBox.Centre,q.ObjectBoundingBox.Extents);h.ObjectBoundingBox=q.ObjectBoundingBox;h.ObjectMatrix.Rotate(d.GetAttributeValueDouble("rx"),d.GetAttributeValueDouble("ry"),d.GetAttributeValueDouble("rz"));var o=d.GetAttribute("sx");var n=d.GetAttribute("sy");var l=d.GetAttribute("sz");h.ObjectMatrix.Scale(o!=null?o.ValueDouble():1,n!=null?n.ValueDouble():1,l!=null?l.ValueDouble():1);h.ObjectMatrix.Translate(d.GetAttributeValueDouble("x"),d.GetAttributeValueDouble("y"),d.GetAttributeValueDouble("z"));var m=new GLVertexBufferObject();m.Create(q,GLVertexBufferObject.BufferType.Static);h.ObjectEntity=m;return h};function SpriteLoader(){}SpriteLoader.Load=function(c,f,e){var b=c.GetAttributeValue("file");if((b!=null)&&(b.length>0)){var d=new HttpRequest(function(i,g){if(g.ResponseText!=null){var k=new Xml();var j=k.Load(g.ResponseText);if(j!=null){var h=new Sprite();h.SpriteSheet=new SpriteSheet();h.SpriteSheet.Import(j);SpriteLoader.AssignProperties(c,h);e.OnResourceLoaded(c,h)}else{e.OnResourceLoaded(c,null)}}else{e.OnResourceLoaded(c,null)}});d.SendRequest(HttpRequest.Method.GET,b)}else{var a=new Sprite();a.SpriteSheet=new SpriteSheet();SpriteLoader.AssignProperties(c,a);e.OnResourceLoaded(c,a)}};SpriteLoader.AssignProperties=function(i,e){e.SpriteTexture=i.GetAttributeValue("texture");e.SetFrame(i.GetAttributeValueInt("frame"));var h=i.GetAttribute("r");var f=i.GetAttribute("g");var c=i.GetAttribute("b");var d=i.GetAttribute("a");e.Colour.SetPoint(h!=null?h.ValueDouble():1,f!=null?f.ValueDouble():1,c!=null?c.ValueDouble():1,d!=null?d.ValueDouble():1);var j=i.GetAttribute("sx");e.Scale.x=(j!=null)?j.ValueDouble():1;j=i.GetAttribute("sy");e.Scale.y=(j!=null)?j.ValueDouble():1};function StoryboardLoader(){}StoryboardLoader.Load=function(p,a,l,h,e){var c=new EntityStoryboard();c.Name=p.GetAttributeValue("name");c.Loop=p.GetAttributeValueBool("loop");var b=p.GetNumChildren();for(var t=0;t<b;++t){var g=p.GetChildAt(t);var A=null;if(g.Name.toLowerCase()=="keyframes"){var u=new KeyframeAnimation();var m=g.GetAttributeValue("target");var B=a.GetValue(m);if((B==null)&&(l!=null)){B=l.FindChild(m)}var s=g.GetAttributeValue("property");var n=null;var o=g.GetAttributeValue("easing");if(o=="quadratic"){n=new QuadraticEase()}else{if(o=="cubic"){n=new CubicEase()}}if(n!=null){var k=g.GetAttributeValue("easingMode");if(k=="in"){n.Mode=EasingFunction.EasingMode.EaseIn}else{if(k=="out"){n.Mode=EasingFunction.EasingMode.EaseOut}else{if(k=="inout"){n.Mode=EasingFunction.EasingMode.EaseInOut}}}}u.Easing=n;var r=g.GetNumChildren();for(var q=0;q<r;++q){var v=g.GetChildAt(q);var d=v.Name.toLowerCase();if(d=="keyframedouble"){var f=new KeyframeDouble();f.Time=v.GetAttributeValueDouble("time");A=v.GetAttribute("value");if(A!=null){f.Value=A.ValueDouble()}else{f.Value=Number.NaN}u.Add(f)}else{if(d=="keyframepoint"){var f=new KeyframePoint();f.Time=v.GetAttributeValueDouble("time");A=v.GetAttribute("x");if(A!=null){f.KeyPoint.x=A.ValueDouble()}else{f.KeyPoint.x=Number.NaN}A=v.GetAttribute("y");if(A!=null){f.KeyPoint.y=A.ValueDouble()}else{f.KeyPoint.y=Number.NaN}A=v.GetAttribute("z");if(A!=null){f.KeyPoint.z=A.ValueDouble()}else{f.KeyPoint.z=Number.NaN}u.Add(f)}else{if(h!=null){var f=h(v,null);if(f!=null){u.Add(f)}}}}if(f!=null){f.Target=B;if(s=="position"){f.TargetProperty=EntityStoryboard.TargetProperty.Position}else{if(s=="rotation"){f.TargetProperty=EntityStoryboard.TargetProperty.Rotation}else{if(s=="size"){f.TargetProperty=EntityStoryboard.TargetProperty.Size}else{if(s=="alpha"){f.TargetProperty=EntityStoryboard.TargetProperty.Alpha}}}}}}c.Animation.push(u)}}if(e!=null){e.OnResourceLoaded(p,c)}else{return c}};function StoryboardGroupLoader(){}StoryboardGroupLoader.Load=function(d,f,a,c,b){var j=new StoryboardGroup();j.Name=d.GetAttributeValue("name");var h=d.GetNumChildren();for(var g=0;g<h;++g){var e=d.GetChildAt(g);if(e.Name.toLowerCase()=="storyboard"){j.AddStoryboard(StoryboardLoader.Load(e,f,a,c,null))}}if(b!=null){b.OnResourceLoaded(d,j)}else{return j}};function ResourceLoader(){this.OnItemLoading=new Event();this.OnItemLoaded=new Event();this.OnUnknown=new Event();this.OnLoadComplete=new Event();this.mResourcePath=null;this.mSceneResource=null;this.mAppResource=null;this.mResource=null;this.mLateLoad=null;this.IsRunning=false;this.mNumItem=0;this.mNumItemLoaded=0}ResourceLoader.prototype.Load=function(d,c,b){this.mResourcePath=d;this.mSceneResource=c;this.mAppResource=b;this.mResource=new DataObject();if(c!=null){this.mResource.AppendDictionary(c.Dictionary)}if(b!=null){this.mResource.AppendDictionary(b.Dictionary)}this.IsRunning=true;this.mNumItem=0;this.mNumItemLoaded=0;this.mLateLoad=new Array();var a=new HttpRequest(this.OnResourceResponse);a.SendRequest(HttpRequest.Method.GET,d,null,this)};ResourceLoader.prototype.OnResourceResponse=function(f,d){var a=d.State;if(d.ResponseText!=null){var h=new Xml();var k=h.Load(d.ResponseText);if((k!=null)&&(k.GetNumChildren()>0)){a.mNumItem=k.GetNumChildren();for(var g=0;(g<a.mNumItem)&&a.IsRunning;++g){var c=k.GetChildAt(g);var b=c.GetAttributeValue("name");if(a.OnItemLoading!=null){a.OnItemLoading.Dispatch(b,g,a.mNumItem)}var e=((b!=null)&&(b.length>0))?a.mResource.GetValue(b):null;if(e==null){switch(c.Name.toLowerCase()){case"texture":TextureLoader.Load(c,a.mResource,a);break;case"cubemap":TextureLoader.Load(c,a.mResource,a);break;case"sound":SoundLoader.Load(c,a.mResource,a);break;case"media":MediaLoader.Load(c,a.mResource,a);break;case"material":MaterialLoader.Load(c,a.mResource,a);break;case"sprite":SpriteLoader.Load(c,a.mResource,a);break;case"font":a.mLateLoad.push(c);++a.mNumItemLoaded;break;case"shader":ShaderLoader.Load(c,a.mResource,a);break;case"shape":ShapeLoader.Load(c,a.mResource,a.OnUnknown,a);break;case"skeleton":SkeletonLoader.Load(c,a.mResource,a);break;case"particle":ParticleLoader.Load(c,a.mResource,a.OnUnknown,a);break;case"storyboard":StoryboardLoader.Load(c,a.mResource,null,a.OnUnknown,a);break;case"storyboardgroup":StoryboardGroupLoader.Load(c,a.mResource,null,a.OnUnknown,a);break;case"collision":CollisionLoader.Load(c,a.mResource,a.OnUnknown,a);break;case"renderstate":RenderStateLoader.Load(c,a);break;case"extension":break;case"collada":ColladaLoader.Load(c,a.mResource,a);break;case"nut":NutLoader.Load(c,a.mResource,a);break;default:a.OnUnknown.Dispatch(c,null,a);break}}else{var j=++a.mNumItemLoaded;a.OnItemLoaded.Dispatch(b,e,j,a.mNumItem)}}}else{a.OnLoadComplete.Dispatch()}}a.IsRunning=false};ResourceLoader.prototype.OnResourceLoaded=function(c,d){var b=c.GetAttributeValue("name");if((d!=null)&&(b!=null)&&(b.length>0)){var a=c.GetAttributeValueBool("cache");if(a&&(this.mAppResource!=null)){this.mAppResource.SetValue(b,d)}else{if(this.mSceneResource!=null){this.mSceneResource.SetValue(b,d)}else{if(this.mAppResource!=null){this.mAppResource.SetValue(b,d)}}}if((d!=null)&&(d.Texture!=null)&&((d.Texture.length!=null)||(typeof(d.Texture)=="string"))){this.mLateLoad.push(d)}else{if((d!=null)&&(d.SpriteTexture!=null)&&((d.SpriteTexture.length!=null)||(typeof(d.SpriteTexture)=="string"))){this.mLateLoad.push(d)}}if((d!=null)&&(d.ObjectMesh!=null)&&(typeof(d.ObjectMesh)=="string")){this.mLateLoad.push(d)}this.mResource.SetValue(b,d)}var h=++this.mNumItemLoaded;this.OnItemLoaded.Dispatch(b,d,h,this.mNumItem);if(h==this.mNumItem){for(var g=0;g<this.mLateLoad.length;++g){if((this.mLateLoad[g].Texture!=null)&&(typeof(this.mLateLoad[g].Texture)=="string")){this.mLateLoad[g].Texture=this.mResource.GetValue(this.mLateLoad[g].Texture)}else{if((this.mLateLoad[g].SpriteTexture!=null)&&(typeof(this.mLateLoad[g].SpriteTexture)=="string")){this.mLateLoad[g].SpriteTexture=this.mResource.GetValue(this.mLateLoad[g].SpriteTexture);if((this.mLateLoad[g].SpriteTexture!=null)&&(this.mLateLoad[g].SpriteSheet!=null)&&(this.mLateLoad[g].SpriteSheet.Frame.length==0)){this.mLateLoad[g].SpriteSheet.AddFrame(new SpriteFrame(null,0,0,this.mLateLoad[g].SpriteTexture.GetWidth(),this.mLateLoad[g].SpriteTexture.GetHeight()))}}else{if((this.mLateLoad[g].Texture!=null)&&(this.mLateLoad[g].Texture.length!=null)){for(var e=0;e<this.mLateLoad[g].Texture.length;++e){if(typeof(this.mLateLoad[g].Texture[e])=="string"){this.mLateLoad[g].Texture[e]=this.mResource.GetValue(this.mLateLoad[g].Texture[e])}}}else{if((this.mLateLoad[g].ObjectMesh!=null)&&(typeof(this.mLateLoad[g].ObjectMesh)=="string")){var f=this.mResource.GetValue(this.mLateLoad[g].ObjectMesh);if(f!=null){this.mLateLoad[g].ObjectMesh=f.ObjectEntity;this.mLateLoad[g].Create(this.mLateLoad[g].ObjectSkeleton,this.mLateLoad[g].ObjectMesh)}}}}}}for(var g=0;g<this.mLateLoad.length;++g){if((this.mLateLoad[g].Name!=null)&&(this.mLateLoad[g].Name=="font")){var k=BitmapFontLoader.Load(this.mLateLoad[g],this.mResource,this);var b=this.mLateLoad[g].GetAttributeValue("name");var a=c.GetAttributeValueBool("cache");if(a&&(this.mAppResource!=null)){this.mAppResource.SetValue(b,k)}else{if(this.mSceneResource!=null){this.mSceneResource.SetValue(b,k)}else{if(this.mAppResource!=null){this.mAppResource.SetValue(b,k)}}}}}this.mLateLoad=null;this.OnLoadComplete.Dispatch()}};function UILoaderHelper(){}UILoaderHelper.ProcessSplit=function(a,d,c,e){if((d==null)||(d.length==0)){return}if(e==null){e=false}var b=d.split(",",c);if(b.length>0){a.x=parseFloat(b[0])}else{a.x=0}if(b.length>1){a.y=parseFloat(b[1])}else{if((c>1)&&e){a.y=a.x}}if(b.length>2){a.z=parseFloat(b[2])}else{if((c>2)&&e){a.z=a.x}}if(b.length>3){a.w=parseFloat(b[3])}else{if((c>3)&&e){a.w=a.x}}};UILoaderHelper.GetHorizontalAlignment=function(b){var a=b.toLowerCase();return(a=="left")?HorizontalAlignment.Left:(a=="centre")?HorizontalAlignment.Centre:(a=="right")?HorizontalAlignment.Right:HorizontalAlignment.Stretch};UILoaderHelper.GetVerticalAlignment=function(b){var a=b.toLowerCase();return(a=="top")?VerticalAlignment.Top:(a=="centre")?VerticalAlignment.Centre:(a=="bottom")?VerticalAlignment.Bottom:VerticalAlignment.Stretch};function FrameLoader(){}FrameLoader.Load=function(b,c){var a=c.GetValue(b.GetAttributeValue("Sprite"));if(a!=null){var d=new GuiFrame();d.Sprite=new Sprite(a);d.FrameId=b.GetAttributeValueInt("Frame");UILoaderHelper.ProcessSplit(d.Sprite.Colour,b.GetAttributeValue("Colour"),3);return d}return null};function ImageLoader(){}ImageLoader.Load=function(b,c){var d=new GuiImage();var a=c.GetValue(b.GetAttributeValue("Sprite"));if(a!=null){d.Sprite=new Sprite(a);var e=b.GetAttribute("Frame");if(e!=null){d.Sprite.SetFrame(e.ValueInt())}e=d.Sprite.SpriteSheet.GetFrame(d.Sprite.GetCurrentFrame());UILoaderHelper.ProcessSplit(d.Sprite.Colour,b.GetAttributeValue("Colour"),3)}return d};function LabelLoader(){}LabelLoader.Load=function(f,g){var a=g.GetValue(f.GetAttributeValue("Font"));if(a!=null){var c=new GuiLabel();c.Font=new BitmapFont(a);c.Text=f.GetAttributeValue("Text");if(c.Text!=null){c.Text=c.Text.replace(/\\n/g,"\n")}c.Limit=f.GetAttributeValueInt("Limit");c.Multiline=f.GetAttributeValueBool("Multiline");c.Editable=f.GetAttributeValueBool("Editable");var h=f.GetAttribute("Kern");if(h!=null){c.Font.Kern=h.ValueDouble()}var b=f.GetAttribute("Lead");if(b!=null){c.Font.Lead=b.ValueDouble()}var e=f.GetAttribute("Pass");if(e!=null){c.Font.Passworded=e.ValueBool()}var d=f.GetAttribute("PassChr");if((d!=null)&&(d.Value!=null)&&(d.Value.length>0)){c.Font.PasswordChr=d.Value[0]}UILoaderHelper.ProcessSplit(c.Font.Scale,f.GetAttributeValue("FontSize"),2);UILoaderHelper.ProcessSplit(c.Font.Colour,f.GetAttributeValue("Colour"),3);return c}return null};function PanelLoader(){}PanelLoader.Load=function(a,b){return new Panel()};function ProgressLoader(){}ProgressLoader.Load=function(c,d){var j=d.GetValue(c.GetAttributeValue("Sprite"));if(j!=null){var a=new GuiProgress();a.Sprite=new Sprite(j);var b=c.GetAttribute("Frame");if(b!=null){a.Sprite.SetFrame(b.ValueInt())}var h=c.GetAttribute("Minimum");if(h!=null){a.Minimum=h.ValueDouble()}var e=c.GetAttribute("Maximum");if(e!=null){a.Maximum=e.ValueDouble()}var i=c.GetAttribute("Value");if(i!=null){a.Value=i.ValueDouble()}var f=c.GetAttribute("Layout");if(f!=null){if(f.Value=="Horizontal"){a.Layout=Orientation.Horizontal}else{if(f.Value=="Vertical"){a.Layout=Orientation.Vertical}}}var g=c.GetAttribute("Reverse");if(g!=null){a.Reverse=g.ValueBool()}UILoaderHelper.ProcessSplit(a.Sprite.Colour,c.GetAttributeValue("Colour"),3);return a}return null};function StackPanelLoader(){}StackPanelLoader.Load=function(c,d){var a=new StackPanel();var b=c.GetAttributeValue("Orientation").toLowerCase();a.OrientationType=(b=="vertical")?1:0;return a};function UILoader(){this.OnUnknown=new Event();this.OnLoadComplete=new Event();this.mUIPath=null;this.mResource=null;this.mStoryboard=null;this.IsRunning=false;this.mNumItem=0;this.mNumItemLoaded=0}UILoader.prototype.Load=function(a,e,d,b){this.mUIPath=a;this.mSceneResource=e;this.mAppResource=d;this.mStoryboard=b;this.mResource=new DataObject();if(e!=null){this.mResource.AppendDictionary(e.Dictionary)}if(d!=null){this.mResource.AppendDictionary(d.Dictionary)}this.IsRunning=true;this.mNumItem=0;this.mNumItemLoaded=0;var c=new HttpRequest(this.OnUIResponse);c.SendRequest(HttpRequest.Method.GET,a,null,this)};UILoader.prototype.OnUIResponse=function(e,c){var f=c.State;if(c.ResponseText!=null){var d=new Xml();var b=d.Load(c.ResponseText);if((b!=null)&&(b.GetNumChildren()>0)){var a=new Panel();f.AssignProperties(b,a);f.LoadXml(b,a);if(f.IsRunning){f.OnLoadComplete.Dispatch(a)}}else{if(f.IsRunning){f.OnLoadComplete.Dispatch(null)}}}f.IsRunning=false};UILoader.prototype.LoadXml=function(g,e){var f=g.GetNumChildren();for(var d=0;(d<f)&&this.IsRunning;++d){var a=g.GetChildAt(d);var c=null;switch(a.Name.toLowerCase()){case"label":c=LabelLoader.Load(a,this.mResource);break;case"button":c=ButtonLoader.Load(a,this.mResource);break;case"image":c=ImageLoader.Load(a,this.mResource);break;case"frame":c=FrameLoader.Load(a,this.mResource);break;case"progress":c=ProgressLoader.Load(a,this.mResource);break;case"panel":c=PanelLoader.Load(a,this.mResource);break;case"stackpanel":c=StackPanelLoader.Load(a,this.mResource);break;case"grid":c=GridLoader.Load(a,this.mResource);break;case"list":c=ItemListLoader.Load(a);if((c!=null)&&(c.DataTemplate!=null)){this.AssignProperties(a.GetChildAt(0),c.DataTemplate.Content);this.LoadXml(a.GetChildAt(0),c.DataTemplate.Content)}break;case"storyboard":var b=StoryboardLoader.Load(a,this.mResource,e,this.OnUnknown);if((this.mStoryboard!=null)&&(b!=null)){this.mStoryboard.AddStoryboard(b)}break;case"storyboardgroup":var h=StoryboardGroupLoader.Load(a,this.mResource,e,this.OnUnknown);if((this.mStoryboard!=null)&&(h!=null)){this.mStoryboard.AddGroup(h)}break;case"extension":break;default:c=this.OnUnknown.Dispatch(a);break}if(c!=null){this.AssignProperties(a,c);e.Children.Add(c);if(c.Children!=null){this.LoadXml(a,c)}}}};UILoader.prototype.AssignProperties=function(d,b){var c=d.GetNumAttributes();for(var a=0;a<c;++a){var e=d.GetAttributeAt(a);switch(e.Name.toLowerCase()){case"name":b.Name=e.Value;break;case"position":UILoaderHelper.ProcessSplit(b.Position,e.Value,2);break;case"size":UILoaderHelper.ProcessSplit(b.Size,e.Value,2);break;case"origin":UILoaderHelper.ProcessSplit(b.Origin,e.Value,2);break;case"rotation":b.Rotation.z=e.ValueDouble();break;case"margin":UILoaderHelper.ProcessSplit(b.Margin,e.Value,4,true);break;case"horizontalalignment":b.HorizontalAlignmentType=UILoaderHelper.GetHorizontalAlignment(e.Value);break;case"verticalalignment":b.VerticalAlignmentType=UILoaderHelper.GetVerticalAlignment(e.Value);break;case"isenabled":b.IsEnabled=e.ValueBool();break;case"isvisible":b.IsVisible=e.ValueBool();break;case"opacity":b.Opacity=e.ValueDouble();break;case"gridcolumn":case"gridrow":b[e.Name]=e.ValueInt();break}}};function Scene(a){this.mSceneName=a;this.mSceneManager}Scene.prototype.Start=function(){};Scene.prototype.Update=function(){};Scene.prototype.End=function(){};Scene.prototype.SetScene=function(a){if(this.mSceneManager!=null){this.mSceneManager.SetScene(a)}};Scene.prototype.SetSceneManager=function(a){this.mSceneManager=a};Scene.prototype.GetSceneName=function(){return this.mSceneName};function SceneManager(){this.mScene=new Array();this.mCurrentScene;this.OnSceneChange=new Event()}SceneManager.prototype.Add=function(a){a.SetSceneManager(this);this.mScene.push(a)};SceneManager.prototype.Remove=function(a){for(var b=0;b<this.mScene.length;++b){if(this.mScene[b].GetSceneName()==a){this.mScene.splice(b,1);break}}};SceneManager.prototype.GetCurrentScene=function(){return this.mCurrentScene};SceneManager.prototype.FindScene=function(a){for(var b=0;b<this.mScene.length;++b){if(this.mScene[b].GetSceneName()==a){return this.mScene[b]}}return null};SceneManager.prototype.Clear=function(){if(this.mCurrentScene!=null){this.mCurrentScene.End()}this.mCurrentScene=null;this.mScene=new Array()};SceneManager.prototype.SetScene=function(a){if(this.mCurrentScene!=null){this.mCurrentScene.End()}this.mCurrentScene=this.FindScene(a);if(this.mCurrentScene!=null){this.mCurrentScene.Start()}this.OnSceneChange.Dispatch(a)};SceneManager.prototype.Update=function(){if(this.mCurrentScene!=null){this.mCurrentScene.Update()}};function AppInitCommand(){ICommand.call(this)}AppInitCommand.prototype=new ICommand();AppInitCommand.prototype.constructor=AppInitCommand;AppInitCommand.prototype.Execute=function(a){Controller.Set("AppClosingEvent",new AppClosingCommand());Controller.Set("AppUnhandledExceptionEvent",new AppUnhandledExceptionCommand());Controller.Set("LogEvent",new LogCommand());Controller.Set("ErrorEvent",new ErrorCommand());Controller.Set("SaveUserDataEvent",new SaveUserDataCommand());Controller.Set("LoadUserDataEvent",new LoadUserDataCommand());Controller.Set("SetLocaleEvent",new SetLocaleCommand());Controller.Set("LoadSceneEvent",new LoadSceneCommand());Controller.Set("NavigateBackEvent",new NavigateBackCommand());Controller.Set("NavigateToEvent",new NavigateToCommand());new LoadUserDataEvent().Dispatch();AppModel.Instance().Manager.Add(new LoadingScene());AppModel.Instance().Manager.Add(new MainScene());new LoadSceneEvent("MainScene").Dispatch()};function AppClosingCommand(){ICommand.call(this)}AppClosingCommand.prototype=new ICommand();AppClosingCommand.prototype.constructor=AppClosingCommand;AppClosingCommand.prototype.Execute=function(a){new SaveUserDataEvent().Dispatch();AppModel.Instance().Manager.Clear()};function AppUnhandledExceptionCommand(){ICommand.call(this)}AppUnhandledExceptionCommand.prototype=new ICommand();AppUnhandledExceptionCommand.prototype.constructor=AppUnhandledExceptionCommand;AppUnhandledExceptionCommand.prototype.Execute=function(c){var d=document.getElementById("LogOutput");if(d!=null){var a=new Date();var b="<p class='LblLog'>"+a.toLocaleTimeString()+" "+c.Error.toString()+"</p>";d.innerHTML+=b}console.trace()};function ErrorCommand(){ICommand.call(this)}ErrorCommand.prototype=new ICommand();ErrorCommand.prototype.constructor=ErrorCommand;ErrorCommand.prototype.Execute=function(c){var d=document.getElementById("LogOutput");if(d!=null){var a=new Date();var b="<p class='LblLog'>"+a.toLocaleTimeString()+" "+c.Error.toString()+"</p>";d.innerHTML+=b}};function LoadUserDataCommand(){ICommand.call(this)}LoadUserDataCommand.prototype=new ICommand();LoadUserDataCommand.prototype.constructor=LoadUserDataCommand;LoadUserDataCommand.prototype.Execute=function(a){};function LogCommand(){ICommand.call(this)}LogCommand.prototype=new ICommand();LogCommand.prototype.constructor=LogCommand;LogCommand.prototype.Execute=function(c){var d=document.getElementById("LogOutput");if(d!=null){var a=new Date();var b="<p class='LblLog'>"+a.toLocaleTimeString()+" "+c.Data.toString()+"</p>";d.innerHTML+=b}};function SaveUserDataCommand(){ICommand.call(this)}SaveUserDataCommand.prototype=new ICommand();SaveUserDataCommand.prototype.constructor=SaveUserDataCommand;SaveUserDataCommand.prototype.Execute=function(a){};function SetLocaleCommand(){ICommand.call(this);this.mHttpRequest}SetLocaleCommand.prototype=new ICommand();SetLocaleCommand.prototype.constructor=SetLocaleCommand;SetLocaleCommand.prototype.Execute=function(c){if(c.LocaleCode==null){c.LocaleCode="en"}var a=AppModel.Instance();var b;for(b=0;b<a.SupportedLocale.length;++b){if(a.SupportedLocale[b].LocaleCode==c.LocaleCode){this.LoadLocale(a.SupportedLocale[b]);break}}if((b==a.SupportedLocale.length)&&(a.SupportedLocale.length>0)){this.LoadLocale(a.SupportedLocale[0])}};SetLocaleCommand.prototype.LoadLocale=function(a){if(this.mHttpRequest!=null){this.mHttpRequest.Cancel()}if(this.mHttpRequest==null){this.mHttpRequest=new HttpRequest(this.OnHttpResponse)}AppModel.Instance().UserData.Locale.SetValue(a.LocaleCode);this.mHttpRequest.SendRequest(HttpRequest.Method.GET,a.Path,null,a,false)};SetLocaleCommand.prototype.OnHttpResponse=function(b,a){AppModel.Instance().CurrentLocale.Import(new MemoryStream(a.ResponseText),a.State.LocaleCode)};function LoadSceneCommand(){ICommand.call(this)}LoadSceneCommand.prototype=new ICommand();LoadSceneCommand.prototype.constructor=LoadSceneCommand;LoadSceneCommand.prototype.Execute=function(a){AppModel.Instance().LoadScene=AppModel.Instance().Manager.FindScene(a.SceneName);new NavigateToEvent("loading").Dispatch()};function NavigateBackCommand(){ICommand.call(this)}NavigateBackCommand.prototype=new ICommand();NavigateBackCommand.prototype.constructor=NavigateBackCommand;NavigateBackCommand.prototype.Execute=function(c){var b=AppModel.Instance();if(b.SceneHistory.length>0){var a=b.SceneHistory.pop();b.Manager.SetScene(a)}};function NavigateToCommand(){ICommand.call(this)}NavigateToCommand.prototype=new ICommand();NavigateToCommand.prototype.constructor=NavigateToCommand;NavigateToCommand.prototype.Execute=function(c){var a=AppModel.Instance();var b=a.Manager.GetCurrentScene();if(c.IncludeInHistory&&b&&(b.GetSceneName()!=c.SceneName)){a.SceneHistory.push(b.GetSceneName())}a.Manager.SetScene(c.SceneName)};function AppInitEvent(){EventDispatcher.call(this,"AppInitEvent")}AppInitEvent.prototype=new EventDispatcher();AppInitEvent.prototype.constructor=AppInitEvent;function AppClosingEvent(a){EventDispatcher.call(this,"AppClosingEvent")}AppClosingEvent.prototype=new EventDispatcher();AppClosingEvent.prototype.constructor=AppClosingEvent;function AppUnhandledExceptionEvent(a){EventDispatcher.call(this,"AppUnhandledExceptionEvent");this.Error=a}AppUnhandledExceptionEvent.prototype=new EventDispatcher();AppUnhandledExceptionEvent.prototype.constructor=AppUnhandledExceptionEvent;function ErrorEvent(b,a){EventDispatcher.call(this,"ErrorEvent");this.Message=b;this.Error=a}ErrorEvent.prototype=new EventDispatcher();ErrorEvent.prototype.constructor=ErrorEvent;function LoadUserDataEvent(){EventDispatcher.call(this,"LoadUserDataEvent")}LoadUserDataEvent.prototype=new EventDispatcher();LoadUserDataEvent.prototype.constructor=LoadUserDataEvent;function LogEvent(b,a){EventDispatcher.call(this,"LogEvent");this.Data=b;this.Severity=a}LogEvent.prototype=new EventDispatcher();LogEvent.prototype.constructor=LogEvent;function SaveUserDataEvent(){EventDispatcher.call(this,"SaveUserDataEvent")}SaveUserDataEvent.prototype=new EventDispatcher();SaveUserDataEvent.prototype.constructor=SaveUserDataEvent;function SetLocaleEvent(a){EventDispatcher.call(this,"SetLocaleEvent");this.LocaleCode=a}SetLocaleEvent.prototype=new EventDispatcher();SetLocaleEvent.prototype.constructor=SetLocaleEvent;function LoadSceneEvent(a){EventDispatcher.call(this,"LoadSceneEvent");this.SceneName=a}LoadSceneEvent.prototype=new EventDispatcher();LoadSceneEvent.prototype.constructor=LoadSceneEvent;function NavigateBackEvent(){EventDispatcher.call(this,"NavigateBackEvent")}NavigateBackEvent.prototype=new EventDispatcher();NavigateBackEvent.prototype.constructor=NavigateBackEvent;function NavigateToEvent(b,a){EventDispatcher.call(this,"NavigateToEvent");this.SceneName=b;this.IncludeInHistory=a?a:false}NavigateToEvent.prototype=new EventDispatcher();NavigateToEvent.prototype.constructor=NavigateToEvent;function AppModel(){DataObject.call(this);this.Config=new DataObject();this.CurrentLocale=new Locale();this.SupportedLocale=new Array();this.Manager=new SceneManager();this.SceneHistory=new Array();this.LoadScene=null;this.Graphics=null}AppModel.prototype=new DataObject();AppModel.prototype.constructor=AppModel;AppModel.mInstance=null;AppModel.Instance=function(){if(AppModel.mInstance==null){AppModel.mInstance=new AppModel()}return AppModel.mInstance};AppModel.prototype.SampleProperty=function(a){if(a==null){return this.GetValue("SampleProperty")}else{this.SetValue("SampleProperty",a)}};function SupportedLocaleModel(b,a){this.Path=b;this.LocaleCode=a}UserDataModel=function(){this.Locale=new Property("Locale",null)};function BasicShader(){GLBaseShader.call(this);this.mProjectionId;this.mViewId;this.mModelId;this.mModelScaleId;this.mNumLightId;this.mLightId;this.mMaterialId;this.mSampleId;this.Projection;this.View;this.LightObject=new Array()}BasicShader.prototype=new GLBaseShader();BasicShader.prototype.constructor=BasicShader;BasicShader.LightSource=function(){this.TypeId;this.PositionId;this.AttenuationId;this.DirectionId;this.ColourId;this.OuterCutoffId;this.InnerCutoffId;this.ExponentId};BasicShader.MaterialSource=function(){this.AmbientId;this.DiffuseId;this.SpecularId;this.ShininessId;this.TextureOffsetId;this.TextureScaleId};BasicShader.prototype.Init=function(){GLBaseShader.prototype.Init.call(this);this.mProjectionId=this.GetVariable("ProjectionMatrix");this.mViewId=this.GetVariable("ViewMatrix");this.mModelId=this.GetVariable("ModelMatrix");this.mModelScaleId=this.GetVariable("ModelScale");this.mNumLightId=this.GetVariable("NumLight");this.mLightId=new Array();var d;var c=0;do{d=this.GetVariable("Light["+c+"].Position");if(d!=null){var a=new BasicShader.LightSource();a.PositionId=d;a.TypeId=this.GetVariable("Light["+c+"].Type");a.AttenuationId=this.GetVariable("Light["+c+"].Attenuation");a.DirectionId=this.GetVariable("Light["+c+"].Direction");a.ColourId=this.GetVariable("Light["+c+"].Colour");a.OuterCutoffId=this.GetVariable("Light["+c+"].OuterCutoff");a.InnerCutoffId=this.GetVariable("Light["+c+"].InnerCutoff");a.ExponentId=this.GetVariable("Light["+c+"].Exponent");this.mLightId.push(a);++c}}while(d!=null);this.mMaterialId=new BasicShader.MaterialSource();this.mMaterialId.AmbientId=this.GetVariable("Material.Ambient");this.mMaterialId.DiffuseId=this.GetVariable("Material.Diffuse");this.mMaterialId.SpecularId=this.GetVariable("Material.Specular");this.mMaterialId.ShininessId=this.GetVariable("Material.Shininess");this.mMaterialId.TextureOffsetId=this.GetVariable("Material.TextureOffset");this.mMaterialId.TextureScaleId=this.GetVariable("Material.TextureScale");this.mSampleId=new Array();var b;c=0;do{b=this.GetVariable("Sample"+c);if(b!=null){this.mSampleId.push(b);++c}}while(b!=null)};BasicShader.prototype.Enable=function(){GLBaseShader.prototype.Enable.call(this);for(var a=0;a<this.mSampleId.length;++a){if(a<this.mSampleId.length){this.SetVariableInt(this.mSampleId[a],a)}}this.SetVariableInt(this.mNumLightId,this.LightObject.length);for(var a=0;(a<this.mLightId.length)&&(a<this.LightObject.length);++a){this.SetVariableInt(this.mLightId[a].TypeId,this.LightObject[a].LightType);this.SetVariable(this.mLightId[a].PositionId,this.LightObject[a].Position.x,this.LightObject[a].Position.y,this.LightObject[a].Position.z);this.SetVariable(this.mLightId[a].AttenuationId,this.LightObject[a].Attenuation.x,this.LightObject[a].Attenuation.y,this.LightObject[a].Attenuation.z);this.SetVariable(this.mLightId[a].DirectionId,this.LightObject[a].Direction.x,this.LightObject[a].Direction.y,this.LightObject[a].Direction.z);this.SetVariable(this.mLightId[a].ColourId,this.LightObject[a].Colour.x,this.LightObject[a].Colour.y,this.LightObject[a].Colour.z);this.SetVariable(this.mLightId[a].OuterCutoffId,this.LightObject[a].OuterCutoff);this.SetVariable(this.mLightId[a].InnerCutoffId,this.LightObject[a].InnerCutoff);this.SetVariable(this.mLightId[a].ExponentId,this.LightObject[a].Exponent)}};BasicShader.prototype.Draw=function(a,e,d,g){this.SetMatrix(this.mProjectionId,this.Projection.MMatrix,4);this.SetMatrix(this.mViewId,this.View.MMatrix,4);this.SetMatrix(this.mModelId,a.ObjectMatrix.MMatrix,4);var f=a.ObjectMatrix.GetScale();this.SetVariable(this.mModelScaleId,f.x,f.y,f.z);var c=a.ObjectMaterial;this.SetVariable(this.mMaterialId.AmbientId,c.Ambient.x,c.Ambient.y,c.Ambient.z);this.SetVariable(this.mMaterialId.DiffuseId,c.Diffuse.x,c.Diffuse.y,c.Diffuse.z,c.Alpha);this.SetVariable(this.mMaterialId.SpecularId,c.Specular.x,c.Specular.y,c.Specular.z);this.SetVariable(this.mMaterialId.ShininessId,c.Shininess);this.SetVariable(this.mMaterialId.TextureOffsetId,c.TextureOffset.x,c.TextureOffset.y);this.SetVariable(this.mMaterialId.TextureScaleId,c.TextureScale.x,c.TextureScale.y);if((c.Texture!=null)&&(c.Texture.length!=null)){for(var b=0;b<c.Texture.length;++b){gl.activeTexture(gl.TEXTURE0+b);c.Texture[b].Bind()}}GLBaseShader.prototype.Draw.call(this,e,d,g)};function ImageShader(){GLBaseShader.call(this);this.mImageSizeId;this.mTexelSizeId;this.mColourId;this.mSampleId;this.mImageSize=new Point();this.mTexelSize=new Point()}ImageShader.prototype=new GLBaseShader();ImageShader.prototype.constructor=ImageShader;ImageShader.prototype.Init=function(){GLBaseShader.prototype.Init.call(this);this.mImageSizeId=this.GetVariable("ImageSize");this.mTexelSizeId=this.GetVariable("TexelSize");this.mColourId=this.GetVariable("Colour");this.mSampleId=new Array();var a;index=0;do{a=this.GetVariable("Sample"+index);if(a!=null){this.mSampleId.push(a);++index}}while(a!=null)};ImageShader.prototype.Enable=function(){GLBaseShader.prototype.Enable.call(this);for(var a=0;a<this.mSampleId.length;++a){if(a<this.mSampleId.length){this.SetVariableInt(this.mSampleId[a],a)}}};ImageShader.prototype.SetSize=function(b,a){this.mImageSize.x=b;this.mImageSize.y=a;this.mTexelSize.x=(b!=0)?1/b:0;this.mTexelSize.y=(a!=0)?1/a:0};ImageShader.prototype.Draw=function(a,e,d,f){var c=a.ObjectMaterial;this.SetVariable(this.mImageSizeId,this.mImageSize.x,this.mImageSize.y);this.SetVariable(this.mTexelSizeId,this.mTexelSize.x,this.mTexelSize.y);this.SetVariable(this.mColourId,c.Diffuse.x,c.Diffuse.y,c.Diffuse.z,c.Alpha);if((c.Texture!=null)&&(c.Texture.length!=null)&&(c.Texture.length>0)){for(var b=0;(b<c.Texture.length)&&(b<this.mSampleId.length);++b){gl.activeTexture(gl.TEXTURE0+b);c.Texture[b].Bind()}}GLBaseShader.prototype.Draw.call(this,e,d,f)};function NoiseShader(){ImageShader.call(this);this.mNoiseOffsetId;this.mNoiseNumIterationId;this.mNoiseScaleId;this.mNoiseScaleMultiplierId;this.mNoiseWeightId;this.mNoiseTurbulenceId;this.NoiseOffset=new Point();this.NoiseNumIteration=1;this.NoiseScale=2;this.NoiseScaleMultiplier=2;this.NoiseWeight=0.5;this.NoiseTurbulence=false}NoiseShader.prototype=new ImageShader();NoiseShader.prototype.constructor=NoiseShader;NoiseShader.prototype.Init=function(){ImageShader.prototype.Init.call(this);this.mNoiseOffsetId=this.GetVariable("NoiseOffset");this.mNoiseNumIterationId=this.GetVariable("NoiseNumIteration");this.mNoiseScaleId=this.GetVariable("NoiseScale");this.mNoiseScaleMultiplierId=this.GetVariable("NoiseScaleMultiplier");this.mNoiseWeightId=this.GetVariable("NoiseWeight");this.mNoiseTurbulenceId=this.GetVariable("NoiseTurbulence")};NoiseShader.prototype.Enable=function(){ImageShader.prototype.Enable.call(this);this.SetVariable(this.mNoiseOffsetId,this.NoiseOffset.x,this.NoiseOffset.y);this.SetVariableInt(this.mNoiseNumIterationId,this.NoiseNumIteration);this.SetVariable(this.mNoiseScaleId,this.NoiseScale);this.SetVariable(this.mNoiseScaleMultiplierId,this.NoiseScaleMultiplier);this.SetVariable(this.mNoiseWeightId,this.NoiseWeight);this.SetVariableInt(this.mNoiseTurbulenceId,this.NoiseTurbulence?1:0)};function CloudShader(){NoiseShader.call(this);this.mCloudColourId;this.mCloudCoverId;this.mCloudSharpnessId;this.CloudColour=new Point(1,1,1);this.CloudCover=0.5;this.CloudSharpness=0.1}CloudShader.prototype=new NoiseShader();CloudShader.prototype.constructor=CloudShader;CloudShader.prototype.Init=function(){NoiseShader.prototype.Init.call(this);this.mCloudColourId=this.GetVariable("CloudColour");this.mCloudCoverId=this.GetVariable("CloudCover");this.mCloudSharpnessId=this.GetVariable("CloudSharpness")};CloudShader.prototype.Enable=function(){NoiseShader.prototype.Enable.call(this);this.SetVariable(this.mCloudColourId,this.CloudColour.x,this.CloudColour.y,this.CloudColour.z);this.SetVariable(this.mCloudCoverId,this.CloudCover);this.SetVariable(this.mCloudSharpnessId,this.CloudSharpness)};function AtmosphereShader(){CloudShader.call(this);this.mProjectionMatrixId;this.mViewMatrixId;this.mFOVId;this.mPositionId;this.mCentreId;this.mRadiusId;this.mNumSamplesId;this.mLightVectorId;this.mInvWavelengthId;this.mKr4PIId;this.mKm4PIId;this.mKmESunId;this.mKrESunId;this.mMieEccentricityId;this.mInvGammaId;this.mCentre=new Point();this.mInnerRadius=0;this.mOuterRadius=0;this.mLightColour=new Point();this.mLightIntensity=0;this.mRayleighScatter=0;this.mMieScatter=0;this.mMiePhase=0;this.mInvWavelength=new Point();this.mKrESun=0;this.mKr4PI=0;this.mKmESun=0;this.mKm4PI=0;this.ProjectionMatrix=ViewMatrix.Perspective(90,1,0.1,1024);this.ViewMatrix=new Matrix(4,4);this.FOV=0.5;this.Position=new Point(0,1,0);this.NumSamples=5;this.LightVector=new Point(0,-1,0);this.InvGamma=1/2.2;this.SetRadius(1);this.SetLightColour(new Point(0.65,0.57,0.475));this.SetLightIntensity(15);this.SetRayleigh(0.0025);this.SetMie(0.0015,-0.95)}AtmosphereShader.prototype=new CloudShader();AtmosphereShader.prototype.constructor=AtmosphereShader;AtmosphereShader.prototype.Init=function(){CloudShader.prototype.Init.call(this);this.mProjectionMatrixId=this.GetVariable("ProjectionMatrix");this.mViewMatrixId=this.GetVariable("ViewMatrix");this.mFOVId=this.GetVariable("FOV");this.mPositionId=this.GetVariable("Position");this.mCentreId=this.GetVariable("Centre");this.mInnerRadiusId=this.GetVariable("InnerRadius");this.mOuterRadiusId=this.GetVariable("OuterRadius");this.mNumSamplesId=this.GetVariable("NumSamples");this.mLightVectorId=this.GetVariable("LightVector");this.mInvWavelengthId=this.GetVariable("InvWavelength");this.mKr4PIId=this.GetVariable("Kr4PI");this.mKm4PIId=this.GetVariable("Km4PI");this.mKmESunId=this.GetVariable("KmESun");this.mKrESunId=this.GetVariable("KrESun");this.mMiePhaseId=this.GetVariable("MiePhase");this.mInvGammaId=this.GetVariable("InvGamma")};AtmosphereShader.prototype.Enable=function(){CloudShader.prototype.Enable.call(this);this.SetMatrix(this.mProjectionMatrixId,this.ProjectionMatrix.MMatrix,4);this.SetVariable(this.mFOVId,this.FOV);this.SetVariable(this.mPositionId,this.Position.x,this.Position.y,this.Position.z);this.SetVariable(this.mCentreId,this.mCentre.x,this.mCentre.y,this.mCentre.z);this.SetVariable(this.mInnerRadiusId,this.mInnerRadius);this.SetVariable(this.mOuterRadiusId,this.mOuterRadius);this.SetVariable(this.mNumSamplesId,this.NumSamples);this.SetVariable(this.mLightVectorId,this.LightVector.x,this.LightVector.y,this.LightVector.z);this.SetVariable(this.mInvWavelengthId,this.mInvWavelength.x,this.mInvWavelength.y,this.mInvWavelength.z);this.SetVariable(this.mKr4PIId,this.mKr4PI);this.SetVariable(this.mKm4PIId,this.mKm4PI);this.SetVariable(this.mKmESunId,this.mKmESun);this.SetVariable(this.mKrESunId,this.mKrESun);this.SetVariable(this.mMiePhaseId,this.mMiePhase);this.SetVariable(this.mInvGammaId,this.InvGamma)};AtmosphereShader.prototype.Draw=function(a,c,b,d){this.SetMatrix(this.mViewMatrixId,this.ViewMatrix.MMatrix,4);CloudShader.prototype.Draw.call(this,a,c,b,d)};AtmosphereShader.prototype.SetRadius=function(a){this.mInnerRadius=a;this.mOuterRadius=this.mInnerRadius*1.025};AtmosphereShader.prototype.SetLightColour=function(a){this.mLightColour=a;this.mInvWavelength.SetPoint(1/Math.pow(this.mLightColour.x,4),1/Math.pow(this.mLightColour.y,4),1/Math.pow(this.mLightColour.z,4))};AtmosphereShader.prototype.SetLightIntensity=function(a){this.mLightIntensity=a;this.mKrESun=this.mRayleighScatter*this.mLightIntensity;this.mKmESun=this.mMieScatter*this.mLightIntensity};AtmosphereShader.prototype.SetRayleigh=function(a){this.mRayleighScatter=a;this.mKrESun=this.mRayleighScatter*this.mLightIntensity;this.mKr4PI=this.mRayleighScatter*4*Math.PI};AtmosphereShader.prototype.SetMie=function(a,b){this.mMieScatter=a;this.mMiePhase=b;this.mKmESun=this.mMieScatter*this.mLightIntensity;this.mKm4PI=this.mMieScatter*4*Math.PI};function SkyboxShader(){GLBaseShader.call(this);this.mProjectionId;this.mViewId;this.mModelId;this.mModelScaleId;this.mSampleId;this.Projection;this.View}SkyboxShader.prototype=new GLBaseShader();SkyboxShader.prototype.constructor=SkyboxShader;SkyboxShader.prototype.Init=function(){GLBaseShader.prototype.Init.call(this);this.mProjectionId=this.GetVariable("ProjectionMatrix");this.mViewId=this.GetVariable("ViewMatrix");this.mModelId=this.GetVariable("ModelMatrix");this.mModelScaleId=this.GetVariable("ModelScale");this.mSampleId=new Array();var a;index=0;do{a=this.GetVariable("Sample"+index);if(a!=null){this.mSampleId.push(a);++index}}while(a!=null)};SkyboxShader.prototype.Enable=function(){GLBaseShader.prototype.Enable.call(this);for(var a=0;a<this.mSampleId.length;++a){if(a<this.mSampleId.length){this.SetVariableInt(this.mSampleId[a],a)}}};SkyboxShader.prototype.Draw=function(a,e,d,g){this.SetMatrix(this.mProjectionId,this.Projection.MMatrix,4);this.SetMatrix(this.mViewId,this.View.MMatrix,4);this.SetMatrix(this.mModelId,a.ObjectMatrix.MMatrix,4);var f=a.ObjectMatrix.GetScale();this.SetVariable(this.mModelScaleId,f.x,f.y,f.z);var c=a.ObjectMaterial;if((c.Texture!=null)&&(c.Texture.length!=null)){for(var b=0;(b<c.Texture.length)&&(b<this.mSampleId.length);++b){gl.activeTexture(gl.TEXTURE0+b);c.Texture[b].Bind()}}GLBaseShader.prototype.Draw.call(this,e,d,g)};function BaseScene(a){Scene.call(this,a);this.mGraphicsContext=null;this.mPanel=null;this.mStoryboard=null;this.mRenderStateUI=null}BaseScene.prototype=new Scene();BaseScene.prototype.constructor=BaseScene;BaseScene.prototype.OnKeyboard=function(a){if(this.mPanel!=null){if(a.State==InputMap.InputState.Down){this.mPanel.KeyDown(a.Value)}else{this.mPanel.KeyUp(a.Value)}}};BaseScene.prototype.OnMouse=function(a){if(this.mPanel!=null){var b=this.mGraphicsContext.GetViewportScale();a.Position.x/=b.x;a.Position.y/=b.y;if(a.State==InputMap.InputState.Move){this.mPanel.MouseMove(a.Position)}else{if(a.State==InputMap.InputState.Down){this.mPanel.MouseLeftButtonDown(a.Position)}else{if(a.State==InputMap.InputState.Up){this.mPanel.MouseLeftButtonUp(a.Position)}}}}};BaseScene.prototype.Start=function(){Scene.prototype.Start.call(this);this.mGraphicsContext=AppModel.Instance().Graphics;this.OnAppSizeChanged(App.CurrentApp.GetWidth(),App.CurrentApp.GetHeight());this.mRenderStateUI=new GLRenderState();this.mRenderStateUI.Blend.ColorSourceBlend=BlendState.Blend.SourceAlpha;this.mRenderStateUI.Blend.ColorDestinationBlend=BlendState.Blend.InverseSourceAlpha;this.mRenderStateUI.DepthStencil.DepthBufferEnable=false;this.mRenderStateUI.DepthStencil.DepthBufferWriteEnable=false;this.mRenderStateUI.Rasterizer.Cull=RasterizerState.CullMode.CullNone;App.CurrentApp.OnSize.Add(this.OnAppSizeChanged,this);Input.OnKeyboardInput.Add(this.OnKeyboard,this);Input.OnMouseInput.Add(this.OnMouse,this)};BaseScene.prototype.Update=function(){Scene.prototype.Update.call(this);if(this.mPanel!=null){this.mPanel.UpdateLayout();this.mRenderStateUI.Set();this.mGraphicsContext.Begin();this.mPanel.Render(this.mGraphicsContext);this.mGraphicsContext.End()}};BaseScene.prototype.End=function(){Scene.prototype.End.call(this);this.mGraphicsContext=null;this.mPanel=null;this.mStoryboard=null;this.mRenderStateUI=null;App.CurrentApp.OnSize.Remove(this.OnAppSizeChanged,this);Input.OnKeyboardInput.Remove(this.OnKeyboard,this);Input.OnMouseInput.Remove(this.OnMouse,this)};BaseScene.prototype.OnAppSizeChanged=function(b,a,c){if(this.mPanel!=null){this.mPanel.Size.x=b;this.mPanel.Size.y=a}};function LoadingScene(){BaseScene.call(this,"loading");this.mResourcePath="resource/scene/loading_resources.xml";this.mUIPath="resource/scene/loading.xml";this.mResourceLoader=null;this.mUILoader=null;this.mResource=null;this.mRenderStateUI;this.mProgress=null}LoadingScene.prototype=new BaseScene();LoadingScene.prototype.constructor=LoadingScene;LoadingScene.prototype.OnLoadResourceComplete=function(){this.mResourceLoader=null;this.mStoryboard=new StoryboardManager();this.mUILoader=new UILoader();this.mUILoader.OnLoadComplete.Add(this.OnLoadUIComplete,this);this.mUILoader.Load(this.mUIPath,this.mResource,null,this.mStoryboard)};LoadingScene.prototype.OnLoadUIComplete=function(a){this.mUILoader=null;this.mPanel=a;this.mProgress=a.FindChild("Progress");this.OnAppSizeChanged(App.CurrentApp.GetWidth(),App.CurrentApp.GetHeight(),null);var b=this.mStoryboard.GetStoryboard("StoryExit");if(b!=null){b.OnEnd.Add(this.OnStoryExitEnd,this)}this.mResourceLoader=new ResourceLoader();this.mResourceLoader.OnItemLoaded.Add(this.OnItemLoaded,this);this.mResourceLoader.OnLoadComplete.Add(this.OnLoadMainResourceComplete,this);this.mResourceLoader.Load(AppModel.Instance().LoadScene.mResourcePath,this.mResource,null);this.mStoryboard.Play("StoryEnter")};LoadingScene.prototype.OnItemLoaded=function(c,e,b,d){var a=b/d;if((this.mProgress!=null)&&(a>this.mProgress.Value)){this.mProgress.SetValue(a)}};LoadingScene.prototype.OnLoadMainResourceComplete=function(){AppModel.Instance().LoadScene.mResource=this.mResource;AppModel.Instance().LoadScene.mStoryboard=new StoryboardManager();this.mUILoader=new UILoader();this.mUILoader.OnLoadComplete.Add(this.OnLoadMainUIComplete,this);this.mUILoader.Load(AppModel.Instance().LoadScene.mUIPath,this.mResource,null,AppModel.Instance().LoadScene.mStoryboard)};LoadingScene.prototype.OnLoadMainUIComplete=function(a){this.mUILoader=null;AppModel.Instance().LoadScene.mPanel=a;if(this.mProgress!=null){this.mProgress.SetValue(1)}this.mStoryboard.Play("StoryExit")};LoadingScene.prototype.OnStoryExitEnd=function(){new NavigateToEvent(AppModel.Instance().LoadScene.mSceneName,false).Dispatch()};LoadingScene.prototype.Start=function(){BaseScene.prototype.Start.call(this);if(AppModel.Instance().LoadScene!=null){this.mRenderStateUI=new GLRenderState();this.mRenderStateUI.Blend.ColorSourceBlend=BlendState.Blend.SourceAlpha;this.mRenderStateUI.Blend.ColorDestinationBlend=BlendState.Blend.InverseSourceAlpha;this.mRenderStateUI.DepthStencil.DepthBufferEnable=false;this.mRenderStateUI.DepthStencil.DepthBufferWriteEnable=false;this.mRenderStateUI.Rasterizer.Cull=RasterizerState.CullMode.CullNone;this.mRenderStateUI.Set();this.mResource=new DataObject();this.mResourceLoader=new ResourceLoader();this.mResourceLoader.OnLoadComplete.Add(this.OnLoadResourceComplete,this);this.mResourceLoader.Load(this.mResourcePath,this.mResource,null)}else{new ErrorEvent("LoadScene = null",null).Dispatch()}};LoadingScene.prototype.Update=function(){this.mGraphicsContext.Clear();BaseScene.prototype.Update.call(this)};LoadingScene.prototype.End=function(){BaseScene.prototype.End.call(this);this.mResourceLoader=null;this.mUILoader=null;this.mResource=null;this.mProgress=null};function MainScene(){BaseScene.call(this,"MainScene");this.mResourcePath="resource/scene/main_resources.xml";this.mUIPath="resource/scene/main.xml";this.mCanvas=null;this.mResource=null;this.mCamera=null;this.mCameraViews=null;this.mRenderState=null;this.mGround=null;this.mSky=null;this.mSkybox=null;this.mSurface=null;this.mLight=null;this.mShader=null;this.mBasicShader=null;this.mAtmosphereShader=null;this.mImageShader=null;this.mSkyboxShader=null;this.mFboAtmosphereResolution=new Point();this.mFboAtmosphere=null;this.mFboAtmosphereColour=null;this.mUpdateAtmosphere=false;this.mMouseDown=false;this.mMouseStartPosition=new Point();this.mMouseStartRotation=new Point();this.mCloudVelocity=new Point();this.mIsSliderUpdating=false}MainScene.prototype=new BaseScene();MainScene.prototype.constructor=MainScene;MainScene.prototype.OnMouse=function(b){BaseScene.prototype.OnMouse.call(this,b);if(this.mMouseDown&&(b.State==InputMap.InputState.Move)){var d=this.mMouseStartRotation.x+(b.Position.y-this.mMouseStartPosition.y)*0.1;var c=this.mMouseStartRotation.y+(b.Position.x-this.mMouseStartPosition.x)*0.1;if(d>90){d=90}else{if(d<-10){d=-10}}this.mCamera.Rotate(d,c,this.mMouseStartRotation.z);this.mBasicShader.View=this.mCamera.GetInverseView();this.mSkyboxShader.View=this.mBasicShader.View}if(b.State==InputMap.InputState.Down){this.mMouseDown=true;this.mMouseStartPosition.x=b.Position.x;this.mMouseStartPosition.y=b.Position.y;var a=this.mCamera.GetRotation();this.mMouseStartRotation.x=a.x;this.mMouseStartRotation.y=a.y;this.mMouseStartRotation.z=a.z}else{if(b.State==InputMap.InputState.Up){this.mMouseDown=false}}};MainScene.prototype.Start=function(){BaseScene.prototype.Start.call(this);gl.clearColor(0,0,0,0);gl.clearDepth(1);this.mCanvas=App.CurrentApp.GetWindow();this.mRenderState=new GLRenderState();this.mRenderState.Blend.BlendEnable=false;this.mRenderState.Rasterizer.Cull=RasterizerState.CullMode.CullNone;this.mRenderState.Set();this.mCamera=new Camera();this.mCamera.CreatePerspective(45,this.mCanvas.width,this.mCanvas.height,1,1024);this.mCameraViews=new Array();var c=new Matrix(4,4);c.Rotate(0,90,0);this.mCameraViews.push(c);var b=new Matrix(4,4);b.Rotate(0,-90,0);this.mCameraViews.push(b);var a=new Matrix(4,4);a.Rotate(90,0,0);this.mCameraViews.push(a);var C=new Matrix(4,4);C.Rotate(-90,0,0);this.mCameraViews.push(C);var B=new Matrix(4,4);this.mCameraViews.push(B);var v=new Matrix(4,4);v.Rotate(0,180,0);this.mCameraViews.push(v);this.mFboAtmosphereResolution.x=1024;this.mFboAtmosphereResolution.y=1024;this.mFboAtmosphereColour=new FrameBufferObject(FrameBufferObject.BufferType.Colour);this.mFboAtmosphereColour.TextureObject=new GLTextureCube();this.mFboAtmosphereColour.TextureObject.Create(this.mFboAtmosphereResolution.x,this.mFboAtmosphereResolution.y,Texture.Format.Rgb,SamplerState.LinearClamp);this.mFboAtmosphere=new GLFrameBufferObject();this.mFboAtmosphere.Create(this.mFboAtmosphereResolution.x,this.mFboAtmosphereResolution.y);this.mFboAtmosphere.AttachBuffer(this.mFboAtmosphereColour);this.mGround=this.mResource.GetValue("Ground");this.mSkybox=this.mResource.GetValue("Skybox");this.mSkybox.ObjectMaterial.Texture=new Array();this.mSkybox.ObjectMaterial.Texture.push(this.mFboAtmosphereColour.TextureObject);this.mSurface=this.mResource.GetValue("Surface");this.mSurface.ObjectMaterial.Texture=new Array();this.mSurface.ObjectMaterial.Texture.push(this.mFboAtmosphereColour.TextureObject);this.mLight=new Light();this.mLight.Position.SetPoint(0,1000,0);this.mLight.Attenuation.SetPoint(1,0,0);this.mLight.Exponent=1;var s=this.mResource.GetValue("basic.vs");var g=this.mResource.GetValue("basic.fs");var A=this.mResource.GetValue("atmosphere.vs");var j=this.mResource.GetValue("atmosphere.fs");var f=this.mResource.GetValue("image.vs");var p=this.mResource.GetValue("image.fs");var t=this.mResource.GetValue("clouds.fs");var o=this.mResource.GetValue("skybox.vs");var u=this.mResource.GetValue("skybox.fs");this.mShader=new Array();this.mShader.push(s);this.mShader.push(g);this.mShader.push(A);this.mShader.push(j);this.mShader.push(f);this.mShader.push(p);this.mShader.push(t);this.mShader.push(o);this.mShader.push(u);this.mBasicShader=new BasicShader();this.mBasicShader.Create();this.mBasicShader.AddShader(s);this.mBasicShader.AddShader(g);this.mBasicShader.Link();this.mBasicShader.Init();this.mBasicShader.Projection=this.mCamera.GetProjection();this.mBasicShader.View=this.mCamera.GetInverseView();this.mBasicShader.LightObject.push(this.mLight);this.mAtmosphereShader=new AtmosphereShader();this.mAtmosphereShader.Create();this.mAtmosphereShader.AddShader(A);this.mAtmosphereShader.AddShader(j);this.mAtmosphereShader.Link();this.mAtmosphereShader.Init();this.mAtmosphereShader.LightVector=(this.mLight.Position.Negative()).Normalize();this.mAtmosphereShader.NoiseOffset.SetPoint(1024,1024);this.mAtmosphereShader.NoiseNumIteration=8;this.mAtmosphereShader.NoiseScale=16;this.mAtmosphereShader.NoiseScaleMultiplier=2.5;this.mAtmosphereShader.NoiseWeight=0.65;this.mSkyboxShader=new SkyboxShader();this.mSkyboxShader.Create();this.mSkyboxShader.AddShader(o);this.mSkyboxShader.AddShader(u);this.mSkyboxShader.Link();this.mSkyboxShader.Init();this.mSkyboxShader.Projection=this.mBasicShader.Projection;this.mSkyboxShader.View=this.mBasicShader.View;this.mImageShader=new ImageShader();this.mImageShader.Create();this.mImageShader.AddShader(f);this.mImageShader.AddShader(p);this.mImageShader.Link();this.mImageShader.Init();this.mShader.push(this.mAtmosphereShader);this.mShader.push(this.mSkyboxShader);this.mShader.push(this.mImageShader);this.mEntity=new Array();this.mUpdateAtmosphere=true;var e=$("#CBoxResolution");e.on("change",this,this.OnResolutionChanged);this.mAtmosphereFovSlider=$("#AtmosphereFovSlider");this.mAtmosphereFovSlider.slider({animate:false,orientation:"horizontal",range:"min",step:0.0001,min:0.4,max:0.6,value:this.mAtmosphereShader.FOV});this.mAtmosphereFovSlider.on("slide",this,this.OnAtmosphereFovSliderChanged);this.mAtmosphereFovSlider.on("slidechange",this,this.OnAtmosphereFovSliderChanged);this.mAtmosphereFovSliderTxt=$("#AtmosphereFovSliderTxt");this.mAtmosphereFovSliderTxt.text(this.mAtmosphereShader.FOV);var k=["#AtmospherePosXSlider","#AtmospherePosYSlider","#AtmospherePosZSlider"];for(var r=0;r<k.length;++r){var n=$(k[r]);n.slider({animate:false,orientation:"horizontal",range:"min",step:0.01,min:-1,max:1,value:(r==0)?this.mAtmosphereShader.LightVector.x:(r==1)?this.mAtmosphereShader.LightVector.y:this.mAtmosphereShader.LightVector.z});n.on("slide",this,this.OnAtmospherePosSliderChanged);n.on("slidechange",this,this.OnAtmospherePosSliderChanged);var h=$(k[r]+"Txt");h.text(n.slider("value"))}var d=["#AtmosphereColourRSlider","#AtmosphereColourGSlider","#AtmosphereColourBSlider","#AtmosphereLightIntensitySlider"];for(var r=0;r<d.length;++r){var n=$(d[r]);n.slider({animate:false,orientation:"horizontal",range:"min",step:(r==3)?0.1:0.001,min:0,max:(r==3)?100:1,value:(r==0)?0.65:(r==1)?0.57:(r==2)?0.475:15});n.on("slide",this,this.OnAtmosphereColourSliderChanged);n.on("slidechange",this,this.OnAtmosphereColourSliderChanged);var h=$(d[r]+"Txt");h.text(n.slider("value"))}var m=["#AtmosphereRayleighSlider","#AtmosphereMieSlider","#AtmosphereMiePhaseSlider"];for(var r=0;r<m.length;++r){var n=$(m[r]);n.slider({animate:false,orientation:"horizontal",range:"min",step:0.0001,min:(r==0)?0.001:(r==1)?0:-0.9999,max:(r==0)?0.01:(r==1)?0.2:0.0001,value:(r==0)?0.0025:(r==1)?0.0015:-0.95});n.on("slide",this,this.OnAtmosphereScatterSliderChanged);n.on("slidechange",this,this.OnAtmosphereScatterSliderChanged);var h=$(m[r]+"Txt");h.text(n.slider("value"))}var l=["#CloudNoiseVelXSlider","#CloudNoiseVelYSlider","#CloudNoiseNumIterationSlider","#CloudNoiseScaleSlider","#CloudNoiseScaleMultiplierSlider","#CloudNoiseWeightSlider"];for(var r=0;r<l.length;++r){var n=$(l[r]);n.slider({animate:false,orientation:"horizontal",range:"min",step:(r<2)?0.001:(r==2)?1:0.001,min:(r<2)?-0.03:(r==2)?1:0,max:(r<2)?0.03:(r==2)?8:(r==3)?32:(r==5)?1:8,value:(r==0)?this.mCloudVelocity.x:(r==1)?this.mCloudVelocity.y:(r==2)?this.mAtmosphereShader.NoiseNumIteration:(r==3)?this.mAtmosphereShader.NoiseScale:(r==4)?this.mAtmosphereShader.NoiseScaleMultiplier:this.mAtmosphereShader.NoiseWeight});n.on("slide",this,this.OnCloudNoiseSliderChanged);n.on("slidechange",this,this.OnCloudNoiseSliderChanged);var h=$(l[r]+"Txt");h.text(n.slider("value"))}var q=["#CloudColourRSlider","#CloudColourGSlider","#CloudColourBSlider","#CloudCoverageSlider","#CloudSharpnessSlider"];for(var r=0;r<q.length;++r){var n=$(q[r]);n.slider({animate:false,orientation:"horizontal",range:"min",step:0.001,min:0,max:(r==4)?0.1:1,value:(r==0)?this.mAtmosphereShader.CloudColour.x:(r==1)?this.mAtmosphereShader.CloudColour.y:(r==2)?this.mAtmosphereShader.CloudColour.z:(r==3)?this.mAtmosphereShader.CloudCover:this.mAtmosphereShader.CloudSharpness});n.on("slide",this,this.OnCloudPropertySliderChanged);n.on("slidechange",this,this.OnCloudPropertySliderChanged);var h=$(q[r]+"Txt");h.text(n.slider("value"))}var n=$("#GammaSlider");n.slider({animate:false,orientation:"horizontal",range:"min",step:0.1,min:1,max:4,value:2.2});n.on("slide",this,this.OnGammaSliderChanged);n.on("slidechange",this,this.OnGammaSliderChanged);var h=$("#GammaSliderTxt");h.text(n.slider("value"));$("#BtnExportImages").on("click",this,this.OnBtnExportImagesClicked);$("#BtnExportImage").on("click",this,this.OnBtnExportImageClicked)};MainScene.prototype.OnResolutionChanged=function(c){var b=c.currentTarget.selectedIndex;var a=256<<b;c.data.mFboAtmosphereResolution.x=a;c.data.mFboAtmosphereResolution.y=a;c.data.mFboAtmosphereColour.TextureObject.Create(a,a,Texture.Format.Rgb,SamplerState.LinearClamp);c.data.mFboAtmosphere.Create(a,a);c.data.mFboAtmosphere.AttachBuffer(c.data.mFboAtmosphereColour);c.data.mUpdateAtmosphere=true};MainScene.prototype.OnAtmosphereFovSliderChanged=function(a,b){a.data.mAtmosphereShader.FOV=b.value;a.data.mAtmosphereFovSliderTxt.text(b.value);a.data.mUpdateAtmosphere=true};MainScene.prototype.OnAtmospherePosSliderChanged=function(b,c){if(!this.mIsSliderUpdating){var a=new Point($("#AtmospherePosXSlider").slider("value"),$("#AtmospherePosYSlider").slider("value"),$("#AtmospherePosZSlider").slider("value"));a.Normalize();b.data.mAtmosphereShader.LightVector=a;$("#AtmospherePosXSliderTxt").text(a.x.toFixed(2));$("#AtmospherePosYSliderTxt").text(a.y.toFixed(2));$("#AtmospherePosZSliderTxt").text(a.z.toFixed(2));this.mIsSliderUpdating=true;$("#AtmospherePosXSlider").slider("value",a.x);$("#AtmospherePosYSlider").slider("value",a.y);$("#AtmospherePosZSlider").slider("value",a.z);this.mIsSliderUpdating=false;b.data.mLight.Position.x=a.x*-1000;b.data.mLight.Position.y=a.y*-1000;b.data.mLight.Position.z=a.z*-1000;b.data.mUpdateAtmosphere=true}};MainScene.prototype.OnAtmosphereColourSliderChanged=function(a,b){var c=new Point($("#AtmosphereColourRSlider").slider("value"),$("#AtmosphereColourGSlider").slider("value"),$("#AtmosphereColourBSlider").slider("value"),$("#AtmosphereLightIntensitySlider").slider("value"));a.data.mAtmosphereShader.SetLightColour(c);a.data.mAtmosphereShader.SetLightIntensity(c.w);$("#AtmosphereColourRSliderTxt").text(c.x);$("#AtmosphereColourGSliderTxt").text(c.y);$("#AtmosphereColourBSliderTxt").text(c.z);$("#AtmosphereLightIntensitySliderTxt").text(c.w);a.data.mUpdateAtmosphere=true};MainScene.prototype.OnAtmosphereScatterSliderChanged=function(c,e){var a=$("#AtmosphereRayleighSlider").slider("value");c.data.mAtmosphereShader.SetRayleigh(a);var b=$("#AtmosphereMieSlider").slider("value");var d=$("#AtmosphereMiePhaseSlider").slider("value");c.data.mAtmosphereShader.SetMie(b,d);$("#AtmosphereRayleighSliderTxt").text(a);$("#AtmosphereMieSliderTxt").text(b);$("#AtmosphereMiePhaseSliderTxt").text(d);c.data.mUpdateAtmosphere=true};MainScene.prototype.OnCloudNoiseSliderChanged=function(a,b){if(a.currentTarget.id=="CloudNoiseVelXSlider"){a.data.mCloudVelocity.x=b.value;$("#CloudNoiseVelXSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudNoiseVelYSlider"){a.data.mCloudVelocity.y=b.value;$("#CloudNoiseVelYSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudNoiseNumIterationSlider"){a.data.mAtmosphereShader.NoiseNumIteration=b.value;$("#CloudNoiseNumIterationSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudNoiseScaleSlider"){a.data.mAtmosphereShader.NoiseScale=b.value;$("#CloudNoiseScaleSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudNoiseScaleMultiplierSlider"){a.data.mAtmosphereShader.NoiseScaleMultiplier=b.value;$("#CloudNoiseScaleMultiplierSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudNoiseWeightSlider"){a.data.mAtmosphereShader.NoiseWeight=b.value;$("#CloudNoiseWeightSliderTxt").text(b.value)}}}}}}a.data.mUpdateAtmosphere=true};MainScene.prototype.OnCloudPropertySliderChanged=function(a,b){if(a.currentTarget.id=="CloudColourRSlider"){a.data.mAtmosphereShader.CloudColour.x=b.value;$("#CloudColourRSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudColourGSlider"){a.data.mAtmosphereShader.CloudColour.y=b.value;$("#CloudColourGSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudColourBSlider"){a.data.mAtmosphereShader.CloudColour.z=b.value;$("#CloudColourBSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudCoverageSlider"){a.data.mAtmosphereShader.CloudCover=1-b.value;$("#CloudCoverageSliderTxt").text(b.value)}else{if(a.currentTarget.id=="CloudSharpnessSlider"){a.data.mAtmosphereShader.CloudSharpness=b.value;$("#CloudSharpnessSliderTxt").text(b.value)}}}}}a.data.mUpdateAtmosphere=true};MainScene.prototype.OnGammaSliderChanged=function(a,b){a.data.mAtmosphereShader.InvGamma=1/b.value;$("#GammaSliderTxt").text(b.value);a.data.mUpdateAtmosphere=true};MainScene.prototype.OnBtnExportImagesClicked=function(b,l){var d=new Array();var f=b.data.mCanvas.width;var m=b.data.mCanvas.height;b.data.mCanvas.width=b.data.mFboAtmosphere.GetFrameWidth();b.data.mCanvas.height=b.data.mFboAtmosphere.GetFrameHeight();gl.viewport(0,0,b.data.mCanvas.width,b.data.mCanvas.height);b.data.mAtmosphereShader.Enable();for(var k=0;k<b.data.mCameraViews.length;++k){b.data.mGraphicsContext.Clear();b.data.mAtmosphereShader.ViewMatrix=b.data.mCameraViews[k];b.data.mAtmosphereShader.Draw(b.data.mSurface,b.data.mSurface.ObjectEntity);var a=b.data.mCanvas.toDataURL("image/png");d.push(a)}b.data.mAtmosphereShader.Disable();b.data.mCanvas.width=f;b.data.mCanvas.height=m;gl.viewport(0,0,b.data.mCanvas.width,b.data.mCanvas.height);var j=window.open();var c=["PositiveX","NegativeX","NegativeY","PositiveY","PositiveZ","NegativeZ"];j.document.body.style.margin="0px";for(var k=0;k<d.length;++k){var e=j.document.createElement("p");var h=j.document.createTextNode(c[k]);e.appendChild(h);j.document.body.appendChild(e);var g=j.document.createElement("img");g.src=d[k];g.name=c[k];g.title=c[k];j.document.body.appendChild(g);var n=j.document.createElement("br");j.document.body.appendChild(n)}b.data.mUpdateAtmosphere=true};MainScene.prototype.OnBtnExportImageClicked=function(b,k){var d=b.data.mCanvas.width;var m=b.data.mCanvas.height;var c=b.data.mFboAtmosphere.GetFrameWidth();var n=b.data.mFboAtmosphere.GetFrameHeight();b.data.mCanvas.width=c*4;b.data.mCanvas.height=n*3;b.data.mGraphicsContext.Clear();var h=[b.data.mCameraViews[1],b.data.mCameraViews[4],b.data.mCameraViews[0],b.data.mCameraViews[5],b.data.mCameraViews[2],b.data.mCameraViews[3]];b.data.mAtmosphereShader.Enable();var l=0;var j=n;for(var g=0;g<h.length;++g){if(g<4){l=c*g}if(g==(h.length-2)){l=c;j=0}else{if(g==(h.length-1)){j=n*2}}gl.viewport(l,j,c,n);b.data.mAtmosphereShader.ViewMatrix=h[g];b.data.mAtmosphereShader.Draw(b.data.mSurface,b.data.mSurface.ObjectEntity)}b.data.mAtmosphereShader.Disable();var a=b.data.mCanvas.toDataURL("image/png");b.data.mCanvas.width=d;b.data.mCanvas.height=m;gl.viewport(0,0,b.data.mCanvas.width,b.data.mCanvas.height);var f=window.open();f.document.body.style.margin="0px";var e=f.document.createElement("img");e.src=a;e.name="Skybox";e.title="Skybox";f.document.body.appendChild(e);b.data.mUpdateAtmosphere=true};MainScene.prototype.Update=function(){this.mGraphicsContext.Clear();if(this.mUpdateAtmosphere||(this.mCloudVelocity.x!=0)||(this.mCloudVelocity.y!=0)){this.mAtmosphereShader.NoiseOffset.x+=this.mCloudVelocity.x;this.mAtmosphereShader.NoiseOffset.y+=this.mCloudVelocity.y;this.mFboAtmosphere.Enable();gl.viewport(0,0,this.mFboAtmosphere.GetFrameWidth(),this.mFboAtmosphere.GetFrameHeight());gl.clear(gl.COLOR_BUFFER_BIT);this.mAtmosphereShader.Enable();for(var a=0;a<this.mCameraViews.length;++a){this.mFboAtmosphere.EnableCubemap(gl.TEXTURE_CUBE_MAP_POSITIVE_X+a);this.mAtmosphereShader.ViewMatrix=this.mCameraViews[a];this.mAtmosphereShader.Draw(this.mSurface,this.mSurface.ObjectEntity)}this.mAtmosphereShader.Disable();this.mUpdateAtmosphere=false;this.mFboAtmosphere.Disable();gl.viewport(0,0,this.mCanvas.width,this.mCanvas.height)}this.mSkyboxShader.Enable();this.mSkyboxShader.Draw(this.mSkybox,this.mSkybox.ObjectEntity);this.mSkyboxShader.Disable();this.mBasicShader.Enable();this.mBasicShader.Draw(this.mGround,this.mGround.ObjectEntity);this.mBasicShader.Disable()};MainScene.prototype.End=function(){BaseScene.prototype.End.call(this);this.mCanvas=null;this.mResource=null;this.mCamera=null;this.mRenderState=null;this.mLight=null;if(this.mEntity!=null){for(var a=0;a<this.mEntity.length;++a){this.mEntity[a].ObjectEntity.Release()}this.mEntity=null}if(this.mFboAtmosphere!=null){this.mFboAtmosphere.Release();this.mFboAtmosphere=null}if(this.mFboAtmosphereColour!=null){this.mFboAtmosphereColour.TextureObject.Release();this.mFboAtmosphereColour=null}if(this.mShader!=null){for(var a=0;a<this.mShader.length;++a){this.mShader[a].Release()}this.mShader=null}};function MainApp(){App.call(this);App.CurrentApp=this}MainApp.prototype=new App();MainApp.prototype.constructor=MainApp;MainApp.prototype.Main=function(c,a){App.prototype.Main.call(this,c,a);this.SetWindow(document.getElementById("Canvas"));try{AppModel.Instance().Graphics=new GLGraphicsContext(this.mWindow)}catch(b){document.getElementById("DivNoWebGL").style.display="block";document.getElementById("DivWebGL").style.display="none";return}this.OnSize.Add(this.OnSizeChanged,this);this.OnSize.Dispatch(this.mWindow.width,this.mWindow.height,App.WindowState.Restore);Controller.Set("AppInitEvent",new AppInitCommand());new AppInitEvent().Dispatch();this.Start()};MainApp.prototype.Render=function(){App.prototype.Render.call(this);AppModel.Instance().Manager.Update()};MainApp.prototype.OnSizeChanged=function(c,a,d){this.mWindow.width=c;this.mWindow.height=a;var b=AppModel.Instance().Graphics;b.SetViewport(c,a)};AppStart=function(){App.CurrentApp=new MainApp();var a=window.location.search.substring(1);var b=null;if(a.search("%26")!=-1){b=a.split("%26")}else{b=a.split("&")}App.CurrentApp.Main(b.length,b);AppResize()};AppStop=function(){new AppClosingEvent().Dispatch()};AppResize=function(){App.CurrentApp.OnSize.Dispatch(window.innerWidth,window.innerHeight,App.WindowState.Restore)};